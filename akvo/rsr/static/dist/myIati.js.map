{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./scripts-src/my-iati.jsx"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","csrftoken","initialData","endpoints","months","i18n","cap","string","charAt","toUpperCase","slice","make_link","message","project_id","id","match","obj","url","React","createElement","href","target","apiCall","method","data","followPages","successCallback","retries","xmlHttp","XMLHttpRequest","onreadystatechange","readyState","DONE","response","responseText","JSON","parse","e","error","statusText","status","console","log","undefined","next","newResponse","oldResults","results","concat","onerror","open","setRequestHeader","send","displayDate","dateString","date","Date","split","replace","getUTCDate","month","january","february","march","april","may","june","july","august","september","october","november","december","getDateDescription","getUTCMonth","getUTCFullYear","unknown_date","loadComponents","ProjectRow","createClass","displayName","getInitialState","openChecks","switchAction","this","props","switchProject","project","inLastExport","lastExport","length","projects","indexOf","statusLabel","iati_status","needs_funding","active","completed","post_completion","cancelled","archived","no_status","publishedAndPublicLabel","published","publishing_status","unpublished","publicProject","is_public","public","private","and","renderInput","exporting","type","checked","selected","disabled","onClick","setState","hideChecks","renderChecks","checks_errors","checks_warnings","checks_success","errorLength","warningLength","checksText","allErrors","allWarnings","errors","map","check","warningText","warning","warnings","state","hide_all","show_all","render","title","untitled","className","yes","no","ProjectsTable","sortedProjects","sort","u1","u2","onclickAll","thisTable","selectedProjects","deselectAll","selectAll","language","window","location","pathname","substring","colSpan","no_projects_1","no_projects_2","no_projects_3","here","included_export","iati_checks","NewExportOverview","initializing","allProjects","publishedFilter","noErrorsChecked","previousChecked","publishedChecked","componentDidMount","reportingUrl","reporting_projects","lastExportUrl","iati_exports","thisApp","projectId","newSelection","projectIndex","splice","checkUnchecked","push","createExport","new_iati_export","stringify","reporting_organisation","selected_org_id","user","user_id","selection","lastProjects","selectNoErrors","select","newSelectionIndex","checkNoErrors","noErrorsCount","clickNoErrorsProjects","previousState","renderNoErrorsButton","buttonClass","without_errors","selectPublished","checkPublished","clickPublishedProjects","renderPublishedButton","selectPrevious","checkPrevious","countLastProjects","lastProject","clickPreviousProjects","renderSelectPreviousButton","selectAllProjects","deselectAllProjects","selectProjects","checkProjects","any","count","countSelected","renderFilters","project_selection","projects_selected","renderCreateButton","create_new","iati_export","loading","ExportRow","openPublicFile","last_exports_url","openFile","exp","iati_file","setPublic","renderActions","publicFile","view_latest_file","actionInProgress","view_file","set_latest","no_iati_file","renderRowClass","renderNumberOfProjects","processed_projects","processed","status_label","user_name","created_at","version","ExportsTable","no_exports","number_of_projects","created_by","iati_version","actions","ExportsOverview","refreshing","refreshingIn","loadExports","first_time","base_url","pendingOrInProgress","startCountDown","sortedExports","intervalId","setInterval","newRefreshing","clearInterval","findExport","exportId","exportUrl","thisExport","newerExports","newerExportsUpdated","publicData","privateData","allExportsUpdated","newerExportUpdated","newerExp","j","renderRefreshing","pending_or_progress","in","seconds","initOrTable","exportCount","exportCountString","last","document","getElementById","ReactDOM","cookieValue","cookie","cookies","trim","decodeURIComponent","getCookie","loadJS","implementationCode","scriptTag","src","onload","appendChild","addEventListener","button","checkbox","innerHTML","onclick","linkSign","onchange","public_iati_file","organisation","initReact","reactSrc","reactDOMSrc","body","loadAndRenderReact"],"mappings":"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","file":"myIati.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1020);\n","// Akvo RSR is covered by the GNU Affero General Public License.\n// See more details in the license.txt file located at the root folder of the\n// Akvo RSR module. For additional details on the GNU license please see\n// < http://www.gnu.org/licenses/agpl.html >.\n\nvar csrftoken, initialData, endpoints, months, i18n;\n\n/* CSRF TOKEN (this should really be added in base.html, we use it everywhere) */\nfunction getCookie(name) {\n    var cookieValue = null;\n    if (document.cookie && document.cookie !== \"\") {\n        var cookies = document.cookie.split(\";\");\n        for (var i = 0; i < cookies.length; i++) {\n            var cookie = cookies[i].trim();\n            if (cookie.substring(0, name.length + 1) == name + \"=\") {\n                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n                break;\n            }\n        }\n    }\n    return cookieValue;\n}\ncsrftoken = getCookie(\"csrftoken\");\n\n/* Capitalize the first character of a string */\nfunction cap(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\nfunction make_link(message, project_id) {\n    var id = message.match(/id: (\\d+)/),\n        obj = message.match(/(result|indicator|indicator period) \\(id:/);\n    if (id === null || obj === null) {\n        return cap(message);\n    }\n    id = id[1];\n    obj = obj[1];\n    if (obj === \"indicator period\") {\n        obj = \"indicator_period\";\n    }\n    var url = \"../project_editor/\" + project_id + \"/#\" + obj + \".\" + id;\n    return (\n        <a href={url} target=\"_blank\">\n            {cap(message)}\n        </a>\n    );\n}\n\n/* General API call function, retries 5 times by default and will retrieve all pages */\nfunction apiCall(method, url, data, followPages, successCallback, retries) {\n    var xmlHttp = new XMLHttpRequest();\n    var maxRetries = 5;\n\n    xmlHttp.onreadystatechange = function() {\n        if (xmlHttp.readyState == XMLHttpRequest.DONE) {\n            var response;\n            try {\n                response = xmlHttp.responseText !== \"\" ? JSON.parse(xmlHttp.responseText) : \"\";\n            } catch (e) {\n                response = { error: xmlHttp.statusText || e };\n            }\n            if (xmlHttp.status >= 200 && xmlHttp.status < 400) {\n                if (method === \"GET\" && response.next !== undefined) {\n                    if (response.next !== null && followPages) {\n                        var success = function(newResponse) {\n                            var oldResults = response.results;\n                            response.results = oldResults.concat(newResponse.results);\n                            if (successCallback !== undefined) {\n                                return successCallback(response);\n                            } else {\n                                return false;\n                            }\n                        };\n                        apiCall(method, response.next, data, followPages, success);\n                    } else {\n                        if (successCallback !== undefined) {\n                            return successCallback(response);\n                        } else {\n                            return false;\n                        }\n                    }\n                } else {\n                    if (successCallback !== undefined) {\n                        return successCallback(response);\n                    } else {\n                        return false;\n                    }\n                }\n            } else {\n                // TODO: Use a translated string\n                var message = \"general error: \";\n                for (var key in response) {\n                    if (response.hasOwnProperty(key)) {\n                        message += response[key] + \". \";\n                    }\n                }\n                // TODO: Proper error logging\n                // showGeneralError(message);\n                console.log(message);\n                return false;\n            }\n        }\n    };\n\n    xmlHttp.onerror = function() {\n        if (retries === undefined) {\n            return apiCall(method, url, data, followPages, successCallback, 2);\n        } else if (retries <= maxRetries) {\n            return apiCall(method, url, data, followPages, successCallback, retries + 1);\n        } else {\n            // TODO: Proper error logging\n            // showGeneralError(i18nResults.connection_error);\n            console.log(\"Connection error\");\n            return false;\n        }\n    };\n\n    xmlHttp.open(method, url, true);\n    xmlHttp.setRequestHeader(\"X-CSRFToken\", csrftoken);\n    xmlHttp.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n    xmlHttp.send(data);\n}\n\nfunction loadAsync(url, callback, retryCount, retryLimit) {\n    var xmlHttp;\n\n    xmlHttp = new XMLHttpRequest();\n\n    xmlHttp.onreadystatechange = function() {\n        if (xmlHttp.readyState == XMLHttpRequest.DONE) {\n            if (xmlHttp.status == 200) {\n                callback(xmlHttp.responseText);\n                return false;\n            } else {\n                if (retryCount >= retryLimit) {\n                    // TODO: Proper error logging\n                    console.log(\"Could not retrieve data from \" + url);\n                    return false;\n                } else {\n                    retryCount = retryCount + 1;\n                    loadAsync(url, retryCount, retryLimit);\n                }\n            }\n        }\n    };\n\n    xmlHttp.open(\"GET\", url, true);\n    xmlHttp.send();\n}\n\nfunction getDateDescription(month) {\n    switch (month) {\n        case 0:\n            return months.january;\n        case 1:\n            return months.february;\n        case 2:\n            return months.march;\n        case 3:\n            return months.april;\n        case 4:\n            return months.may;\n        case 5:\n            return months.june;\n        case 6:\n            return months.july;\n        case 7:\n            return months.august;\n        case 8:\n            return months.september;\n        case 9:\n            return months.october;\n        case 10:\n            return months.november;\n        case 11:\n            return months.december;\n    }\n}\n\nfunction displayDate(dateString) {\n    // Display a dateString like \"25 Jan 2016\"\n    if (dateString !== undefined && dateString !== null) {\n        var date = new Date(dateString.split(\".\")[0].replace(\"/\", /-/g));\n        var day = date.getUTCDate();\n        var month = getDateDescription(date.getUTCMonth());\n        var year = date.getUTCFullYear();\n        return day + \" \" + month + \" \" + year;\n    }\n    return i18n.unknown_date;\n}\n\nfunction loadComponents() {\n    var ProjectRow = React.createClass({\n        getInitialState: function() {\n            return {\n                openChecks: false\n            };\n        },\n\n        switchAction: function() {\n            this.props.switchProject(this.props.project.id);\n        },\n\n        inLastExport: function() {\n            if (this.props.lastExport.length > 0) {\n                var lastExportProjects = this.props.lastExport[0].projects;\n                if (lastExportProjects.indexOf(this.props.project.id) > -1) {\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        statusLabel: function() {\n            switch (this.props.project.iati_status) {\n                case \"1\":\n                    return cap(i18n.needs_funding);\n                case \"2\":\n                    return cap(i18n.active);\n                case \"3\":\n                    return cap(i18n.completed);\n                case \"4\":\n                    return cap(i18n.post_completion);\n                case \"5\":\n                    return cap(i18n.cancelled);\n                case \"6\":\n                    return cap(i18n.archived);\n                default:\n                    return cap(i18n.no_status);\n            }\n        },\n\n        publishedAndPublicLabel: function() {\n            var published =\n                this.props.project.publishing_status === \"published\"\n                    ? cap(i18n.published)\n                    : cap(i18n.unpublished);\n            var publicProject = this.props.project.is_public ? i18n.public : i18n.private;\n            return published + \" \" + i18n.and + \" \" + publicProject;\n        },\n\n        renderInput: function() {\n            if (!this.props.exporting) {\n                return (\n                    <input\n                        type=\"checkbox\"\n                        onClick={this.switchAction}\n                        checked={this.props.selected}\n                    />\n                );\n            } else {\n                return <input type=\"checkbox\" checked={this.props.selected} disabled />;\n            }\n        },\n\n        openChecks: function() {\n            this.setState({ openChecks: true });\n        },\n\n        hideChecks: function() {\n            this.setState({ openChecks: false });\n        },\n\n        renderChecks: function() {\n            if (\n                this.props.project.checks_errors.length === 0 &&\n                this.props.project.checks_warnings.length === 0\n            ) {\n                return <span>{cap(i18n.checks_success)}</span>;\n            } else {\n                var errorLength = this.props.project.checks_errors.length,\n                    warningLength = this.props.project.checks_warnings.length,\n                    checksText = \"\",\n                    allErrors = \"\",\n                    allWarnings = \"\";\n\n                if (errorLength > 0) {\n                    var errorText = errorLength === 1 ? i18n.error : i18n.errors;\n                    checksText += errorLength + \" \" + errorText;\n                    allErrors = this.props.project.checks_errors.map(function(check) {\n                        return (\n                            <span>\n                                - {cap(i18n.error)}: {make_link(check, this.props.project.id)}\n                                <br />\n                            </span>\n                        );\n                    }, this);\n                }\n                if (warningLength > 0) {\n                    var warningText = warningLength === 1 ? i18n.warning : i18n.warnings;\n                    if (errorLength > 0) {\n                        checksText += \" \" + i18n.and + \" \";\n                    }\n                    checksText += warningLength + \" \" + warningText;\n                    allWarnings = this.props.project.checks_warnings.map(function(check) {\n                        return (\n                            <span>\n                                - {cap(i18n.warning)}: {make_link(check, this.props.project.id)}\n                                <br />\n                            </span>\n                        );\n                    }, this);\n                }\n\n                if (this.state.openChecks) {\n                    return (\n                        <span>\n                            {checksText} <a onClick={this.hideChecks}>- {cap(i18n.hide_all)}</a>\n                            <br />\n                            {allErrors}\n                            {allWarnings}\n                        </span>\n                    );\n                } else {\n                    return (\n                        <span>\n                            {checksText} <a onClick={this.openChecks}>+ {cap(i18n.show_all)}</a>\n                        </span>\n                    );\n                }\n            }\n        },\n\n        render: function() {\n            return (\n                <tr>\n                    <td>{this.renderInput()}</td>\n                    <td>{this.props.project.id}</td>\n                    <td>\n                        {this.props.project.title ||\n                            \"<\" + cap(i18n.untitled) + \" \" + i18n.project + \">\"}\n                        <br />\n                        <span className=\"small\">{this.publishedAndPublicLabel()}</span>\n                    </td>\n                    <td>{this.statusLabel()}</td>\n                    <td>{this.inLastExport() ? cap(i18n.yes) : cap(i18n.no)}</td>\n                    <td>{this.renderChecks()}</td>\n                </tr>\n            );\n        }\n    });\n\n    var ProjectsTable = React.createClass({\n        sortedProjects: function() {\n            // Sort the projects by ID\n            function compare(u1, u2) {\n                if (u1.id < u2.id) {\n                    return -1;\n                } else if (u1.id > u2.id) {\n                    return 1;\n                } else {\n                    return 0;\n                }\n            }\n            return this.props.projects.sort(compare);\n        },\n\n        render: function() {\n            var thisTable = this,\n                projects,\n                checked,\n                onclickAll;\n\n            if (this.props.projects.length > 0) {\n                // In case there are projects, show a table overview of the projects.\n                checked = this.props.projects.length === this.props.selectedProjects.length;\n                onclickAll = checked ? this.props.deselectAll : this.props.selectAll;\n                projects = this.sortedProjects().map(function(project) {\n                    var selected = thisTable.props.selectedProjects.indexOf(project.id) > -1;\n                    return React.createElement(ProjectRow, {\n                        key: project.id,\n                        project: project,\n                        selected: selected,\n                        switchProject: thisTable.props.switchProject,\n                        lastExport: thisTable.props.lastExport,\n                        exporting: thisTable.props.exporting\n                    });\n                });\n            } else {\n                // In case there are no projects, show a message.\n                var language = window.location.pathname.substring(0, 3);\n                checked = false;\n                onclickAll = function() {\n                    return false;\n                };\n                projects = (\n                    <tr>\n                        <td colSpan=\"5\" className=\"text-center\">\n                            <p className=\"noItem\">\n                                {i18n.no_projects_1 +\n                                    \" \" +\n                                    i18n.no_projects_2 +\n                                    \" \" +\n                                    i18n.no_projects_3}\n                                <a href={language + \"/myrsr/projects/\"}>{i18n.here}</a>.\n                            </p>\n                        </td>\n                    </tr>\n                );\n            }\n\n            return (\n                <table className=\"table table-striped table-responsive myProjectList topMargin\">\n                    <thead>\n                        <tr>\n                            <th>\n                                <input type=\"checkbox\" onClick={onclickAll} checked={checked} />\n                            </th>\n                            <th>{i18n.id}</th>\n                            <th>{cap(i18n.title)}</th>\n                            <th>{cap(i18n.status)}</th>\n                            <th>{cap(i18n.included_export)}</th>\n                            <th>{i18n.iati_checks}</th>\n                        </tr>\n                    </thead>\n                    <tbody>{projects}</tbody>\n                </table>\n            );\n        }\n    });\n\n    var NewExportOverview = React.createClass({\n        getInitialState: function() {\n            return {\n                initializing: true,\n                allProjects: null,\n                selectedProjects: [],\n                lastExport: null,\n                publishedFilter: false,\n                exporting: false,\n                noErrorsChecked: false,\n                previousChecked: false,\n                publishedChecked: false\n            };\n        },\n\n        componentDidMount: function() {\n            var reportingUrl = endpoints.reporting_projects,\n                lastExportUrl = endpoints.iati_exports + \"&ordering=-id&limit=1\",\n                thisApp = this;\n\n            function projectsLoaded(results) {\n                if (thisApp.state.lastExport !== null) {\n                    thisApp.setState({\n                        initializing: false,\n                        allProjects: results\n                    });\n                } else {\n                    thisApp.setState({ allProjects: results });\n                }\n            }\n\n            function lastExportLoaded(response) {\n                if (thisApp.state.allProjects !== null) {\n                    thisApp.setState({\n                        initializing: false,\n                        lastExport: response.results\n                    });\n                } else {\n                    thisApp.setState({ lastExport: response.results });\n                }\n            }\n\n            apiCall(\"GET\", reportingUrl, {}, true, projectsLoaded);\n            apiCall(\"GET\", lastExportUrl, {}, false, lastExportLoaded);\n        },\n\n        switchProject: function(projectId) {\n            // Add projectId to the selectedProjects state, if it is not present.\n            // Else remove it from the state.\n            var newSelection = this.state.selectedProjects,\n                projectIndex = newSelection.indexOf(projectId);\n\n            if (projectIndex > -1) {\n                newSelection.splice(projectIndex, 1);\n                this.checkUnchecked();\n            } else {\n                newSelection.push(projectId);\n            }\n\n            this.setState({ selectedProjects: newSelection });\n        },\n\n        createExport: function() {\n            var url = endpoints.new_iati_export,\n                data = JSON.stringify({\n                    reporting_organisation: initialData.selected_org_id,\n                    user: initialData.user_id,\n                    projects: this.state.selectedProjects\n                });\n\n            function exportAdded(response) {\n                // Redirect user back to overview\n                window.location = window.location.href\n                    .replace(\"&new=true\", \"\")\n                    .replace(\"?new=true\", \"\");\n            }\n\n            this.setState({ exporting: true });\n            apiCall(\"POST\", url, data, true, exportAdded);\n        },\n\n        checkUnchecked: function() {\n            // A check whether the filters should be unchecked (after deselecting a project,\n            // for instance).\n            var selection = this.state.selectedProjects,\n                allProjects = this.state.allProjects.results,\n                lastProjects = this.state.lastExport[0].projects;\n\n            for (var i = 0; i < allProjects.length; i++) {\n                var project = allProjects[i];\n                if (project.checks_errors.length === 0 && selection.indexOf(project.id) < 0) {\n                    this.setState({ noErrorsChecked: false });\n                }\n                if (lastProjects.indexOf(project.id) > -1 && selection.indexOf(project.id) < 0) {\n                    this.setState({ previousChecked: false });\n                }\n                if (\n                    project.publishing_status === \"published\" &&\n                    selection.indexOf(project.id) < 0\n                ) {\n                    this.setState({ publishedChecked: false });\n                }\n            }\n        },\n\n        selectNoErrors: function(select) {\n            var newSelection = this.state.selectedProjects;\n\n            for (var i = 0; i < this.state.allProjects.results.length; i++) {\n                var project = this.state.allProjects.results[i],\n                    newSelectionIndex = newSelection.indexOf(project.id);\n                if (select && newSelectionIndex < 0 && project.checks_errors.length === 0) {\n                    newSelection.push(project.id);\n                } else if (\n                    !select &&\n                    newSelectionIndex > -1 &&\n                    project.checks_errors.length === 0\n                ) {\n                    newSelection.splice(newSelectionIndex, 1);\n                }\n            }\n\n            this.setState({ selectedProjects: newSelection });\n        },\n\n        checkNoErrors: function() {\n            var noErrorsCount = 0;\n\n            for (var i = 0; i < this.state.allProjects.results.length; i++) {\n                var project = this.state.allProjects.results[i];\n                if (project.checks_errors.length === 0) {\n                    noErrorsCount++;\n                }\n            }\n\n            return noErrorsCount;\n        },\n\n        clickNoErrorsProjects: function() {\n            var previousState = this.state.noErrorsChecked;\n            this.setState({ noErrorsChecked: !previousState });\n            if (previousState) {\n                this.selectNoErrors(false);\n            } else {\n                this.selectNoErrors(true);\n            }\n        },\n\n        renderNoErrorsButton: function() {\n            if (\n                this.state.allProjects === null ||\n                this.state.allProjects.results.length === 0 ||\n                this.checkNoErrors() === 0\n            ) {\n                return <span />;\n            } else {\n                var buttonClass = \"btn btn-default btn-sm\";\n\n                if (this.state.exporting) {\n                    buttonClass += \" disabled\";\n                }\n\n                return (\n                    <button className={buttonClass} onClick={this.clickNoErrorsProjects}>\n                        <input type=\"checkbox\" checked={this.state.noErrorsChecked} />{\" \"}\n                        {cap(i18n.without_errors)}\n                    </button>\n                );\n            }\n        },\n\n        selectPublished: function(select) {\n            var newSelection = this.state.selectedProjects;\n\n            for (var i = 0; i < this.state.allProjects.results.length; i++) {\n                var project = this.state.allProjects.results[i],\n                    newSelectionIndex = newSelection.indexOf(project.id);\n                if (select && newSelectionIndex < 0 && project.publishing_status === \"published\") {\n                    newSelection.push(project.id);\n                } else if (\n                    !select &&\n                    newSelectionIndex > -1 &&\n                    project.publishing_status === \"published\"\n                ) {\n                    newSelection.splice(newSelectionIndex, 1);\n                }\n            }\n\n            this.setState({ selectedProjects: newSelection });\n        },\n\n        checkPublished: function() {\n            var noErrorsCount = 0;\n\n            for (var i = 0; i < this.state.allProjects.results.length; i++) {\n                var project = this.state.allProjects.results[i];\n                if (project.publishing_status === \"published\") {\n                    return true;\n                }\n            }\n\n            return false;\n        },\n\n        clickPublishedProjects: function() {\n            var previousState = this.state.publishedChecked;\n            this.setState({ publishedChecked: !previousState });\n            if (previousState) {\n                this.selectPublished(false);\n            } else {\n                this.selectPublished(true);\n            }\n        },\n\n        renderPublishedButton: function() {\n            if (\n                this.state.allProjects === null ||\n                this.state.allProjects.results.length === 0 ||\n                !this.checkPublished()\n            ) {\n                return <span />;\n            } else {\n                var buttonClass = \"btn btn-default btn-sm\";\n\n                if (this.state.exporting) {\n                    buttonClass += \" disabled\";\n                }\n\n                return (\n                    <button className={buttonClass} onClick={this.clickPublishedProjects}>\n                        <input type=\"checkbox\" checked={this.state.publishedChecked} />{\" \"}\n                        {cap(i18n.published)}\n                    </button>\n                );\n            }\n        },\n\n        selectPrevious: function(select) {\n            var lastProjects = this.state.lastExport[0].projects,\n                newSelection = this.state.selectedProjects;\n\n            for (var i = 0; i < this.state.allProjects.results.length; i++) {\n                var projectId = this.state.allProjects.results[i].id,\n                    newSelectionIndex = newSelection.indexOf(projectId);\n                if (select && lastProjects.indexOf(projectId) > -1 && newSelectionIndex < 0) {\n                    newSelection.push(projectId);\n                } else if (\n                    !select &&\n                    lastProjects.indexOf(projectId) > -1 &&\n                    newSelectionIndex > -1\n                ) {\n                    newSelection.splice(newSelectionIndex, 1);\n                }\n            }\n\n            this.setState({ selectedProjects: newSelection });\n        },\n\n        checkPrevious: function() {\n            var lastProjects = this.state.lastExport[0].projects,\n                countLastProjects = 0;\n\n            for (var i = 0; i < lastProjects.length; i++) {\n                var lastProject = lastProjects[i];\n                if (this.state.selectedProjects.indexOf(lastProject) > -1) {\n                    countLastProjects++;\n                }\n            }\n\n            return countLastProjects === lastProjects.length;\n        },\n\n        clickPreviousProjects: function() {\n            var previousState = this.state.previousChecked;\n            this.setState({ previousChecked: !previousState });\n            if (previousState) {\n                this.selectPrevious(false);\n            } else {\n                this.selectPrevious(true);\n            }\n        },\n\n        renderSelectPreviousButton: function() {\n            if (\n                this.state.initializing ||\n                this.state.allProjects.results.length === 0 ||\n                this.state.lastExport.length === 0 ||\n                this.state.lastExport[0].projects.length === 0\n            ) {\n                return <span />;\n            } else {\n                var buttonClass = \"btn btn-default btn-sm\";\n\n                if (this.state.exporting) {\n                    buttonClass += \" disabled\";\n                }\n\n                return (\n                    <button className={buttonClass} onClick={this.clickPreviousProjects}>\n                        <input type=\"checkbox\" checked={this.state.previousChecked} />{\" \"}\n                        {cap(i18n.included_export)}\n                    </button>\n                );\n            }\n        },\n\n        selectAll: function(select) {\n            // Select or deselect all projects. The 'select' parameter determines whether all\n            // projects should be selected (true) or deselected (false).\n\n            // Remove existing selection\n            var newSelection = [];\n            this.setState({ selectedProjects: newSelection });\n\n            if (select) {\n                // Select all projects from allProjects state\n                for (var i = 0; i < this.state.allProjects.results.length; i++) {\n                    var project = this.state.allProjects.results[i];\n                    newSelection.push(project.id);\n                }\n\n                // Select all projects in state\n                this.setState({ selectedProjects: newSelection });\n            }\n        },\n\n        selectAllProjects: function() {\n            this.selectAll(true);\n        },\n\n        deselectAllProjects: function() {\n            this.selectAll(false);\n        },\n\n        selectProjects: function(select, key, value) {\n            var newSelection = this.state.selectedProjects;\n\n            for (var i = 0; i < this.state.allProjects.results.length; i++) {\n                var project = this.state.allProjects.results[i],\n                    newSelectionIndex = newSelection.indexOf(project.id);\n                if (select && project[key] === value && newSelectionIndex < 0) {\n                    newSelection.push(project.id);\n                } else if (!select && project[key] === value && newSelectionIndex > -1) {\n                    newSelection.splice(newSelectionIndex, 1);\n                }\n            }\n            this.setState({ selectedProjects: newSelection });\n        },\n\n        checkProjects: function(key, value, any) {\n            var count = 0,\n                countSelected = 0;\n\n            for (var i = 0; i < this.state.allProjects.results.length; i++) {\n                var project = this.state.allProjects.results[i];\n                if (project[key] === value) {\n                    if (any) {\n                        return true;\n                    } else {\n                        count++;\n                        if (this.state.selectedProjects.indexOf(project.id) > -1) {\n                            countSelected++;\n                        }\n                    }\n                }\n            }\n\n            return any ? false : count === countSelected;\n        },\n\n        renderFilters: function() {\n            return (\n                <div className=\"row iatiFilters\">\n                    <div className=\"col-sm-8 filterGroup\">\n                        <h5>{cap(i18n.project_selection)}</h5>\n                        {this.renderNoErrorsButton()}\n                        {this.renderSelectPreviousButton()}\n                        {this.renderPublishedButton()}\n                    </div>\n                    <div className=\"col-sm-4 newIatiExport text-center\">\n                        <p>\n                            {this.state.selectedProjects.length} {i18n.projects_selected}\n                        </p>\n                        {this.renderCreateButton()}\n                    </div>\n                </div>\n            );\n        },\n\n        renderCreateButton: function() {\n            if (!this.state.exporting) {\n                if (this.state.selectedProjects.length > 0) {\n                    return (\n                        <button className=\"btn btn-default btn-sm\" onClick={this.createExport}>\n                            <i className=\"fa fa-file-text-o\" /> {cap(i18n.create_new)}{\" \"}\n                            {i18n.iati_export}\n                        </button>\n                    );\n                } else {\n                    return (\n                        <button className=\"btn btn-default btn-sm disabled\">\n                            <i className=\"fa fa-file-text-o\" /> {cap(i18n.create_new)}{\" \"}\n                            {i18n.iati_export}\n                        </button>\n                    );\n                }\n            } else {\n                return (\n                    <button className=\"btn btn-default btn-sm disabled\">\n                        <i className=\"fa fa-spin fa-spinner\" /> {cap(i18n.create_new)}{\" \"}\n                        {i18n.iati_export}\n                    </button>\n                );\n            }\n        },\n\n        render: function() {\n            if (this.state.initializing) {\n                // Only show a message that data is being loading when initializing\n                return (\n                    <span className=\"small\">\n                        <i className=\"fa fa-spin fa-spinner\" /> {cap(i18n.loading)} {i18n.projects}\n                        ...\n                    </span>\n                );\n            } else {\n                // Show a table of projects when the data has been loaded\n                return (\n                    <div>\n                        {this.renderFilters()}\n                        {React.createElement(ProjectsTable, {\n                            projects: this.state.allProjects.results,\n                            selectedProjects: this.state.selectedProjects,\n                            switchProject: this.switchProject,\n                            lastExport: this.state.lastExport,\n                            exporting: this.state.exporting,\n                            selectAll: this.selectAllProjects,\n                            deselectAll: this.deselectAllProjects\n                        })}\n                    </div>\n                );\n            }\n        }\n    });\n\n    var ExportRow = React.createClass({\n        openPublicFile: function() {\n            window.open(i18n.last_exports_url, \"_blank\");\n        },\n\n        openFile: function() {\n            window.open(this.props.exp.iati_file, \"_blank\");\n        },\n\n        setPublic: function() {\n            this.props.setPublic(this.props.exp.id);\n        },\n\n        renderActions: function() {\n            if (this.props.publicFile) {\n                return (\n                    <button className=\"btn btn-success btn-sm\" onClick={this.openPublicFile}>\n                        <i className=\"fa fa-globe\" /> {cap(i18n.view_latest_file)}\n                    </button>\n                );\n            } else if (this.props.exp.iati_file) {\n                if (!this.props.actionInProgress) {\n                    return (\n                        <div>\n                            <button className=\"btn btn-default btn-sm\" onClick={this.openFile}>\n                                <i className=\"fa fa-code\" /> {cap(i18n.view_file)}\n                            </button>\n                            <button className=\"btn btn-default btn-sm\" onClick={this.setPublic}>\n                                <i className=\"fa fa-globe\" /> {cap(i18n.set_latest)}\n                            </button>\n                        </div>\n                    );\n                } else {\n                    return (\n                        <div>\n                            <button className=\"btn btn-default btn-sm\" onClick={this.openFile}>\n                                <i className=\"fa fa-code\" /> {cap(i18n.view_file)}\n                            </button>\n                            <button className=\"btn btn-default btn-sm disabled\">\n                                <i className=\"fa fa-globe\" /> {cap(i18n.set_latest)}\n                            </button>\n                        </div>\n                    );\n                }\n            } else {\n                return (\n                    <button className=\"btn btn-default btn-sm disabled\">\n                        <i className=\"fa fa-globe\" /> {cap(i18n.no_iati_file)}\n                    </button>\n                );\n            }\n        },\n\n        renderRowClass: function() {\n            if (this.props.publicFile) {\n                return \"success\";\n            } else if (this.props.exp.status === 1 || this.props.exp.status === 2) {\n                return \"warning\";\n            } else if (this.props.exp.status === 4 || this.props.exp.iati_file === \"\") {\n                return \"error\";\n            } else {\n                return \"\";\n            }\n        },\n\n        renderNumberOfProjects: function() {\n            if (this.props.exp.status !== 2) {\n                return this.props.exp.projects.length;\n            } else {\n                return (\n                    this.props.exp.projects.length +\n                    \" (\" +\n                    this.props.exp.processed_projects +\n                    \" \" +\n                    i18n.processed +\n                    \")\"\n                );\n            }\n        },\n\n        render: function() {\n            return (\n                <tr className={this.renderRowClass()}>\n                    <td>{this.props.exp.status_label}</td>\n                    <td>{this.renderNumberOfProjects()}</td>\n                    <td>{this.props.exp.user_name}</td>\n                    <td>{displayDate(this.props.exp.created_at)}</td>\n                    <td>{\"v\" + this.props.exp.version}</td>\n                    <td className=\"text-right\">{this.renderActions()}</td>\n                </tr>\n            );\n        }\n    });\n\n    var ExportsTable = React.createClass({\n        render: function() {\n            var thisTable = this,\n                exports;\n\n            if (this.props.exports.length > 0) {\n                // In case there are existing IATI exports, show a table overview of the exports.\n                exports = this.props.exports.map(function(exp) {\n                    var publicFile = thisTable.props.publicFile === exp.id;\n\n                    return React.createElement(ExportRow, {\n                        key: exp.id,\n                        exp: exp,\n                        publicFile: publicFile,\n                        setPublic: thisTable.props.setPublic,\n                        actionInProgress: thisTable.props.actionInProgress\n                    });\n                });\n            } else {\n                // In case there are no existing IATI exports yet, show a message.\n                exports = (\n                    <tr>\n                        <td colSpan=\"6\" className=\"text-center\">\n                            <p className=\"noItem\">{cap(i18n.no_exports)}</p>\n                        </td>\n                    </tr>\n                );\n            }\n\n            return (\n                <table className=\"table table-striped table-responsive myProjectList topMargin\">\n                    <thead>\n                        <tr>\n                            <th>{cap(i18n.status)}</th>\n                            <th>{i18n.number_of_projects}</th>\n                            <th>{cap(i18n.created_by)}</th>\n                            <th>{cap(i18n.created_at)}</th>\n                            <th>{i18n.iati_version}</th>\n                            <th className=\"text-right\">{cap(i18n.actions)}</th>\n                        </tr>\n                    </thead>\n                    <tbody>{exports}</tbody>\n                </table>\n            );\n        }\n    });\n\n    var ExportsOverview = React.createClass({\n        getInitialState: function() {\n            return {\n                exports: null,\n                initializing: true,\n                refreshing: false,\n                refreshingIn: 0,\n                actionInProgress: false\n            };\n        },\n\n        componentDidMount: function() {\n            this.loadExports(true);\n        },\n\n        loadExports: function(first_time) {\n            var thisApp = this,\n                url = endpoints.base_url + endpoints.iati_exports;\n\n            function firstTimeSuccess(response) {\n                thisApp.setState({\n                    initializing: false,\n                    exports: response\n                });\n                if (thisApp.pendingOrInProgress()) {\n                    thisApp.startCountDown();\n                }\n            }\n\n            function refreshingSuccess(response) {\n                thisApp.setState({\n                    refreshing: false,\n                    actionInProgress: false,\n                    exports: response\n                });\n                if (thisApp.pendingOrInProgress()) {\n                    thisApp.startCountDown();\n                }\n            }\n\n            if (!first_time) {\n                this.setState({ refreshing: true });\n                apiCall(\"GET\", url, {}, true, refreshingSuccess);\n            } else {\n                apiCall(\"GET\", url, {}, true, firstTimeSuccess);\n            }\n        },\n\n        sortedExports: function() {\n            // Sort the IATI exports by created at\n            function compare(u1, u2) {\n                if (u1.id > u2.id) {\n                    return -1;\n                } else if (u1.id < u2.id) {\n                    return 1;\n                } else {\n                    return 0;\n                }\n            }\n            return this.state.exports.results.sort(compare);\n        },\n\n        startCountDown: function() {\n            // Set the countdown for refreshing the table to start at 10 seconds\n            this.setState({ refreshingIn: 10 });\n\n            // Start ticking down\n            var thisApp = this,\n                intervalId = setInterval(tick, 1000);\n\n            function tick() {\n                var newRefreshing = thisApp.state.refreshingIn - 1;\n                thisApp.setState({ refreshingIn: newRefreshing });\n                if (newRefreshing === 0) {\n                    // Once done, reload the exports\n                    clearInterval(intervalId);\n                    thisApp.loadExports(false);\n                }\n            }\n        },\n\n        publicFile: function() {\n            if (this.state.exports === null) {\n                return null;\n            } else {\n                var sortedExports = this.sortedExports();\n                for (var i = 0; i < sortedExports.length; i++) {\n                    var exp = sortedExports[i];\n                    if (exp.iati_file !== \"\" && exp.is_public) {\n                        return exp.id;\n                    }\n                }\n                return null;\n            }\n        },\n\n        findExport: function(exportId) {\n            for (var i = 0; i < this.state.exports.results.length; i++) {\n                var exp = this.state.exports.results[i];\n                if (exp.id === exportId) {\n                    return exp;\n                }\n            }\n            return null;\n        },\n\n        pendingOrInProgress: function() {\n            // Check to see whether there is at least one export pending or in progress.\n            if (!this.state.initializing) {\n                for (var i = 0; i < this.state.exports.results.length; i++) {\n                    var exp = this.state.exports.results[i];\n                    if (exp.status < 3) {\n                        return true;\n                    }\n                }\n                return false;\n            } else {\n                return false;\n            }\n        },\n\n        setPublic: function(exportId) {\n            // Basically what we do is to set this export to public first, and then set all\n            // newer exports to private. This automatically makes this export the public export.\n            var thisApp = this,\n                exportUrl = endpoints.base_url + endpoints.iati_export,\n                thisExport = this.findExport(exportId),\n                newerExports = [],\n                newerExportsUpdated = 0,\n                publicData = JSON.stringify({ is_public: true }),\n                privateData = JSON.stringify({ is_public: false });\n\n            function allExportsUpdated() {\n                thisApp.loadExports(false);\n            }\n\n            function newerExportUpdated(response) {\n                newerExportsUpdated++;\n                if (newerExportsUpdated === newerExports.length) {\n                    allExportsUpdated();\n                }\n            }\n\n            function exportUpdated(response) {\n                // Find the newer IATI exports\n                for (var i = 0; i < thisApp.state.exports.results.length; i++) {\n                    var newerExp = thisApp.state.exports.results[i];\n                    if (newerExp.id !== exportId && newerExp.id > thisExport.id) {\n                        newerExports.push(newerExp);\n                    }\n                }\n\n                // Update the newer IATI exports\n                if (newerExports.length > 0) {\n                    for (var j = 0; j < newerExports.length; j++) {\n                        var exp = newerExports[j];\n                        apiCall(\n                            \"PATCH\",\n                            exportUrl.replace(\"{iati_export}\", exp.id),\n                            privateData,\n                            true,\n                            newerExportUpdated\n                        );\n                    }\n                } else {\n                    allExportsUpdated();\n                }\n            }\n\n            // Set current IATI export to public\n            this.setState({ actionInProgress: true });\n            apiCall(\n                \"PATCH\",\n                exportUrl.replace(\"{iati_export}\", exportId),\n                publicData,\n                true,\n                exportUpdated\n            );\n        },\n\n        renderRefreshing: function() {\n            if (this.state.refreshing) {\n                return (\n                    <span className=\"small\">\n                        <i className=\"fa fa-spin fa-spinner\" />{\" \"}\n                        {cap(i18n.refreshing) + \" \" + i18n.iati_exports + \"...\"}\n                    </span>\n                );\n            } else if (this.pendingOrInProgress()) {\n                return (\n                    <span className=\"small\">\n                        <i className=\"fa fa-spin fa-spinner\" />{\" \"}\n                        {cap(i18n.pending_or_progress) +\n                            \". \" +\n                            cap(i18n.refreshing) +\n                            \" \" +\n                            i18n.in +\n                            \" \" +\n                            this.state.refreshingIn +\n                            \" \" +\n                            i18n.seconds +\n                            \"...\"}\n                    </span>\n                );\n            } else {\n                return <span />;\n            }\n        },\n\n        render: function() {\n            var initOrTable, exportCount, exportCountString;\n\n            exportCount = !this.state.initializing ? this.state.exports.count : null;\n            exportCountString =\n                exportCount !== null && exportCount > 0\n                    ? \" \" + this.state.exports.count + \" \"\n                    : \" \";\n\n            if (this.state.initializing) {\n                // Only show a message that data is being loading when initializing\n                initOrTable = (\n                    <span className=\"small\">\n                        <i className=\"fa fa-spin fa-spinner\" />\n                        {\" \" +\n                            cap(i18n.loading) +\n                            \" \" +\n                            i18n.last +\n                            \" \" +\n                            i18n.iati_exports +\n                            \"...\"}\n                    </span>\n                );\n            } else {\n                // Show a table of existing imports when the data has been loaded\n                initOrTable = React.createElement(ExportsTable, {\n                    exports: this.sortedExports(),\n                    refreshing: this.state.refreshing,\n                    publicFile: this.publicFile(),\n                    setPublic: this.setPublic,\n                    actionInProgress: this.state.actionInProgress\n                });\n            }\n\n            return (\n                <div>\n                    <h4 className=\"topMargin\">\n                        {cap(i18n.last) + exportCountString + i18n.iati_exports}\n                    </h4>\n                    {this.renderRefreshing()}\n                    {initOrTable}\n                </div>\n            );\n        }\n    });\n\n    if (document.getElementById(\"exportsOverview\")) {\n        // Render 'My IATI' overview of existing exports\n        ReactDOM.render(\n            React.createElement(ExportsOverview),\n            document.getElementById(\"exportsOverview\")\n        );\n    } else if (document.getElementById(\"newIATIExport\")) {\n        // Render 'My IATI' overview of existing exports\n        ReactDOM.render(\n            React.createElement(NewExportOverview),\n            document.getElementById(\"newIATIExport\")\n        );\n    }\n}\n\nvar loadJS = function(url, implementationCode, location) {\n    //url is URL of external file, implementationCode is the code\n    //to be called from the file, location is the location to\n    //insert the <script> element\n\n    var scriptTag = document.createElement(\"script\");\n    scriptTag.src = url;\n\n    scriptTag.onload = implementationCode;\n    scriptTag.onreadystatechange = implementationCode;\n\n    location.appendChild(scriptTag);\n};\n\nfunction loadAndRenderReact() {\n    function initReact() {\n        loadComponents();\n    }\n\n    function loadReactDOM() {\n        var reactDOMSrc = document.getElementById(\"react-dom\").src;\n        loadJS(reactDOMSrc, initReact, document.body);\n    }\n\n    console.log(\"No React, load again.\");\n    var reactSrc = document.getElementById(\"react\").src;\n    loadJS(reactSrc, loadReactDOM, document.body);\n}\n\nfunction setFileOnOrganisationPage() {\n    var checkbox = document.getElementById(\"fileOnOrganisationPage\");\n    if (checkbox) {\n        checkbox.onchange = function() {\n            var data = JSON.stringify({ public_iati_file: checkbox.checked ? true : false });\n            apiCall(\"PATCH\", endpoints.organisation, data, true, function() {});\n        };\n    }\n}\n\nfunction setCreateFileOnClick() {\n    var button = document.getElementById(\"createIATIExport\");\n    if (button) {\n        button.onclick = function() {\n            // Add new=true parameter to URL and redirect to new URL\n            var linkSign = window.location.href.indexOf(\"org=\") < 0 ? \"?\" : \"&\";\n            window.location = window.location.href + linkSign + \"new=true\";\n        };\n    }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n    endpoints = JSON.parse(document.getElementById(\"endpoints\").innerHTML);\n    months = JSON.parse(document.getElementById(\"months\").innerHTML);\n    i18n = JSON.parse(document.getElementById(\"translations\").innerHTML);\n    initialData = JSON.parse(document.getElementById(\"data\").innerHTML);\n\n    setCreateFileOnClick();\n    setFileOnOrganisationPage();\n\n    if (document.getElementById(\"exportsOverview\") || document.getElementById(\"newIATIExport\")) {\n        if (typeof React !== \"undefined\" && typeof ReactDOM !== \"undefined\") {\n            loadComponents();\n        } else {\n            loadAndRenderReact();\n        }\n    }\n});\n"],"sourceRoot":""}