!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1020)}({1020:function(e,t){var s,r,n,a,c;function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}function l(e,t){var s=e.match(/id: (\d+)/),r=e.match(/(result|indicator|indicator period) \(id:/);if(null===s||null===r)return i(e);s=s[1],"indicator period"===(r=r[1])&&(r="indicator_period");var n="../project_editor/"+t+"/#"+r+"."+s;return React.createElement("a",{href:n,target:"_blank"},i(e))}function o(e,t,r,n,a,c){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE){var t;try{t=""!==i.responseText?JSON.parse(i.responseText):""}catch(e){t={error:i.statusText||e}}if(!(i.status>=200&&i.status<400)){var s="general error: ";for(var c in t)t.hasOwnProperty(c)&&(s+=t[c]+". ");return console.log(s),!1}if("GET"!==e||void 0===t.next)return void 0!==a&&a(t);if(null===t.next||!n)return void 0!==a&&a(t);o(e,t.next,r,n,function(e){var s=t.results;return t.results=s.concat(e.results),void 0!==a&&a(t)})}},i.onerror=function(){return void 0===c?o(e,t,r,n,a,2):c<=5?o(e,t,r,n,a,c+1):(console.log("Connection error"),!1)},i.open(e,t,!0),i.setRequestHeader("X-CSRFToken",s),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(r)}function u(e){if(null!=e){var t=new Date(e.split(".")[0].replace("/",/-/g));return t.getUTCDate()+" "+function(e){switch(e){case 0:return a.january;case 1:return a.february;case 2:return a.march;case 3:return a.april;case 4:return a.may;case 5:return a.june;case 6:return a.july;case 7:return a.august;case 8:return a.september;case 9:return a.october;case 10:return a.november;case 11:return a.december}}(t.getUTCMonth())+" "+t.getUTCFullYear()}return c.unknown_date}function p(){var e=React.createClass({displayName:"ProjectRow",getInitialState:function(){return{openChecks:!1}},switchAction:function(){this.props.switchProject(this.props.project.id)},inLastExport:function(){if(this.props.lastExport.length>0&&this.props.lastExport[0].projects.indexOf(this.props.project.id)>-1)return!0;return!1},statusLabel:function(){switch(this.props.project.iati_status){case"1":return i(c.needs_funding);case"2":return i(c.active);case"3":return i(c.completed);case"4":return i(c.post_completion);case"5":return i(c.cancelled);case"6":return i(c.archived);default:return i(c.no_status)}},publishedAndPublicLabel:function(){var e="published"===this.props.project.publishing_status?i(c.published):i(c.unpublished),t=this.props.project.is_public?c.public:c.private;return e+" "+c.and+" "+t},renderInput:function(){return this.props.exporting?React.createElement("input",{type:"checkbox",checked:this.props.selected,disabled:!0}):React.createElement("input",{type:"checkbox",onClick:this.switchAction,checked:this.props.selected})},openChecks:function(){this.setState({openChecks:!0})},hideChecks:function(){this.setState({openChecks:!1})},renderChecks:function(){if(0===this.props.project.checks_errors.length&&0===this.props.project.checks_warnings.length)return React.createElement("span",null,i(c.checks_success));var e=this.props.project.checks_errors.length,t=this.props.project.checks_warnings.length,s="",r="",n="";if(e>0&&(s+=e+" "+(1===e?c.error:c.errors),r=this.props.project.checks_errors.map(function(e){return React.createElement("span",null,"- ",i(c.error),": ",l(e,this.props.project.id),React.createElement("br",null))},this)),t>0){var a=1===t?c.warning:c.warnings;e>0&&(s+=" "+c.and+" "),s+=t+" "+a,n=this.props.project.checks_warnings.map(function(e){return React.createElement("span",null,"- ",i(c.warning),": ",l(e,this.props.project.id),React.createElement("br",null))},this)}return this.state.openChecks?React.createElement("span",null,s," ",React.createElement("a",{onClick:this.hideChecks},"- ",i(c.hide_all)),React.createElement("br",null),r,n):React.createElement("span",null,s," ",React.createElement("a",{onClick:this.openChecks},"+ ",i(c.show_all)))},render:function(){return React.createElement("tr",null,React.createElement("td",null,this.renderInput()),React.createElement("td",null,this.props.project.id),React.createElement("td",null,this.props.project.title||"<"+i(c.untitled)+" "+c.project+">",React.createElement("br",null),React.createElement("span",{className:"small"},this.publishedAndPublicLabel())),React.createElement("td",null,this.statusLabel()),React.createElement("td",null,this.inLastExport()?i(c.yes):i(c.no)),React.createElement("td",null,this.renderChecks()))}}),t=React.createClass({displayName:"ProjectsTable",sortedProjects:function(){return this.props.projects.sort(function(e,t){return e.id<t.id?-1:e.id>t.id?1:0})},render:function(){var t,s,r,n=this;if(this.props.projects.length>0)r=(s=this.props.projects.length===this.props.selectedProjects.length)?this.props.deselectAll:this.props.selectAll,t=this.sortedProjects().map(function(t){var s=n.props.selectedProjects.indexOf(t.id)>-1;return React.createElement(e,{key:t.id,project:t,selected:s,switchProject:n.props.switchProject,lastExport:n.props.lastExport,exporting:n.props.exporting})});else{var a=window.location.pathname.substring(0,3);s=!1,r=function(){return!1},t=React.createElement("tr",null,React.createElement("td",{colSpan:"5",className:"text-center"},React.createElement("p",{className:"noItem"},c.no_projects_1+" "+c.no_projects_2+" "+c.no_projects_3,React.createElement("a",{href:a+"/myrsr/projects/"},c.here),".")))}return React.createElement("table",{className:"table table-striped table-responsive myProjectList topMargin"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,React.createElement("input",{type:"checkbox",onClick:r,checked:s})),React.createElement("th",null,c.id),React.createElement("th",null,i(c.title)),React.createElement("th",null,i(c.status)),React.createElement("th",null,i(c.included_export)),React.createElement("th",null,c.iati_checks))),React.createElement("tbody",null,t))}}),s=React.createClass({displayName:"NewExportOverview",getInitialState:function(){return{initializing:!0,allProjects:null,selectedProjects:[],lastExport:null,publishedFilter:!1,exporting:!1,noErrorsChecked:!1,previousChecked:!1,publishedChecked:!1}},componentDidMount:function(){var e=n.reporting_projects,t=n.iati_exports+"&ordering=-id&limit=1",s=this;o("GET",e,{},!0,function(e){null!==s.state.lastExport?s.setState({initializing:!1,allProjects:e}):s.setState({allProjects:e})}),o("GET",t,{},!1,function(e){null!==s.state.allProjects?s.setState({initializing:!1,lastExport:e.results}):s.setState({lastExport:e.results})})},switchProject:function(e){var t=this.state.selectedProjects,s=t.indexOf(e);s>-1?(t.splice(s,1),this.checkUnchecked()):t.push(e),this.setState({selectedProjects:t})},createExport:function(){var e=n.new_iati_export,t=JSON.stringify({reporting_organisation:r.selected_org_id,user:r.user_id,projects:this.state.selectedProjects});this.setState({exporting:!0}),o("POST",e,t,!0,function(e){window.location=window.location.href.replace("&new=true","").replace("?new=true","")})},checkUnchecked:function(){for(var e=this.state.selectedProjects,t=this.state.allProjects.results,s=this.state.lastExport[0].projects,r=0;r<t.length;r++){var n=t[r];0===n.checks_errors.length&&e.indexOf(n.id)<0&&this.setState({noErrorsChecked:!1}),s.indexOf(n.id)>-1&&e.indexOf(n.id)<0&&this.setState({previousChecked:!1}),"published"===n.publishing_status&&e.indexOf(n.id)<0&&this.setState({publishedChecked:!1})}},selectNoErrors:function(e){for(var t=this.state.selectedProjects,s=0;s<this.state.allProjects.results.length;s++){var r=this.state.allProjects.results[s],n=t.indexOf(r.id);e&&n<0&&0===r.checks_errors.length?t.push(r.id):!e&&n>-1&&0===r.checks_errors.length&&t.splice(n,1)}this.setState({selectedProjects:t})},checkNoErrors:function(){for(var e=0,t=0;t<this.state.allProjects.results.length;t++){0===this.state.allProjects.results[t].checks_errors.length&&e++}return e},clickNoErrorsProjects:function(){var e=this.state.noErrorsChecked;this.setState({noErrorsChecked:!e}),e?this.selectNoErrors(!1):this.selectNoErrors(!0)},renderNoErrorsButton:function(){if(null===this.state.allProjects||0===this.state.allProjects.results.length||0===this.checkNoErrors())return React.createElement("span",null);var e="btn btn-default btn-sm";return this.state.exporting&&(e+=" disabled"),React.createElement("button",{className:e,onClick:this.clickNoErrorsProjects},React.createElement("input",{type:"checkbox",checked:this.state.noErrorsChecked})," ",i(c.without_errors))},selectPublished:function(e){for(var t=this.state.selectedProjects,s=0;s<this.state.allProjects.results.length;s++){var r=this.state.allProjects.results[s],n=t.indexOf(r.id);e&&n<0&&"published"===r.publishing_status?t.push(r.id):!e&&n>-1&&"published"===r.publishing_status&&t.splice(n,1)}this.setState({selectedProjects:t})},checkPublished:function(){for(var e=0;e<this.state.allProjects.results.length;e++){if("published"===this.state.allProjects.results[e].publishing_status)return!0}return!1},clickPublishedProjects:function(){var e=this.state.publishedChecked;this.setState({publishedChecked:!e}),e?this.selectPublished(!1):this.selectPublished(!0)},renderPublishedButton:function(){if(null!==this.state.allProjects&&0!==this.state.allProjects.results.length&&this.checkPublished()){var e="btn btn-default btn-sm";return this.state.exporting&&(e+=" disabled"),React.createElement("button",{className:e,onClick:this.clickPublishedProjects},React.createElement("input",{type:"checkbox",checked:this.state.publishedChecked})," ",i(c.published))}return React.createElement("span",null)},selectPrevious:function(e){for(var t=this.state.lastExport[0].projects,s=this.state.selectedProjects,r=0;r<this.state.allProjects.results.length;r++){var n=this.state.allProjects.results[r].id,a=s.indexOf(n);e&&t.indexOf(n)>-1&&a<0?s.push(n):!e&&t.indexOf(n)>-1&&a>-1&&s.splice(a,1)}this.setState({selectedProjects:s})},checkPrevious:function(){for(var e=this.state.lastExport[0].projects,t=0,s=0;s<e.length;s++){var r=e[s];this.state.selectedProjects.indexOf(r)>-1&&t++}return t===e.length},clickPreviousProjects:function(){var e=this.state.previousChecked;this.setState({previousChecked:!e}),e?this.selectPrevious(!1):this.selectPrevious(!0)},renderSelectPreviousButton:function(){if(this.state.initializing||0===this.state.allProjects.results.length||0===this.state.lastExport.length||0===this.state.lastExport[0].projects.length)return React.createElement("span",null);var e="btn btn-default btn-sm";return this.state.exporting&&(e+=" disabled"),React.createElement("button",{className:e,onClick:this.clickPreviousProjects},React.createElement("input",{type:"checkbox",checked:this.state.previousChecked})," ",i(c.included_export))},selectAll:function(e){var t=[];if(this.setState({selectedProjects:t}),e){for(var s=0;s<this.state.allProjects.results.length;s++){var r=this.state.allProjects.results[s];t.push(r.id)}this.setState({selectedProjects:t})}},selectAllProjects:function(){this.selectAll(!0)},deselectAllProjects:function(){this.selectAll(!1)},selectProjects:function(e,t,s){for(var r=this.state.selectedProjects,n=0;n<this.state.allProjects.results.length;n++){var a=this.state.allProjects.results[n],c=r.indexOf(a.id);e&&a[t]===s&&c<0?r.push(a.id):!e&&a[t]===s&&c>-1&&r.splice(c,1)}this.setState({selectedProjects:r})},checkProjects:function(e,t,s){for(var r=0,n=0,a=0;a<this.state.allProjects.results.length;a++){var c=this.state.allProjects.results[a];if(c[e]===t){if(s)return!0;r++,this.state.selectedProjects.indexOf(c.id)>-1&&n++}}return!s&&r===n},renderFilters:function(){return React.createElement("div",{className:"row iatiFilters"},React.createElement("div",{className:"col-sm-8 filterGroup"},React.createElement("h5",null,i(c.project_selection)),this.renderNoErrorsButton(),this.renderSelectPreviousButton(),this.renderPublishedButton()),React.createElement("div",{className:"col-sm-4 newIatiExport text-center"},React.createElement("p",null,this.state.selectedProjects.length," ",c.projects_selected),this.renderCreateButton()))},renderCreateButton:function(){return this.state.exporting?React.createElement("button",{className:"btn btn-default btn-sm disabled"},React.createElement("i",{className:"fa fa-spin fa-spinner"})," ",i(c.create_new)," ",c.iati_export):this.state.selectedProjects.length>0?React.createElement("button",{className:"btn btn-default btn-sm",onClick:this.createExport},React.createElement("i",{className:"fa fa-file-text-o"})," ",i(c.create_new)," ",c.iati_export):React.createElement("button",{className:"btn btn-default btn-sm disabled"},React.createElement("i",{className:"fa fa-file-text-o"})," ",i(c.create_new)," ",c.iati_export)},render:function(){return this.state.initializing?React.createElement("span",{className:"small"},React.createElement("i",{className:"fa fa-spin fa-spinner"})," ",i(c.loading)," ",c.projects,"..."):React.createElement("div",null,this.renderFilters(),React.createElement(t,{projects:this.state.allProjects.results,selectedProjects:this.state.selectedProjects,switchProject:this.switchProject,lastExport:this.state.lastExport,exporting:this.state.exporting,selectAll:this.selectAllProjects,deselectAll:this.deselectAllProjects}))}}),a=React.createClass({displayName:"ExportRow",openPublicFile:function(){window.open(c.last_exports_url,"_blank")},openFile:function(){window.open(this.props.exp.iati_file,"_blank")},setPublic:function(){this.props.setPublic(this.props.exp.id)},renderActions:function(){return this.props.publicFile?React.createElement("button",{className:"btn btn-success btn-sm",onClick:this.openPublicFile},React.createElement("i",{className:"fa fa-globe"})," ",i(c.view_latest_file)):this.props.exp.iati_file?this.props.actionInProgress?React.createElement("div",null,React.createElement("button",{className:"btn btn-default btn-sm",onClick:this.openFile},React.createElement("i",{className:"fa fa-code"})," ",i(c.view_file)),React.createElement("button",{className:"btn btn-default btn-sm disabled"},React.createElement("i",{className:"fa fa-globe"})," ",i(c.set_latest))):React.createElement("div",null,React.createElement("button",{className:"btn btn-default btn-sm",onClick:this.openFile},React.createElement("i",{className:"fa fa-code"})," ",i(c.view_file)),React.createElement("button",{className:"btn btn-default btn-sm",onClick:this.setPublic},React.createElement("i",{className:"fa fa-globe"})," ",i(c.set_latest))):React.createElement("button",{className:"btn btn-default btn-sm disabled"},React.createElement("i",{className:"fa fa-globe"})," ",i(c.no_iati_file))},renderRowClass:function(){return this.props.publicFile?"success":1===this.props.exp.status||2===this.props.exp.status?"warning":4===this.props.exp.status||""===this.props.exp.iati_file?"error":""},renderNumberOfProjects:function(){return 2!==this.props.exp.status?this.props.exp.projects.length:this.props.exp.projects.length+" ("+this.props.exp.processed_projects+" "+c.processed+")"},render:function(){return React.createElement("tr",{className:this.renderRowClass()},React.createElement("td",null,this.props.exp.status_label),React.createElement("td",null,this.renderNumberOfProjects()),React.createElement("td",null,this.props.exp.user_name),React.createElement("td",null,u(this.props.exp.created_at)),React.createElement("td",null,"v"+this.props.exp.version),React.createElement("td",{className:"text-right"},this.renderActions()))}}),p=React.createClass({displayName:"ExportsTable",render:function(){var e,t=this;return e=this.props.exports.length>0?this.props.exports.map(function(e){var s=t.props.publicFile===e.id;return React.createElement(a,{key:e.id,exp:e,publicFile:s,setPublic:t.props.setPublic,actionInProgress:t.props.actionInProgress})}):React.createElement("tr",null,React.createElement("td",{colSpan:"6",className:"text-center"},React.createElement("p",{className:"noItem"},i(c.no_exports)))),React.createElement("table",{className:"table table-striped table-responsive myProjectList topMargin"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,i(c.status)),React.createElement("th",null,c.number_of_projects),React.createElement("th",null,i(c.created_by)),React.createElement("th",null,i(c.created_at)),React.createElement("th",null,c.iati_version),React.createElement("th",{className:"text-right"},i(c.actions)))),React.createElement("tbody",null,e))}}),h=React.createClass({displayName:"ExportsOverview",getInitialState:function(){return{exports:null,initializing:!0,refreshing:!1,refreshingIn:0,actionInProgress:!1}},componentDidMount:function(){this.loadExports(!0)},loadExports:function(e){var t=this,s=n.base_url+n.iati_exports;e?o("GET",s,{},!0,function(e){t.setState({initializing:!1,exports:e}),t.pendingOrInProgress()&&t.startCountDown()}):(this.setState({refreshing:!0}),o("GET",s,{},!0,function(e){t.setState({refreshing:!1,actionInProgress:!1,exports:e}),t.pendingOrInProgress()&&t.startCountDown()}))},sortedExports:function(){return this.state.exports.results.sort(function(e,t){return e.id>t.id?-1:e.id<t.id?1:0})},startCountDown:function(){this.setState({refreshingIn:10});var e=this,t=setInterval(function(){var s=e.state.refreshingIn-1;e.setState({refreshingIn:s}),0===s&&(clearInterval(t),e.loadExports(!1))},1e3)},publicFile:function(){if(null===this.state.exports)return null;for(var e=this.sortedExports(),t=0;t<e.length;t++){var s=e[t];if(""!==s.iati_file&&s.is_public)return s.id}return null},findExport:function(e){for(var t=0;t<this.state.exports.results.length;t++){var s=this.state.exports.results[t];if(s.id===e)return s}return null},pendingOrInProgress:function(){if(this.state.initializing)return!1;for(var e=0;e<this.state.exports.results.length;e++){if(this.state.exports.results[e].status<3)return!0}return!1},setPublic:function(e){var t=this,s=n.base_url+n.iati_export,r=this.findExport(e),a=[],c=0,i=JSON.stringify({is_public:!0}),l=JSON.stringify({is_public:!1});function u(){t.loadExports(!1)}function p(e){++c===a.length&&u()}this.setState({actionInProgress:!0}),o("PATCH",s.replace("{iati_export}",e),i,!0,function(n){for(var c=0;c<t.state.exports.results.length;c++){var i=t.state.exports.results[c];i.id!==e&&i.id>r.id&&a.push(i)}if(a.length>0)for(var h=0;h<a.length;h++){var d=a[h];o("PATCH",s.replace("{iati_export}",d.id),l,!0,p)}else u()})},renderRefreshing:function(){return this.state.refreshing?React.createElement("span",{className:"small"},React.createElement("i",{className:"fa fa-spin fa-spinner"})," ",i(c.refreshing)+" "+c.iati_exports+"..."):this.pendingOrInProgress()?React.createElement("span",{className:"small"},React.createElement("i",{className:"fa fa-spin fa-spinner"})," ",i(c.pending_or_progress)+". "+i(c.refreshing)+" "+c.in+" "+this.state.refreshingIn+" "+c.seconds+"..."):React.createElement("span",null)},render:function(){var e,t,s;return s=null!==(t=this.state.initializing?null:this.state.exports.count)&&t>0?" "+this.state.exports.count+" ":" ",e=this.state.initializing?React.createElement("span",{className:"small"},React.createElement("i",{className:"fa fa-spin fa-spinner"})," "+i(c.loading)+" "+c.last+" "+c.iati_exports+"..."):React.createElement(p,{exports:this.sortedExports(),refreshing:this.state.refreshing,publicFile:this.publicFile(),setPublic:this.setPublic,actionInProgress:this.state.actionInProgress}),React.createElement("div",null,React.createElement("h4",{className:"topMargin"},i(c.last)+s+c.iati_exports),this.renderRefreshing(),e)}});document.getElementById("exportsOverview")?ReactDOM.render(React.createElement(h),document.getElementById("exportsOverview")):document.getElementById("newIATIExport")&&ReactDOM.render(React.createElement(s),document.getElementById("newIATIExport"))}s=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var s=document.cookie.split(";"),r=0;r<s.length;r++){var n=s[r].trim();if(n.substring(0,e.length+1)==e+"="){t=decodeURIComponent(n.substring(e.length+1));break}}return t}("csrftoken");var h=function(e,t,s){var r=document.createElement("script");r.src=e,r.onload=t,r.onreadystatechange=t,s.appendChild(r)};document.addEventListener("DOMContentLoaded",function(){var e,t;n=JSON.parse(document.getElementById("endpoints").innerHTML),a=JSON.parse(document.getElementById("months").innerHTML),c=JSON.parse(document.getElementById("translations").innerHTML),r=JSON.parse(document.getElementById("data").innerHTML),(e=document.getElementById("createIATIExport"))&&(e.onclick=function(){var e=window.location.href.indexOf("org=")<0?"?":"&";window.location=window.location.href+e+"new=true"}),(t=document.getElementById("fileOnOrganisationPage"))&&(t.onchange=function(){var e=JSON.stringify({public_iati_file:!!t.checked});o("PATCH",n.organisation,e,!0,function(){})}),(document.getElementById("exportsOverview")||document.getElementById("newIATIExport"))&&("undefined"!=typeof React&&"undefined"!=typeof ReactDOM?p():function(){function e(){p()}console.log("No React, load again.");var t=document.getElementById("react").src;h(t,function(){var t=document.getElementById("react-dom").src;h(t,e,document.body)},document.body)}())})}});
//# sourceMappingURL=myIati.js.map