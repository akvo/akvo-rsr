{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./scripts-src/project-editor.jsx"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","defaultValues","JSON","parse","document","getElementById","innerHTML","countryValues","update_section_states_timer","csrftoken","cookieValue","cookie","cookies","split","length","trim","substring","decodeURIComponent","getCookie","MAX_RETRIES","projectsAPIUrl","orgsAPIUrl","responses","MAX_LOCALSTORAGE_AGE","MAX_LOCALSTORAGE_DAYS","localStorageName","localStorageResponses","localStorage","getItem","partials","INPUT_ELEMENTS","findAncestorByClass","el","cls","parentElement","classList","contains","findAncestorByTag","tag","tagName","toUpperCase","hasParent","node","serialize","form","q","elements","formField","fieldChanged","nodeName","type","parentNode","push","encodeURIComponent","getAttribute","join","finishSave","saveButton","success","message","removeAttribute","save_message_div","querySelector","message_div","createElement","icon","add","appendChild","setTimeout","createTextNode","addErrors","errors","error","errorNode","textnode","pNode","className","parentExists","partialNode","click","scrollIntoView","window","scrollBy","tryError","successSave","remove","replaceNames","newObjects","old_id","newParentNodeId","new_id","setAttribute","unicode","relObjectElements","querySelectorAll","k","relObjectElement","relObjectParentElement","idList","relObjectParentElementId","relObjectWillBeReplaced","indexOf","newObjectsKey","indexToBeReplaced","newRelObjectParentElementIdList","relObjectParentElementIdList","doSubmitStep","api_url","form_data","request","errorElements","formElements","errorElement","removeChild","j","FormElement","replace","removeErrors","saving","startSave","project_id","XMLHttpRequest","open","setRequestHeader","onload","status","response","responseText","save_error","save_success","changes","formElement","elHasClass","id","default_indicator","parentIndicator","rel_objects","setSectionCompletionPercentage","setPageCompletionPercentage","checkPartnerships","setIndicatorSorting","setResultSorting","save_forbidden","save_general_error","onerror","connection_error","send","submitStep","e","preventDefault","setDeletePhoto","deletePhotoButton","onclick","deletePhotoContainer","inputNode","imgNode","file_delete_error","setDeleteDocument","documentInput","deleteDocumentButton","deleteDocumentContainer","pop","preview","replacePhoto","photo","img_photo","photo_container","add_html","delete_link","replaceDocument","documentUrl","documentContainer","documentPreview","documentUrlNode","documentUrlTextNode","uploaded_document","deleteDocumentNode","deleteButton","setFileUploads","inputs","onchange","uploadFile","fileInput","maxFileSize","fileType","errorHelpNodes","errorText","uploadFileSize","file","files","maxSize","size","checkFileSize","file_size","toFixed","file_size_allowed","toString","match","image_file_format","formData","FormData","append","progressBarContainer","upload","addEventListener","progressBar","percentage","parseInt","loaded","total","style","width","getTotalBudget","total_budget","budget","returnRemoveButton","container","delete_error","setRemovePartial","trashCan","confirmRemove","yesNode","objId","apiEndpoint","itemId","itemType","relatedObjDiv","sureNode","setAllSectionsCompletionPercentage","parentDiv","parentParent","idArray","getAttributeNode","sure_message","yes","noNode","dismissRemove","no","updateSectionState","section","updateAllHelpIcons","markMandatoryFields","setHiddenFields","setSectionChangeListener","elAddClass","updateAllSectionState","forEach","updateLocalStorage","url","output","writeDate","lsData","Date","getTime","date","json","stringify","setItem","processResponse","selector","childClass","valueId","label","help","filterOption","inputType","typeaheadOptions","typeaheadCallback","displayOption","Typeahead","TypeaheadContainer","selectorTypeahead","selectorClass","inputClass","typeaheadInput","ReactTypeahead","title","short","long","newName","long_name","React","createClass","displayName","getInitialState","focusClass","onKeyUp","this","setState","onBlur","render","state","placeholder","options","onOptionSelected","maxVisible","childID","customClasses","typeahead","input","results","listItem","token","customAdd","inputProps","onMouseDown","addOrgModal","add_new_organisation","ReactDOM","savedResult","hasAttribute","buildReactComponents","option","index","clearTimeout","setPartialOnClicks","partial","buttons","callback","addPartial","removeLinks","hidePartials","togglePartial","selectInputs","selectInputId","togglePartner","toggleOtherLabel","setMeasureVisibility","target","setDimensionVisibility","setLabelsVisibility","specialInfoIcons","toggleHelpText","documentToggles","toggleDocumentUpload","relatedProjectToggles","toggleRelatedProject","toggleNode","parent","relatedProjectFormGroup","iatiIdFormGroup","checked","urlFormGroup","fileFormGroup","helpIconNode","stopPropagation","cancelBubble","selectNode","nodeIdList","labelNodeId","labelNode","selectedIndex","text","is_admin","partnerContainer","partnerPartials","partialId","roleNode","reportingSelected","elRemoveClass","hasReportingOption","reportingOption","reportingOptionText","reporting_org","partnerNodes","partnerIdNode","partnerId","org_permissions","fundingNodeId","fundingNode","fundingFormGroup","secondaryNodeId","secondaryFormGroup","indicatorTypeSelect","measureRow","getElementsByClassName","labelsContainer","dimensionDiv","relatedContainer","hidePartial","partialToHide","foldedIndicator","updatePartialIDs","newID","oldIdList","partialInputs","oldFieldIdList","typeaheadContainers","oldChildIdList","oldTypeaheadId","typeaheadParentClassList","childClassList","newChildClass","splice","dateContainers","oldDataIdList","partialName","partialContainer","markupSelector","partialString","DOMParser","parseFromString","addRow","insertBefore","childContainer","relatedObjCount","hierarchyList","hierarchy","findInHierachy","oldPartialID","childId","childChildContainers","childRelatedObjCount","childChildChildContainers","childChildRelatedObjCount","parentID","parentContainer","parentParentID","childContainers","childOfChildContainers","childOfRelatedObjCount","forceReloadOrg","projectCurrencyDropdown","currencyDisplays","projectCurrency","updateOrganisationTypeaheads","updateProjectTypeaheads","setDatepickers","setPeriodMasqueradeDates","setCurrencyOnChange","setVocabularyOnChange","updateHelpIcons","setAllSectionsChangeListener","setValidationListeners","updateTypeahead","els","labelText","helpText","API","getLoadAsync","childSelector","loadAsync","retryCount","retryLimit","xmlHttp","undefined","maxAge","onreadystatechange","readyState","DONE","getCallback","child","textContent","cb","related_project_label","related_project_helptext","partner_label","partner_helptext","provider_org_label","provider_org_helptext","recipient_org_label","recipient_org_helptext","labels","helpBlockIsLabelSibling","iconClasses","helpBlockFromLabel","numHelpBlocks","numParentHelpBlocks","offsetWidth","offsetHeight","infoIcons","getInfoIconListener","helpBlock","display","getValidationSets","inputCompleted","field","partialFilled","inputElements","shouldBeHidden","validationSets","hideAccordingToValidationSet","validationSet","relatedObject","allElements","formGroupNode","relatedObjectContainers","relatedObjectContainer","sections","inputResults","getInputResults","numInputs","numInputsCompleted","renderCompletionPercentage","completionPercentage","can_create_projects","publishButton","getOrField","orValidation","fieldClassList","otherFieldName","fieldIdList","otherFieldId","processedFields","mandatoryFields","formGroup","underlyingPartials","orField","completionClass","Math","floor","y","listener","getChangeListener","formSteps","markMandatoryOrField","element","otherField","markContainer","or_mandatory_1","or_mandatory_2","markMandatoryField","elementLabel","existingMarkers","mandatoryIndicator","elementsToMark","mandatoryOrClass","idComponents","otherElement","getLengthListener","charsLeft","charMessage","getHideCharsListener","inputListener","focusOutListener","textareas","textarea","currencyDropdown","newCurrency","currencyDisplay","hasObjectCurrency","updateCurrency","currencyDropdowns","otherCurrencyDropdown","updateObjectCurrency","currencyNode","optionsId","textInputSelector","dropDownInputSelector","map","info","vocabularyFields","vocabularyOnChange","codeFieldSwitcher","vocabularyField","selectField","getElementsByTagName","vocabularyValue","textInputField","dropDownInputField","codeSelectField","createSelectOption","setSelectedValue","optionField","indicatorContainers","indicatorSections","setReorderButtons","setDefaultPeriodButtons","resultSections","itemNode","itemIndex","listLength","sortItemNode","sortItemUp","upButton","move_up","reorderItems","sortItemDown","downButton","move_down","itemContainer","childNodes","direction","swap_id","swapId","selectedItem","swapItem","firstElementChild","lastElementChild","previousElementSibling","swapReorderedItems","console","log","indicatorNode","indicatorId","defaultPeriodNode","addButton","set_default","confirmContainer","confirmText","add_to_existing","yesButton","setDefaultPeriods","noButton","promptCopyDefaultPeriods","removeButton","remove_default","submitDefaultPeriods","defaultButtons","removeDefaultPeriods","indicatorContainer","addExisting","refreshText","refresh_periods","copy","setDefault","default_periods","showHidePanel","panel","panelBody","toggleSection","allFormBlocks","allSections","div","formBlock","infoIcon","inputStep","sectionInfoIcon","setPrivateProject","privateProject","changePrivate","privateProjectSwitch","setImpactProject","impactProject","changeImpact","impactProjectSwitch","importButton","divNode","getImportResults","setPublishOnClick","publishingStatusId","publishErrorNode","span","unsavedMessage","unsavedSections","checkUnsavedChanges","otherTextElement","otherIconElement","publishIndicator","published","unpublish","not_published","publish","__all__","getProjectPublish","publishing_status_id","hierarchy_name","period_start","start_date","period_end","end_date","masqueradeLabel","periodContainers","periodLabel","getDatepickerComponent","datepickerId","initialDate","disableInput","handleDateChange","fireInputChangeListener","getDOMNode","DatePicker","locale","placeholderText","showYearDropdown","dateFormat","selected","onChange","todayButton","today","props","classNames","datepickerContainers","DatePickerComponent","datepickerContainer","helptext","inputValue","masqueradeDate","masqueradeInput","newPeriod","moment","mandatoryOr","inputField","checkUnsavedChangesForm","forms","formNames","unsavedForms","cancelModal","modal","submitModal","allInputsFilledBoolean","fields","fieldNode","fieldNodeHelp","fieldNodeContainer","blank_field","comma_value","allInputsFilled","scrollTop","inputParent","inputHelp","orgId","footer","organisation_id","latitude","longitude","request_loc","org_logo_files","logo_data","logo_request","submitOrgLogo","submitOrgLocation","general_error","Modal","country_option_list","country","pk","maxLength","htmlFor","max","characters","iati_org_id","accept","for","org_logo","government","other_public_sector","international_ngo","national_ngo","regional_ngo","public_private_partnership","multilateral","foundation","private_sector","academic_training_research","org_type","website","start_http","use_link","href","coordinates","contact_person","contact_email","rows","description","onClick","cancel","save","removeValidationSetFromProject","validationSetId","addValidationUrl","currentValidationSets","removeFromProgressBar","addValidationSetToProject","addToProgressBar","changeValidationSet","result","entry","RegExp","test","initApp","getAllProjects","onbeforeunload","event","returnValue","validationSetContainer","setValidationSets","saveDivs","setSubmitOnClicks","toggleSections","projectOptions","projectProgress","optionsPanelHeading","progressPanelHeading","setToggleSectionOnClick","setLocalStorage","expandAccordion","highlight","location","hash","stepInput","indicator","period","loadJS","implementationCode","scriptTag","src","loadReactDatepicker","reactDatepickerSrc","body","loadReactOnclickoutside","reactOnclickoutsideSrc","loadReactTypeahead","reactTypeaheadSrc","reactSrc","reactDOMSrc","loadAndRenderReact"],"mappings":"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","file":"projectEditor.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1027);\n","// Akvo RSR is covered by the GNU Affero General Public License.\n// See more details in the license.txt file located at the root folder of the\n// Akvo RSR module. For additional details on the GNU license please see\n// < http://www.gnu.org/licenses/agpl.html >.\n\n// DEFAULT VALUES\nvar defaultValues = JSON.parse(document.getElementById(\"default-values\").innerHTML);\nvar countryValues = JSON.parse(document.getElementById(\"country-values\").innerHTML);\n\n// CSRF TOKEN\nfunction getCookie(name) {\n    var cookieValue = null;\n    if (document.cookie && document.cookie !== \"\") {\n        var cookies = document.cookie.split(\";\");\n        for (var i = 0; i < cookies.length; i++) {\n            var cookie = cookies[i].trim();\n            // Does this cookie string begin with the name we want?\n            if (cookie.substring(0, name.length + 1) == name + \"=\") {\n                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n                break;\n            }\n        }\n    }\n    return cookieValue;\n}\n\nvar csrftoken = getCookie(\"csrftoken\");\n\n// TYPEAHEADS\nvar MAX_RETRIES = 2;\nvar projectsAPIUrl = \"/rest/v1/typeaheads/projects?format=json\";\nvar orgsAPIUrl = \"/rest/v1/typeaheads/organisations?format=json\";\nvar responses = {};\nresponses[projectsAPIUrl] = null;\nresponses[orgsAPIUrl] = null;\nvar update_section_states_timer;\n\n// LOCAL STORAGE\nvar MAX_LOCALSTORAGE_DAYS = 30;\nvar MAX_LOCALSTORAGE_AGE = MAX_LOCALSTORAGE_DAYS * 24 * 60 * 60 * 1000;\nvar localStorageName = \"cachedAPIResponses\";\nvar localStorageResponses = localStorage.getItem(localStorageName);\n\n// PARTIALS\nvar partials = [\n    \"related-project\",\n    \"humanitarian-scope\",\n    \"budget-item\",\n    \"condition\",\n    \"contact-information\",\n    \"country-budget-item\",\n    \"document\",\n    \"document-category\",\n    \"indicator\",\n    \"indicator-dimension\",\n    \"indicator-label\",\n    \"indicator-period\",\n    \"indicator-reference\",\n    \"indicator-period-actual-dimension\",\n    \"indicator-period-actual-location\",\n    \"indicator-period-target-dimension\",\n    \"indicator-period-target-location\",\n    \"link\",\n    \"partner\",\n    \"planned-disbursement\",\n    \"policy-marker\",\n    \"recipient-country\",\n    \"recipient-region\",\n    \"related-project\",\n    \"result\",\n    \"sector\",\n    \"transaction\",\n    \"transaction-sector\",\n    \"location-administrative\",\n    \"project-location\",\n    \"keyword\",\n    \"crs-add\",\n    \"crsadd-other-flag\",\n    \"fss\",\n    \"fss-forecast\",\n    \"legacy-data\"\n];\n\n// Measure the percentage of completion for each panel and display the results to the user\n// Which elements count as inputs?\nvar INPUT_ELEMENTS = [\"input\", \"select\", \"textarea\"];\n\nfunction findAncestorByClass(el, cls) {\n    while ((el = el.parentElement) && !el.classList.contains(cls));\n    return el;\n}\n\nfunction findAncestorByTag(el, tag) {\n    while ((el = el.parentElement) && el.tagName !== tag.toUpperCase());\n    return el;\n}\n\nfunction fieldIsHidden(node) {\n    /* Checks if the field is hidden or not. */\n    return findAncestorByClass(node, \"form-group\").classList.contains(\"hidden\");\n}\n\nfunction hasParent(node) {\n    /* Checks if a node is part of a partial. */\n    return findAncestorByClass(node, \"parent\") !== null;\n}\n\nfunction serialize(form) {\n    /* Serialize the form so that it can be sent through the API.\n       Modified to skip hidden fields and added / removed some field types.\n       Modified to only serialize fields that have been changed. */\n\n    var q = [];\n\n    for (var i = 0; i < form.elements.length; i++) {\n        var formField = form.elements[i];\n\n        if (formField.name !== \"\" && fieldChanged(formField)) {\n            // Form field has a name and is changed (and not hidden), only then process it\n            if (formField.nodeName === \"INPUT\") {\n                if (formField.type === \"text\" || formField.type === \"number\") {\n                    if (formField.parentNode.classList.contains(\"typeahead\")) {\n                        // Special case for typeaheads, the ID of the object is stored in the value attribute\n                        q.push(\n                            formField.name +\n                                \"=\" +\n                                encodeURIComponent(formField.getAttribute(\"value\"))\n                        );\n                    } else {\n                        q.push(formField.name + \"=\" + encodeURIComponent(formField.value));\n                    }\n                }\n            } else if (formField.nodeName === \"TEXTAREA\" || formField.nodeName === \"SELECT\") {\n                q.push(formField.name + \"=\" + encodeURIComponent(formField.value));\n            }\n        }\n    }\n    return q.join(\"&\");\n}\n\nfunction startSave(saveButton) {\n    /* Indicate that saving has started:\n        - Disable save button\n        - Show 'Saving...' message */\n\n    saveButton.setAttribute(\"disabled\", \"\");\n\n    var save_message_div = findAncestorByClass(saveButton, \"row\").querySelector(\".save-message\");\n    save_message_div.innerHTML = defaultValues.saving + \"...\";\n}\n\nfunction finishSave(saveButton, success, message) {\n    /* Indicate that saving has finished:\n        - Enable the save button again\n        - If no errors, show that it has successfully completed\n        - If errors, show the error message */\n\n    saveButton.removeAttribute(\"disabled\");\n\n    var save_message_div = findAncestorByClass(saveButton, \"row\").querySelector(\".save-message\");\n    var message_div = document.createElement(\"div\");\n    var icon = document.createElement(\"span\");\n\n    save_message_div.innerHTML = \"\";\n    icon.classList.add(\"glyphicon\");\n\n    if (success) {\n        icon.classList.add(\"glyphicon-ok-circle\");\n        message_div.classList.add(\"save-success\");\n        message_div.appendChild(icon);\n\n        setTimeout(function() {\n            save_message_div.innerHTML = \"\";\n        }, 5000);\n    } else {\n        icon.classList.add(\"glyphicon-remove-circle\");\n        message_div.classList.add(\"help-block-error\");\n        message_div.appendChild(icon);\n    }\n\n    message_div.appendChild(document.createTextNode(\" \" + message));\n    save_message_div.appendChild(message_div);\n}\n\nfunction removeErrors(form) {\n    var errorElements, formElements;\n\n    errorElements = form.querySelectorAll(\".help-block-error\");\n    formElements = form.querySelectorAll(\".has-error\");\n\n    for (var i = errorElements.length; i > 0; i--) {\n        var errorElement = errorElements[i - 1];\n        errorElement.parentNode.removeChild(errorElement);\n    }\n\n    for (var j = formElements.length; j > 0; j--) {\n        var FormElement = formElements[j - 1];\n        FormElement.className = FormElement.className.replace(\"has-error\", \"\");\n    }\n}\n\nfunction addErrors(errors) {\n    for (var i = 0; i < errors.length; i++) {\n        try {\n            var error, errorNode, textnode;\n\n            error = errors[i];\n            errorNode = document.getElementById(error.name);\n            errorNode = findAncestorByClass(errorNode, \"form-group\");\n            errorNode.classList.add(\"has-error\");\n\n            var pNode = document.createElement(\"p\");\n            pNode.className = \"help-block help-block-error\";\n            textnode = document.createTextNode(error.error);\n            pNode.appendChild(textnode);\n            errorNode.appendChild(pNode);\n\n            var parentExists = hasParent(errorNode);\n            var partialNode = errorNode;\n            while (parentExists) {\n                partialNode = findAncestorByClass(partialNode, \"parent\");\n                if (partialNode.querySelector(\".hide-partial\").classList.contains(\"hidden\")) {\n                    // Open partial to show error\n                    partialNode.querySelector(\".hide-partial-click\").click();\n                }\n                parentExists = hasParent(partialNode);\n            }\n\n            if (i === 0) {\n                document.getElementById(error.name).scrollIntoView();\n                window.scrollBy(0, -100);\n            }\n        } catch (tryError) {\n            // Can't find attribute, probably due to a name change\n        }\n    }\n}\n\nfunction successSave(node) {\n    /* Add a 5 second green border to the element to indicate that it has been saved successfully */\n    var parentNode = findAncestorByClass(node, \"form-group\");\n    parentNode.classList.add(\"has-success\");\n    setTimeout(function() {\n        parentNode.classList.remove(\"has-success\");\n    }, 5000);\n}\n\nfunction replaceNames(newObjects) {\n    /* Update the names and IDs of fields.\n       Also show the new unicode of related objects in the header. */\n\n    for (var i = 0; i < newObjects.length; i++) {\n        // Update parent node ID\n        var parentNode = document.getElementById(newObjects[i].old_id);\n        var newParentNodeId = newObjects[i].old_id.split(\".\")[0] + \".\" + newObjects[i].new_id;\n        parentNode.setAttribute(\"id\", newParentNodeId);\n\n        // Update unicode\n        var unicodeNode = parentNode.querySelector(\".unicode\");\n        unicodeNode.innerHTML = newObjects[i].unicode;\n\n        // Update IDs and names of all input fields\n        var relObjectElements = parentNode.querySelectorAll(INPUT_ELEMENTS.join());\n        for (var k = 0; k < relObjectElements.length; k++) {\n            var relObjectElement = relObjectElements[k];\n\n            if (relObjectElement.type !== \"checkbox\") {\n                // Check if the input is an underlying partial or not\n                var relObjectParentElement = findAncestorByClass(relObjectElement, \"parent\");\n                var idList = relObjectElement.getAttribute(\"id\").split(\".\");\n                if (relObjectParentElement === parentNode) {\n                    idList[2] = newObjects[i].new_id;\n                    relObjectElement.setAttribute(\"id\", idList.join(\".\"));\n                    relObjectElement.setAttribute(\"name\", idList.join(\".\"));\n                } else {\n                    // Update underlying objects if they're not going to be replaced later on or\n                    // already replaced (e.g. there's no 'new' in the ID)\n                    var relObjectParentElementId = relObjectParentElement.getAttribute(\"id\");\n                    var relObjectWillBeReplaced = false;\n                    if (relObjectParentElementId.indexOf(\"new\") > -1) {\n                        for (var newObjectsKey in newObjects) {\n                            if (\n                                Object.prototype.hasOwnProperty.call(newObjects, newObjectsKey) &&\n                                newObjects[newObjectsKey].old_id === relObjectParentElementId\n                            ) {\n                                relObjectWillBeReplaced = true;\n                                break;\n                            }\n                        }\n                        if (!relObjectWillBeReplaced) {\n                            // Underlying object is not in newObjects, so we need to replace the IDs of\n                            // those inputs as well\n                            var indexToBeReplaced =\n                                newObjects[i].old_id.split(\".\")[1].split(\"_\").length - 1;\n                            var newRelObjectParentElementIdList = idList[2].split(\"_\");\n                            newRelObjectParentElementIdList[indexToBeReplaced] =\n                                newObjects[i].new_id;\n                            idList[2] = newRelObjectParentElementIdList.join(\"_\");\n                            relObjectElement.setAttribute(\"id\", idList.join(\".\"));\n                            relObjectElement.setAttribute(\"name\", idList.join(\".\"));\n\n                            // And we need to update the parent ID of that partial too\n                            var relObjectParentElementIdList = relObjectParentElementId.split(\".\");\n                            relObjectParentElementIdList[1] = newRelObjectParentElementIdList.join(\n                                \"_\"\n                            );\n                            relObjectParentElement.setAttribute(\n                                \"id\",\n                                relObjectParentElementIdList.join(\".\")\n                            );\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction replaceTotalBudget(total_budget) {\n    var totalBudgetNode;\n\n    totalBudgetNode = document.getElementById(\"total-budget\");\n    totalBudgetNode.innerHTML = total_budget;\n}\n\nfunction doSubmitStep(saveButton) {\n    /* Main function for submitting a form */\n    var api_url, form, form_data, request, file_request, message;\n\n    // Collect form data\n    form = findAncestorByTag(saveButton, \"form\");\n    form_data = serialize(form);\n\n    // Remove existing errors and indicate that saving has started\n    removeErrors(form);\n    startSave(saveButton);\n\n    // Create request\n    api_url = \"/rest/v1/project/\" + defaultValues.project_id + \"/project_editor/?format=json\";\n    request = new XMLHttpRequest();\n    request.open(\"POST\", api_url, true);\n    request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n    request.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n    request.onload = function() {\n        if (request.status >= 200 && request.status < 400) {\n            var response;\n            response = JSON.parse(request.responseText);\n            // Check for errors\n            if (response.errors.length > 0) {\n                message = defaultValues.save_error;\n                addErrors(response.errors);\n                finishSave(saveButton, false, message);\n            } else {\n                message = defaultValues.save_success;\n                finishSave(saveButton, true, message);\n            }\n\n            // Replace saved values and show that it updated\n            for (var i = 0; i < response.changes.length; i++) {\n                var formElement = document.getElementById(response.changes[i][0]);\n                formElement.setAttribute(\"saved-value\", response.changes[i][1]);\n                if (\n                    formElement.parentNode !== null &&\n                    elHasClass(formElement.parentNode, \"typeahead\")\n                ) {\n                    var typeaheadContainer = findAncestorByClass(\n                        formElement.parentNode,\n                        \"typeahead-container\"\n                    );\n                    typeaheadContainer.setAttribute(\"data-value\", response.changes[i][1]);\n                }\n\n                // Set warning for default indicator periods if new indicator saved\n                if (\n                    formElement.id.indexOf(\"rsr_indicator\") > -1 &&\n                    defaultValues.default_indicator > -1\n                ) {\n                    var parentIndicator = findAncestorByClass(\n                        formElement.parentNode,\n                        \"indicator-item\"\n                    );\n                    if (!parentIndicator.classList.contains(\"default-period-buttons-set\")) {\n                        parentIndicator.querySelector(\".reload-warning\").classList.remove(\"hidden\");\n                    }\n                }\n\n                successSave(formElement);\n            }\n\n            // Replace field IDs, names and unicode\n            replaceNames(response.rel_objects);\n\n            // Update progress bars\n            var section = findAncestorByClass(form, \"formStep\");\n            setSectionCompletionPercentage(section);\n            setPageCompletionPercentage();\n\n            // Check partnerships (hide or show delete button)\n            checkPartnerships();\n\n            // Reset ordering buttons if necessary\n            if (form_data.indexOf(\"rsr_indicator\") > -1) {\n                setIndicatorSorting();\n            }\n            if (form_data.indexOf(\"rsr_result\") > -1) {\n                setResultSorting();\n            }\n\n            return false;\n        } else if (request.status === 403) {\n            // Not allowed to save\n            message = defaultValues.save_forbidden;\n            finishSave(saveButton, false, message);\n            return false;\n        } else {\n            // We reached our target server, but it returned an error\n            message = defaultValues.save_general_error;\n            finishSave(saveButton, false, message);\n            return false;\n        }\n    };\n\n    request.onerror = function() {\n        // There was a connection error of some sort\n        message = defaultValues.connection_error;\n        finishSave(saveButton, false, message);\n        return false;\n    };\n\n    request.send(form_data);\n}\n\nfunction submitStep(saveButton) {\n    return function(e) {\n        e.preventDefault();\n        doSubmitStep(saveButton);\n    };\n}\n\nfunction setDeletePhoto() {\n    var deletePhotoButton = document.getElementById(\"delete-photo\");\n\n    if (deletePhotoButton !== null) {\n        deletePhotoButton.onclick = function(e) {\n            e.preventDefault();\n\n            // Remove 'delete' button\n            var deletePhotoContainer = deletePhotoButton.parentNode;\n            deletePhotoContainer.removeChild(deletePhotoButton);\n\n            // Remove any existing errors\n            var inputNode = document.getElementById(\n                \"rsr_project.current_image.\" + defaultValues.project_id\n            );\n            findAncestorByClass(inputNode, \"form-group\").classList.remove(\"has-error\");\n            var errorNode = findAncestorByClass(inputNode, \"form-group\").querySelector(\n                \".help-block-error\"\n            );\n            if (errorNode !== null) {\n                errorNode.parentNode.removeChild(errorNode);\n            }\n\n            // Create request\n            var api_url = \"/rest/v1/project/\" + defaultValues.project_id + \"/?format=json\";\n            var request = new XMLHttpRequest();\n            request.open(\"PATCH\", api_url, true);\n            request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n            request.setRequestHeader(\"Content-type\", \"application/json\");\n\n            request.onload = function() {\n                if (request.status >= 200 && request.status < 400) {\n                    var imgNode = document.getElementById(\"img-photo\");\n                    imgNode.parentNode.removeChild(imgNode);\n                    inputNode.setAttribute(\"saved-value\", \"\");\n                    inputNode.value = \"\";\n\n                    setSectionCompletionPercentage(findAncestorByClass(inputNode, \"formStep\"));\n                    setPageCompletionPercentage();\n\n                    return false;\n                } else {\n                    // We reached our target server, but it returned an error\n                    deletePhotoContainer.appendChild(deletePhotoButton);\n                    addErrors([\n                        {\n                            name: \"rsr_project.current_image.\" + defaultValues.project_id,\n                            error: defaultValues.file_delete_error\n                        }\n                    ]);\n                    return false;\n                }\n            };\n\n            request.onerror = function() {\n                // There was a connection error of some sort\n                return false;\n            };\n\n            request.send('{\"current_image\": null}');\n        };\n    }\n}\n\nfunction setDeleteDocument(documentInput) {\n    var deleteDocumentButton = documentInput.parentNode.querySelector(\".delete-document\");\n\n    if (deleteDocumentButton !== null) {\n        deleteDocumentButton.onclick = function(e) {\n            e.preventDefault();\n\n            // Remove 'delete' button\n            var deleteDocumentContainer = deleteDocumentButton.parentNode;\n            deleteDocumentContainer.removeChild(deleteDocumentButton);\n\n            // Remove any existing errors\n            var inputNode = deleteDocumentContainer.querySelector(\"input\");\n            findAncestorByClass(inputNode, \"form-group\").classList.remove(\"has-error\");\n            var errorNode = findAncestorByClass(inputNode, \"form-group\").querySelector(\n                \".help-block-error\"\n            );\n            if (errorNode !== null) {\n                errorNode.parentNode.removeChild(errorNode);\n            }\n\n            // Get document ID\n            var documentId = inputNode\n                .getAttribute(\"id\")\n                .split(\".\")\n                .pop();\n\n            // Create request\n            var api_url = \"/rest/v1/project_document/\" + documentId + \"/?format=json\";\n            var request = new XMLHttpRequest();\n            request.open(\"PATCH\", api_url, true);\n            request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n            request.setRequestHeader(\"Content-type\", \"application/json\");\n\n            request.onload = function() {\n                if (request.status >= 200 && request.status < 400) {\n                    var preview = deleteDocumentContainer.querySelector(\".document-preview\");\n                    preview.parentNode.removeChild(preview);\n                    inputNode.setAttribute(\"saved-value\", \"\");\n                    inputNode.value = \"\";\n\n                    setSectionCompletionPercentage(findAncestorByClass(inputNode, \"formStep\"));\n                    setPageCompletionPercentage();\n\n                    return false;\n                } else {\n                    // We reached our target server, but it returned an error\n                    deleteDocumentContainer.appendChild(deleteDocumentButton);\n                    addErrors([\n                        {\n                            name: inputNode.getAttribute(\"id\"),\n                            error: defaultValues.file_delete_error\n                        }\n                    ]);\n                    return false;\n                }\n            };\n\n            request.onerror = function() {\n                // There was a connection error of some sort\n                return false;\n            };\n\n            request.send('{\"document\": null}');\n        };\n    }\n}\n\nfunction replacePhoto(photo) {\n    if (photo !== null) {\n        var img_photo, photo_container, add_html;\n\n        img_photo = document.querySelector(\"#img-photo\");\n\n        if (img_photo !== null) {\n            var delete_link;\n\n            img_photo.parentNode.removeChild(img_photo);\n            delete_link = document.querySelector(\"#delete-photo\");\n\n            if (delete_link !== null) {\n                delete_link.parentNode.removeChild(delete_link);\n            }\n        }\n\n        photo_container = document.querySelector(\"#photo-container\");\n        add_html =\n            '<img src=\"' +\n            photo +\n            '\" class=\"current-project-photo\" id=\"img-photo\"><a class=\"btn btn-link delete-photo-button\" id=\"delete-photo\"><span class=\"glyphicon glyphicon-remove\"></span> Delete photo</a>';\n\n        photo_container.innerHTML = add_html + photo_container.innerHTML;\n\n        setDeletePhoto();\n    }\n}\n\nfunction replaceDocument(documentUrl, documentInput) {\n    if (documentUrl !== null) {\n        var documentContainer = documentInput.parentNode;\n        var documentPreview = documentContainer.querySelector(\".document-preview\");\n\n        if (documentPreview !== null) {\n            var delete_link;\n\n            documentPreview.parentNode.removeChild(documentPreview);\n            delete_link = document.querySelector(\".delete-document\");\n\n            if (delete_link !== null) {\n                delete_link.parentNode.removeChild(delete_link);\n            }\n        }\n\n        var documentUrlNode = document.createElement(\"a\");\n        documentUrlNode.setAttribute(\"class\", \"document-preview\");\n        documentUrlNode.setAttribute(\"target\", \"_blank\");\n        documentUrlNode.setAttribute(\"href\", documentUrl);\n        var documentUrlTextNode = document.createTextNode(defaultValues.uploaded_document);\n        documentUrlNode.appendChild(documentUrlTextNode);\n        documentContainer.appendChild(documentUrlNode);\n\n        var deleteDocumentNode = document.createElement(\"a\");\n        deleteDocumentNode.setAttribute(\"class\", \"delete-document\");\n        var deleteButton = document.createElement(\"span\");\n        deleteButton.setAttribute(\"class\", \"glyphicon glyphicon-remove\");\n        deleteDocumentNode.appendChild(deleteButton);\n        documentContainer.appendChild(deleteDocumentNode);\n\n        setDeleteDocument(documentInput);\n    }\n}\n\nfunction setFileUploads() {\n    var inputs = document.querySelectorAll(\"input\");\n    for (var i = 0; i < inputs.length; i++) {\n        if (inputs[i].type === \"file\") {\n            if (\n                inputs[i].getAttribute(\"id\") ===\n                \"rsr_project.current_image.\" + defaultValues.project_id\n            ) {\n                // Project.current_image uploads\n                inputs[i].onchange = uploadFile(inputs[i], 2, \"photo\");\n                setDeletePhoto();\n            } else {\n                // ProjectDocument.document uploads\n                inputs[i].onchange = uploadFile(inputs[i], 5, \"document\");\n                setDeleteDocument(inputs[i]);\n            }\n        }\n    }\n    return false;\n}\n\nfunction uploadFile(fileInput, maxFileSize, fileType) {\n    return function(e) {\n        e.preventDefault();\n\n        function checkFileSize(file, maxSize) {\n            /* Check the size of a file. MaxSize is specified in MB. */\n            return file.size < maxSize * 1024 * 1024;\n        }\n\n        // Remove error indications\n        var errorHelpNodes = fileInput.parentNode.querySelectorAll(\".help-block-error\");\n        for (var i = 0; i < errorHelpNodes.length; i++) {\n            errorHelpNodes[i].parentNode.removeChild(errorHelpNodes[i]);\n        }\n        fileInput.parentNode.classList.remove(\"has-error\");\n\n        // Get file\n        var file = fileInput.files[0];\n\n        // Check file size first\n        if (!checkFileSize(file, maxFileSize)) {\n            var errorText, uploadFileSize;\n\n            uploadFileSize = file.size / 1024 / 1024;\n\n            errorText = defaultValues.file_size + \": \" + uploadFileSize.toFixed(2) + \" MB. \";\n            errorText += defaultValues.file_size_allowed + \" \" + maxFileSize.toString() + \" MB.\";\n\n            addErrors([\n                {\n                    name: fileInput.getAttribute(\"id\"),\n                    error: errorText\n                }\n            ]);\n            return false;\n        }\n\n        // Check if file is image, supported formats are: jpg, jpeg, png, gif\n        if (fileType === \"photo\" && !file.name.match(/\\.(jpg|jpeg|png|gif)$/i)) {\n            addErrors([\n                {\n                    name: fileInput.getAttribute(\"id\"),\n                    error: defaultValues.image_file_format + \": jpg, jpeg, png, gif\"\n                }\n            ]);\n            return false;\n        }\n\n        var api_url = \"/rest/v1/project/\" + defaultValues.project_id + \"/upload_file/?format=json\";\n\n        var formData = new FormData();\n        formData.append(\"file\", file);\n        formData.append(\"field_id\", fileInput.getAttribute(\"id\"));\n\n        var request = new XMLHttpRequest();\n\n        var progressBarContainer = findAncestorByClass(fileInput, \"form-group\").querySelector(\n            \".file-progress\"\n        );\n\n        if (request.upload) {\n            // Show upload progress bar\n            progressBarContainer.classList.remove(\"hidden\");\n\n            // Upload progress bar\n            request.upload.addEventListener(\n                \"progress\",\n                function(e) {\n                    var progressBar = progressBarContainer.querySelector(\".progress-bar\");\n                    var percentage = parseInt(e.loaded / e.total * 100);\n                    progressBar.setAttribute(\"aria-valuenow\", percentage);\n                    progressBar.style.width = percentage + \"%\";\n                    progressBar.innerHTML = percentage + \"%\";\n                },\n                false\n            );\n        }\n\n        request.open(\"POST\", api_url);\n        request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n\n        request.onload = function() {\n            // Remove upload progress bar\n            progressBarContainer.classList.add(\"hidden\");\n\n            if (request.status >= 200 && request.status < 400) {\n                var response = JSON.parse(request.responseText);\n\n                // Check for errors\n                if (response.errors.length > 0) {\n                    addErrors(response.errors);\n                }\n\n                // Replace saved values and show that it updated\n                for (var i = 0; i < response.changes.length; i++) {\n                    if (fileType === \"photo\") {\n                        // Show photo\n                        replacePhoto(response.changes[i][1]);\n                    } else {\n                        // Show document\n                        replaceDocument(response.changes[i][1], fileInput);\n                    }\n\n                    var formElement = document.getElementById(response.changes[i][0]);\n                    formElement.setAttribute(\"saved-value\", response.changes[i][1]);\n                    successSave(formElement);\n                }\n\n                // Replace field IDs, names and unicode\n                replaceNames(response.rel_objects);\n\n                // Update progress bars\n                var section = findAncestorByClass(fileInput, \"formStep\");\n                setSectionCompletionPercentage(section);\n                setPageCompletionPercentage();\n            } else {\n                // Could not save file\n                addErrors([\n                    {\n                        name: fileInput.getAttribute(\"id\"),\n                        error: defaultValues.save_general_error\n                    }\n                ]);\n            }\n            return false;\n        };\n\n        request.onerror = function() {\n            // Remove progress bar\n            progressBarContainer.classList.add(\"hidden\");\n\n            addErrors([\n                {\n                    name: fileInput.getAttribute(\"id\"),\n                    error: defaultValues.connection_error\n                }\n            ]);\n\n            return false;\n        };\n\n        request.send(formData);\n    };\n}\n\nfunction getTotalBudget() {\n    var api_url, request;\n\n    // Create request\n    api_url = \"/rest/v1/project/\" + defaultValues.project_id + \"/?format=json\";\n\n    request = new XMLHttpRequest();\n    request.open(\"GET\", api_url, true);\n    request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n    request.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n    request.onload = function() {\n        if (request.status >= 200 && request.status < 400) {\n            var response;\n\n            response = JSON.parse(request.responseText);\n            try {\n                replaceTotalBudget(response.budget);\n            } catch (error) {\n                return false;\n            }\n        } else {\n            // We reached our target server, but it returned an error\n            return false;\n        }\n    };\n\n    request.onerror = function() {\n        // There was a connection error of some sort\n        return false;\n    };\n\n    request.send();\n}\n\nfunction returnRemoveButton(parentNode, error) {\n    var container = parentNode.querySelector(\".delete-related-object-container\");\n\n    if (error) {\n        var errorNode = document.createElement(\"div\");\n        errorNode.setAttribute(\"style\", \"color: red; margin-left: 5px;\");\n        errorNode.innerHTML = defaultValues.delete_error;\n        container.appendChild(errorNode);\n    }\n\n    var node = document.createElement(\"a\");\n    node.setAttribute(\"class\", \"delete-related-object\");\n    node.onclick = setRemovePartial(node);\n\n    var trashCan = document.createElement(\"span\");\n    trashCan.setAttribute(\"class\", \"glyphicon glyphicon-trash\");\n\n    node.appendChild(trashCan);\n    container.appendChild(node);\n}\n\nfunction deleteItem(itemId, itemType) {\n    /* Delete an item through the API, and remove the associated related object div. */\n\n    var relatedObjDiv = document.getElementById(itemType + \".\" + itemId);\n    var form = findAncestorByTag(relatedObjDiv, \"form\");\n\n    var request = new XMLHttpRequest();\n    if (itemType === \"keyword\") {\n        request.open(\n            \"DELETE\",\n            \"/rest/v1/project/\" +\n                defaultValues.project_id +\n                \"/remove_keyword/\" +\n                itemId +\n                \"/?format=json\",\n            true\n        );\n    } else {\n        request.open(\"DELETE\", \"/rest/v1/\" + itemType + \"/\" + itemId + \"/?format=json\", true);\n    }\n\n    request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n    request.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n    request.onload = function() {\n        if (request.status >= 200 && request.status < 400) {\n            relatedObjDiv.parentNode.removeChild(relatedObjDiv);\n\n            // Update the budget in case of removed budget\n            if (itemType === \"budget-item\") {\n                getTotalBudget();\n            } else if (itemType === \"result\") {\n                setResultSorting();\n            } else if (itemType === \"indicator\") {\n                setIndicatorSorting();\n            }\n\n            // Update progress bars\n            setPageCompletionPercentage();\n            setAllSectionsCompletionPercentage();\n\n            checkPartnerships();\n\n            return false;\n        } else {\n            // We reached our target server, but it returned an error\n            returnRemoveButton(relatedObjDiv, true);\n            return false;\n        }\n    };\n\n    request.onerror = function() {\n        // There was a connection error of some sort\n        returnRemoveButton(relatedObjDiv, true);\n        return false;\n    };\n\n    request.send();\n}\n\nfunction dismissRemove(noNode) {\n    return function(e) {\n        e.preventDefault();\n        var sureNode = noNode.parentNode;\n        var parentNode = sureNode.parentNode;\n        parentNode.removeChild(sureNode);\n\n        returnRemoveButton(findAncestorByClass(parentNode, \"parent\"), false);\n    };\n}\n\nfunction confirmRemove(yesNode, objId, apiEndpoint) {\n    return function(e) {\n        e.preventDefault();\n        var sureNode = yesNode.parentNode;\n        var parentNode = sureNode.parentNode;\n        parentNode.removeChild(sureNode);\n\n        deleteItem(objId, apiEndpoint);\n    };\n}\n\nfunction setRemovePartial(node) {\n    return function(e) {\n        e.preventDefault();\n\n        var parentDiv = findAncestorByClass(node, \"parent\");\n        var parentParent = parentDiv.parentNode;\n\n        // Id will be in the form of 'related_project.1234' or 'related_project.1234_new-0'\n        var idArray = parentDiv.getAttributeNode(\"id\").value.split(\".\");\n        var apiEndpoint = idArray[0];\n        var objId = idArray[1];\n\n        if (objId.indexOf(\"new\") > -1) {\n            // New object, not saved to the DB, so partial can be directly deleted\n            parentParent.removeChild(parentDiv);\n\n            setPageCompletionPercentage();\n            setAllSectionsCompletionPercentage();\n            checkPartnerships();\n        } else {\n            // Show warning first\n            var parentNode = node.parentNode;\n            parentNode.removeChild(node);\n\n            var sureNode = document.createElement(\"div\");\n            sureNode.setAttribute(\"class\", \"sure-message\");\n            sureNode.innerHTML = defaultValues.sure_message;\n\n            var yesNode = document.createElement(\"a\");\n            yesNode.setAttribute(\"style\", \"color: green; margin-left: 5px;\");\n            yesNode.onclick = confirmRemove(yesNode, objId, apiEndpoint);\n            yesNode.innerHTML = defaultValues.yes;\n\n            var noNode = document.createElement(\"a\");\n            noNode.setAttribute(\"style\", \"color: red; margin-left: 5px;\");\n            noNode.onclick = dismissRemove(noNode);\n            noNode.innerHTML = defaultValues.no;\n\n            sureNode.appendChild(yesNode);\n            sureNode.appendChild(noNode);\n            parentNode.appendChild(sureNode);\n        }\n    };\n}\n\nfunction buildReactComponents(\n    typeaheadOptions,\n    typeaheadCallback,\n    displayOption,\n    selector,\n    childClass,\n    valueId,\n    label,\n    help,\n    filterOption,\n    inputType\n) {\n    var Typeahead,\n        TypeaheadLabel,\n        TypeaheadContainer,\n        selectorTypeahead,\n        selectorClass,\n        inputClass,\n        typeaheadInput;\n    Typeahead = ReactTypeahead.Typeahead;\n\n    if (inputType === \"project\") {\n        typeaheadOptions.forEach(function(o) {\n            o.filterOption = o.id + \" \" + o.title;\n            o.displayOption = o.title + \" (ID: \" + o.id + \")\";\n        });\n        filterOption = \"filterOption\";\n        displayOption = \"displayOption\";\n    } else if (inputType === \"org\") {\n        typeaheadOptions.forEach(function(o) {\n            var newName = getDisplayOption(o.name, o.long_name);\n\n            o.filterOption = o.name + \" \" + o.long_name;\n            o.displayOption = newName;\n        });\n        filterOption = \"filterOption\";\n        displayOption = \"displayOption\";\n    }\n\n    function getDisplayOption(short, long) {\n        if (short === long) {\n            return short;\n        }\n        if (!long) {\n            return short;\n        }\n        return short + \" (\" + long + \")\";\n    }\n    inputClass = \"form-control \" + childClass;\n\n    selectorClass = document.getElementById(selector);\n\n    TypeaheadContainer = React.createClass({\n        getInitialState: function() {\n            return { focusClass: \"inactive\" };\n        },\n\n        onKeyUp: function() {\n            // Only activate the \"add org\" button for typeaheads that are for organisations\n            if (inputType === \"org\") {\n                this.setState({ focusClass: \"active\" });\n            }\n        },\n\n        onBlur: function() {\n            this.setState({ focusClass: \"inactive\" });\n        },\n\n        render: function() {\n            return React.createElement(\n                \"div\",\n                { className: this.state.focusClass },\n                React.createElement(Typeahead, {\n                    placeholder: \"\",\n                    options: typeaheadOptions,\n                    onOptionSelected: typeaheadCallback,\n                    maxVisible: 10,\n                    displayOption: displayOption,\n                    filterOption: filterOption,\n                    childID: selector,\n                    onKeyUp: this.onKeyUp,\n                    onBlur: this.onBlur,\n                    customClasses: {\n                        typeahead: \"\",\n                        input: inputClass,\n                        results: \"\",\n                        listItem: \"\",\n                        token: \"\",\n                        customAdd: \"\"\n                    },\n                    inputProps: {\n                        name: selector,\n                        id: selector\n                    }\n                }),\n                React.createElement(\n                    \"div\",\n                    {\n                        className: \"addOrg\",\n                        onMouseDown: addOrgModal\n                    },\n                    \"+ \" + defaultValues.add_new_organisation\n                )\n            );\n        }\n    });\n\n    var footer = document.querySelector(\"footer\");\n    footer.setAttribute(\"selector\", selector);\n\n    ReactDOM.render(React.createElement(TypeaheadContainer), selectorClass);\n\n    selectorClass.removeAttribute(\"id\");\n\n    typeaheadInput = selectorClass.querySelector(\".typeahead input\");\n    typeaheadInput.setAttribute(\"autocomplete\", \"off\");\n    typeaheadInput.setAttribute(\"id\", selector);\n\n    if (valueId !== null) {\n        for (var i = 0; i < typeaheadOptions.length; i++) {\n            if (parseInt(typeaheadOptions[i].id, 10) == parseInt(valueId, 10)) {\n                var savedResult;\n\n                savedResult = typeaheadOptions[i];\n\n                typeaheadInput.value = savedResult[displayOption];\n                typeaheadInput.setAttribute(\"value\", savedResult.id);\n                if (selectorClass.hasAttribute(\"not-saved\")) {\n                    selectorClass.removeAttribute(\"not-saved\");\n                    typeaheadInput.setAttribute(\"saved-value\", \"\");\n                } else {\n                    typeaheadInput.setAttribute(\"saved-value\", savedResult.id);\n                }\n            }\n        }\n    } else {\n        typeaheadInput.setAttribute(\"saved-value\", \"\");\n    }\n\n    selectorTypeahead = selectorClass.querySelector(\".typeahead\");\n    selectorTypeahead.appendChild(label);\n    selectorTypeahead.appendChild(help);\n    elAddClass(selectorClass, \"has-typeahead\");\n}\n\nfunction updateSectionState(section) {\n    // FIXME: Not all functions called here update just the section state --\n    // some of them update the state everywhere in the page!\n\n    // Check if the section was already updated, and return if so\n    if (elHasClass(section, \"section-state-updated\")) {\n        return;\n    }\n\n    updateAllHelpIcons();\n    markMandatoryFields(section);\n    setHiddenFields(section);\n    checkPartnerships();\n    setAllSectionsCompletionPercentage();\n    setSectionChangeListener(section);\n    setPageCompletionPercentage();\n\n    // Mark section as updated\n    elAddClass(section, \"section-state-updated\");\n}\n\nfunction updateAllSectionState() {\n    document.querySelectorAll(\".myPanel\").forEach(function(section) {\n        updateSectionState(section);\n    });\n}\n\nfunction loadAsync(url, retryCount, retryLimit, callback, forceReloadOrg) {\n    var xmlHttp;\n\n    // If we already have the response cached, don't fetch it again\n    if (responses[url] !== null && !forceReloadOrg) {\n        callback(responses[url]);\n        return;\n    }\n\n    // If the response is in localStorage, don't fetch it again\n    if (localStorageResponses !== null && localStorageResponses !== \"\" && !forceReloadOrg) {\n        if (localStorageResponses[url] !== undefined) {\n            var response = localStorageResponses[url];\n\n            if (isFresh(response.date, MAX_LOCALSTORAGE_AGE)) {\n                callback(response.json);\n                return;\n            }\n        }\n    }\n\n    function isFresh(writeDate, maxAge) {\n        var currentDate, age;\n\n        currentDate = new Date();\n        currentDate = currentDate.getTime();\n        age = currentDate - writeDate;\n\n        return age <= maxAge;\n    }\n\n    xmlHttp = new XMLHttpRequest();\n\n    xmlHttp.onreadystatechange = function() {\n        if (xmlHttp.readyState == XMLHttpRequest.DONE) {\n            if (xmlHttp.status == 200) {\n                var response = JSON.parse(xmlHttp.responseText);\n                responses[url] = response;\n                updateLocalStorage(url, response);\n                callback(response);\n            } else {\n                if (retryCount >= retryLimit) {\n                    // we should load the project list from localstorage here\n                    return false;\n                } else {\n                    retryCount = retryCount + 1;\n                    loadAsync(url, retryCount, retryLimit, callback);\n                }\n            }\n        } else {\n            return false;\n        }\n    };\n\n    xmlHttp.open(\"GET\", url, true);\n    xmlHttp.send();\n}\n\nfunction updateLocalStorage(url, response) {\n    var output, writeDate, lsData;\n\n    if (localStorageResponses === null || localStorageResponses === \"\") {\n        localStorageResponses = {};\n    }\n\n    output = {};\n\n    writeDate = new Date();\n    writeDate = writeDate.getTime();\n    output.date = writeDate;\n    output.json = response;\n\n    localStorageResponses[url] = output;\n\n    lsData = JSON.stringify(localStorageResponses);\n\n    try {\n        localStorage.setItem(localStorageName, lsData);\n    } catch (error) {\n        // Not enough space in local storage\n        localStorage.setItem(localStorageName, JSON.stringify({}));\n    }\n}\n\nfunction processResponse(\n    response,\n    selector,\n    childClass,\n    valueId,\n    label,\n    help,\n    filterOption,\n    inputType\n) {\n    var typeaheadOptions = response.results;\n    var typeaheadCallback = function(option) {\n        var el = document.getElementById(selector);\n        el.setAttribute(\"value\", option.id);\n    };\n    var displayOption = function(option, index) {\n        return option[filterOption];\n    };\n\n    buildReactComponents(\n        typeaheadOptions,\n        typeaheadCallback,\n        displayOption,\n        selector,\n        childClass,\n        valueId,\n        label,\n        help,\n        filterOption,\n        inputType\n    );\n\n    // Clear all old timers to update the section states and setup a new one in a second.\n    clearTimeout(update_section_states_timer);\n    update_section_states_timer = setTimeout(updateAllSectionState, 1000);\n}\n\nfunction getCallback(selector, childClass, valueId, label, help, filterOption, inputType) {\n    var output = function(response) {\n        processResponse(\n            response,\n            selector,\n            childClass,\n            valueId,\n            label,\n            help,\n            filterOption,\n            inputType\n        );\n    };\n\n    return output;\n}\n\nfunction setSubmitOnClicks() {\n    var saveDivs = document.querySelectorAll(\".save-button\");\n\n    for (var i = 0; i < saveDivs.length; i++) {\n        var saveButton = saveDivs[i].querySelector(\"button\");\n        saveButton.addEventListener(\"click\", submitStep(saveButton));\n    }\n}\n\nfunction setPartialOnClicks() {\n    /* Set all onclicks and onchanges of a partial */\n\n    // Set the 'Add new ...' button onclicks\n    for (var i = 0; i < partials.length; i++) {\n        var partial = partials[i];\n        var buttons = document.querySelectorAll(\".add-\" + partial);\n\n        for (var j = 0; j < buttons.length; j++) {\n            var el = buttons[j];\n            var callback;\n\n            if (elHasClass(el, \"has-onclick\")) {\n                // already set the onclick, do nothing\n                continue;\n            }\n\n            callback = addPartial(partial, findAncestorByClass(el, partial + \"-container\"));\n            el.addEventListener(\"click\", callback);\n            elAddClass(el, \"has-onclick\");\n        }\n    }\n\n    // Set the delete object button onclicks\n    var removeLinks = document.querySelectorAll(\".delete-related-object\");\n    for (var k = 0; k < removeLinks.length; k++) {\n        removeLinks[k].onclick = setRemovePartial(removeLinks[k]);\n    }\n\n    // Set the hide or show partial onclick\n    var hidePartials = document.querySelectorAll(\".hide-partial-click\");\n    for (var l = 0; l < hidePartials.length; l++) {\n        hidePartials[l].onclick = togglePartial(hidePartials[l]);\n    }\n\n    var selectInputs = document.querySelectorAll(\"select\");\n    for (var m = 0; m < selectInputs.length; m++) {\n        if (selectInputs[m].getAttribute(\"id\") !== \"progress-bar-select\") {\n            var selectInputId = selectInputs[m].getAttribute(\"id\").split(\".\");\n            // Set the organisation role onchange\n            if (\n                selectInputId[0] == \"rsr_partnership\" &&\n                selectInputId[1] == \"iati_organisation_role\"\n            ) {\n                selectInputs[m].onchange = togglePartner(selectInputs[m]);\n            }\n            // Set the budget item labels onchange\n            if (selectInputId[0] == \"rsr_budgetitem\" && selectInputId[1] == \"label\") {\n                selectInputs[m].onchange = toggleOtherLabel(selectInputs[m]);\n            }\n            if (selectInputId[0] == \"rsr_indicator\" && selectInputId[1] == \"type\") {\n                selectInputs[m].onchange = function(e) {\n                    setMeasureVisibility(e.target);\n                    setDimensionVisibility(e.target);\n                    setLabelsVisibility(e.target);\n                };\n            }\n        }\n    }\n\n    // Set the special info icons\n    var specialInfoIcons = document.querySelectorAll(\".info-icon-special\");\n    for (var n = 0; n < specialInfoIcons.length; n++) {\n        specialInfoIcons[n].onclick = toggleHelpText(specialInfoIcons[n]);\n    }\n\n    // Set the document file upload toggle\n    var documentToggles = document.querySelectorAll(\".document-toggle\");\n    for (var o = 0; o < documentToggles.length; o++) {\n        documentToggles[o].onchange = toggleDocumentUpload(documentToggles[o]);\n    }\n\n    // Set the related project toggle\n    var relatedProjectToggles = document.querySelectorAll(\".related-project-toggle\");\n    for (var p = 0; p < relatedProjectToggles.length; p++) {\n        relatedProjectToggles[p].onchange = toggleRelatedProject(relatedProjectToggles[p]);\n    }\n}\n\nfunction toggleRelatedProject(toggleNode) {\n    /* It is possible to switch between entering an RSR project and an IATI identifier */\n    return function(e) {\n        e.preventDefault();\n\n        var parent = findAncestorByClass(toggleNode, \"parent\");\n        var relatedProjectFormGroup = findAncestorByClass(\n            parent.querySelectorAll(\"input\")[0],\n            \"form-group\"\n        );\n        var iatiIdFormGroup = findAncestorByClass(\n            parent.querySelectorAll(\"input\")[1],\n            \"form-group\"\n        );\n\n        if (toggleNode.checked) {\n            // Show the IATI identifier\n            iatiIdFormGroup.classList.remove(\"hidden\");\n            relatedProjectFormGroup.classList.add(\"hidden\");\n        } else {\n            // Show the URL field\n            iatiIdFormGroup.classList.add(\"hidden\");\n            relatedProjectFormGroup.classList.remove(\"hidden\");\n        }\n    };\n}\n\nfunction toggleDocumentUpload(toggleNode) {\n    /* It is possible to switch between entering a document URL and uploading a file */\n    return function(e) {\n        e.preventDefault();\n\n        var parent = findAncestorByClass(toggleNode, \"parent\");\n        var urlFormGroup = findAncestorByClass(parent.querySelectorAll(\"input\")[0], \"form-group\");\n        var fileFormGroup = findAncestorByClass(parent.querySelectorAll(\"input\")[1], \"form-group\");\n\n        if (toggleNode.checked) {\n            // Show the file upload\n            fileFormGroup.classList.remove(\"hidden\");\n            fileFormGroup.classList.remove(\"always-hidden\");\n            urlFormGroup.classList.add(\"hidden\");\n            urlFormGroup.classList.add(\"always-hidden\");\n        } else {\n            // Show the URL field\n            fileFormGroup.classList.add(\"hidden\");\n            fileFormGroup.classList.add(\"always-hidden\");\n            urlFormGroup.classList.remove(\"hidden\");\n            urlFormGroup.classList.remove(\"always-hidden\");\n        }\n    };\n}\n\nfunction toggleHelpText(helpIconNode) {\n    /* For several help texts we show an info icon (different from those in the labels of fields) */\n    return function(e) {\n        e.preventDefault();\n        if (e.stopPropagation) {\n            e.stopPropagation();\n        } else {\n            e.cancelBubble = true;\n        }\n\n        var toggleNode = document.getElementById(helpIconNode.getAttribute(\"toggleid\"));\n\n        if (toggleNode.classList.contains(\"hidden\")) {\n            toggleNode.classList.remove(\"hidden\");\n            helpIconNode.classList.add(\"activated\");\n        } else {\n            toggleNode.classList.add(\"hidden\");\n            helpIconNode.classList.remove(\"activated\");\n        }\n    };\n}\n\nfunction toggleOtherLabel(selectNode) {\n    /* The 'Other' label for budget items can only be filled in when the budget item is 'Other' */\n    return function(e) {\n        e.preventDefault();\n\n        var parent = findAncestorByClass(selectNode, \"parent\");\n        var nodeIdList = selectNode.getAttribute(\"id\").split(\".\");\n        var labelNodeId = [nodeIdList[0], \"other_extra\", nodeIdList[2]].join(\".\");\n        var labelNode = document.getElementById(labelNodeId);\n\n        if (\n            selectNode.options[selectNode.selectedIndex].text === \"Other\" &&\n            labelNode.hasAttribute(\"disabled\")\n        ) {\n            labelNode.removeAttribute(\"disabled\");\n        } else if (\n            selectNode.options[selectNode.selectedIndex].text !== \"Other\" &&\n            !labelNode.hasAttribute(\"disabled\")\n        ) {\n            labelNode.setAttribute(\"disabled\", \"\");\n            labelNode.value = \"\";\n        }\n    };\n}\n\nfunction checkPartnerships() {\n    /* - Hides the trash can if there's only one partnership.\n    *  - Hides the trash can if removing the partnership will not allow the user to edit anymore.\n    *  - Remove the 'Reporting organisation' option when it is already selected. */\n\n    if (!defaultValues.is_admin) {\n        var partnerContainer = document.getElementById(\"partner-container\");\n        var trashCan;\n\n        if (partnerContainer !== null) {\n            var partnerPartials = partnerContainer.querySelectorAll(\".parent\");\n            if (partnerPartials.length === 1) {\n                // Hides the trash can if there's only one partnership.\n                trashCan = partnerPartials[0].querySelector(\".delete-related-object\");\n                if (!elHasClass(trashCan, \"hidden\")) {\n                    elAddClass(trashCan, \"hidden\");\n                }\n            } else {\n                // Remove the 'Reporting organisation' option when it is already selected.\n                var reportingSelected = false;\n                var options, partialId, roleNode;\n\n                for (var i = 0; i < partnerPartials.length; i++) {\n                    partialId = partnerPartials[i].getAttribute(\"id\").split(\".\")[1];\n                    roleNode = document.getElementById(\n                        \"rsr_partnership.iati_organisation_role.\" + partialId\n                    );\n\n                    if (roleNode.value === \"101\") {\n                        reportingSelected = true;\n                    }\n\n                    trashCan = partnerPartials[i].querySelector(\".delete-related-object\");\n                    if (elHasClass(trashCan, \"hidden\")) {\n                        elRemoveClass(trashCan, \"hidden\");\n                    }\n                }\n\n                if (reportingSelected === true) {\n                    for (var j = 0; j < partnerPartials.length; j++) {\n                        partialId = partnerPartials[j].getAttribute(\"id\").split(\".\")[1];\n                        roleNode = document.getElementById(\n                            \"rsr_partnership.iati_organisation_role.\" + partialId\n                        );\n\n                        if (roleNode.value !== \"101\") {\n                            options = roleNode.querySelectorAll(\"option\");\n                            for (var k = 0; k < options.length; k++) {\n                                if (options[k].getAttribute(\"value\") === \"101\") {\n                                    options[k].parentNode.removeChild(options[k]);\n                                }\n                            }\n                        }\n                    }\n                } else {\n                    for (var l = 0; l < partnerPartials.length; l++) {\n                        partialId = partnerPartials[l].getAttribute(\"id\").split(\".\")[1];\n                        roleNode = document.getElementById(\n                            \"rsr_partnership.iati_organisation_role.\" + partialId\n                        );\n                        var hasReportingOption = false;\n\n                        options = roleNode.querySelectorAll(\"option\");\n                        for (var m = 0; m < options.length; m++) {\n                            if (options[m].getAttribute(\"value\") === \"101\") {\n                                hasReportingOption = true;\n                            }\n                        }\n\n                        if (hasReportingOption === false) {\n                            var reportingOption = document.createElement(\"option\");\n                            reportingOption.setAttribute(\"value\", \"101\");\n                            var reportingOptionText = document.createTextNode(\n                                defaultValues.reporting_org\n                            );\n                            reportingOption.appendChild(reportingOptionText);\n                            roleNode.appendChild(reportingOption);\n                        }\n                    }\n                }\n\n                // Hides the trash can if removing the partnership will not allow the user to edit anymore.\n                var partnerNodes = [];\n                for (var n = 0; n < partnerPartials.length; n++) {\n                    var partnerIdNode = partnerPartials[n].querySelector(\".typeahead\");\n                    if (partnerIdNode !== null) {\n                        var partnerId = partnerIdNode\n                            .querySelector(\"input\")\n                            .getAttribute(\"saved-value\");\n                        if (defaultValues.org_permissions.indexOf(parseInt(partnerId)) > -1) {\n                            partnerNodes.push(\n                                partnerPartials[n].querySelector(\".delete-related-object\")\n                            );\n                        }\n                    }\n                }\n                if (partnerNodes.length === 1 && !elHasClass(partnerNodes[0], \"hidden\")) {\n                    elAddClass(partnerNodes[0], \"hidden\");\n                } else if (partnerNodes.length > 1) {\n                    for (var o = 0; o < partnerNodes.length; o++) {\n                        if (elHasClass(partnerNodes[o], \"hidden\")) {\n                            elRemoveClass(partnerNodes[o], \"hidden\");\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction togglePartner(selectNode) {\n    /* The funding amount can only be filled in when a partner is a funding partner\n     * The secondary reporter can only be filled in when a partner is a reporting partner */\n    return function(e) {\n        e.preventDefault();\n\n        var parent = findAncestorByClass(selectNode, \"parent\");\n        var nodeIdList = selectNode.getAttribute(\"id\").split(\".\");\n\n        var fundingNodeId = [nodeIdList[0], \"funding_amount\", nodeIdList[2]].join(\".\");\n        var fundingNode = document.getElementById(fundingNodeId);\n        var fundingFormGroup = findAncestorByClass(fundingNode, \"form-group\");\n\n        var secondaryNodeId = [nodeIdList[0], \"is_secondary_reporter\", nodeIdList[2]].join(\".\");\n        var secondaryNode = document.getElementById(secondaryNodeId);\n        var secondaryFormGroup = findAncestorByClass(secondaryNode, \"form-group\");\n\n        if (selectNode.value !== \"101\") {\n            if (selectNode.value === \"1\" && fundingNode.hasAttribute(\"disabled\")) {\n                fundingNode.removeAttribute(\"disabled\");\n            } else if (selectNode.value !== \"1\") {\n                fundingNode.setAttribute(\"disabled\", \"\");\n                fundingNode.value = \"\";\n            }\n            if (elHasClass(fundingFormGroup, \"hidden\")) {\n                elRemoveClass(fundingFormGroup, \"hidden\");\n                elRemoveClass(fundingFormGroup, \"always-hidden\");\n                elAddClass(secondaryFormGroup, \"hidden\");\n                elAddClass(secondaryFormGroup, \"always-hidden\");\n            }\n        } else if (elHasClass(secondaryFormGroup, \"hidden\")) {\n            elRemoveClass(secondaryFormGroup, \"hidden\");\n            elRemoveClass(secondaryFormGroup, \"always-hidden\");\n            elAddClass(fundingFormGroup, \"hidden\");\n            elAddClass(fundingFormGroup, \"always-hidden\");\n        }\n\n        checkPartnerships();\n        markMandatoryFields(parent);\n    };\n}\n\nfunction setMeasureVisibility(indicatorTypeSelect) {\n    /*\n        Show or hide measure fields depending on indicator type\n     */\n    // parent is the div wrapping one whole indicator form, it's the outer node in\n    // related_objects/indicator_input.html\n    var parent = findAncestorByClass(indicatorTypeSelect, \"parent\");\n    var measureRow = parent.getElementsByClassName(\"measure\")[0];\n    // hide measure fields for qualitative indicators\n    if (indicatorTypeSelect.value === \"2\") {\n        elAddClass(measureRow, \"hidden\");\n        // HACK: To deal with mandatory fields, we set indicator measure to be\n        // Unit for qualitative indicators automatically.\n        measureRow.querySelector(\"select\").selectedIndex = 1;\n    } else {\n        elRemoveClass(measureRow, \"hidden\");\n    }\n}\n\nfunction setLabelsVisibility(indicatorTypeSelect) {\n    var parent = findAncestorByClass(indicatorTypeSelect, \"parent\");\n    var labelsContainer = parent.getElementsByClassName(\"indicator-label-container\")[0].parentNode;\n    // hide measure fields for qualitative indicators\n    if (indicatorTypeSelect.value !== \"2\") {\n        elAddClass(labelsContainer, \"label-hidden\");\n    } else {\n        elRemoveClass(labelsContainer, \"label-hidden\");\n    }\n}\n\nfunction setDimensionVisibility(indicatorTypeSelect) {\n    /*\n       Show or hide dimension fields depending on indicator type\n     */\n    // parent is the div wrapping one whole indicator form, it's the outer node in\n    // related_objects/indicator_input.html\n    var parent = findAncestorByClass(indicatorTypeSelect, \"parent\"),\n        dimensionDiv = parent.querySelector(\".indicator-dimension-container\"),\n        relatedContainer = dimensionDiv.parentElement;\n    // hide indicator dimension fields for qualitative indicators\n    if (indicatorTypeSelect.value === \"2\") {\n        elAddClass(dimensionDiv, \"hidden\");\n        elAddClass(relatedContainer, \"hidden\");\n    } else {\n        elRemoveClass(dimensionDiv, \"hidden\");\n        elRemoveClass(relatedContainer, \"hidden\");\n    }\n}\n\nfunction togglePartial(hidePartial) {\n    return function(e) {\n        e.preventDefault();\n\n        var partialToHide, foldedIndicator, fold;\n\n        partialToHide = hidePartial.parentNode.parentNode.getElementsByClassName(\"hide-partial\")[0];\n        foldedIndicator = hidePartial.getElementsByClassName(\"folded-sign\")[0];\n\n        if (foldedIndicator.innerHTML === \"-\") {\n            foldedIndicator.innerHTML = \"+\";\n            partialToHide.className += \" hidden\";\n        } else {\n            foldedIndicator.innerHTML = \"-\";\n            partialToHide.className = partialToHide.className.replace(\"hidden\", \"\");\n        }\n    };\n}\n\nfunction updatePartialIDs(partial, newID) {\n    /* Function that updates all IDs and names of a partial to the new ID\n     * Fields will be in the form of '<model_name>.<field_name>.<new_ID>'\n     * The general ID will be in the form of '<model_name>.<new_ID>' */\n\n    // Set general ID of the partial\n    var oldIdList = partial.getAttribute(\"id\").split(\".\");\n    partial.setAttribute(\"id\", [oldIdList[0], newID].join(\".\"));\n\n    // Replace names and IDs of all input, select and textarea fields\n    var partialInputs = partial.querySelectorAll(INPUT_ELEMENTS.join());\n    for (var j = 0; j < partialInputs.length; j++) {\n        if (\n            partialInputs[j].type !== \"checkbox\" &&\n            partialInputs[j].className.indexOf(\"masquerade-field\") === -1\n        ) {\n            var oldFieldIdList = partialInputs[j].getAttribute(\"id\").split(\".\");\n            partialInputs[j].setAttribute(\n                \"id\",\n                [oldFieldIdList[0], oldFieldIdList[1], newID].join(\".\")\n            );\n            partialInputs[j].setAttribute(\n                \"name\",\n                [oldFieldIdList[0], oldFieldIdList[1], newID].join(\".\")\n            );\n        }\n    }\n\n    // Replace names and IDs of all typeahead fields\n    var typeaheadContainers = partial.querySelectorAll(\".typeahead-container\");\n    for (var k = 0; k < typeaheadContainers.length; k++) {\n        // Update the data-child-id attribute\n        var oldChildIdList = typeaheadContainers[k].getAttribute(\"data-child-id\").split(\".\");\n        var oldTypeaheadId = oldChildIdList[2];\n        typeaheadContainers[k].setAttribute(\n            \"data-child-id\",\n            [oldChildIdList[0], oldChildIdList[1], newID].join(\".\")\n        );\n\n        // Update the parent's id\n        typeaheadContainers[k].setAttribute(\n            \"id\",\n            [oldChildIdList[0], oldChildIdList[1], newID].join(\".\")\n        );\n\n        var typeaheadParent = typeaheadContainers[k].parentNode;\n        var typeaheadParentClassList = typeaheadParent.classList;\n        for (var l = 0; l < typeaheadParentClassList.length; l++) {\n            if (typeaheadParentClassList[l].indexOf(oldTypeaheadId) > -1) {\n                typeaheadParentClassList.add(\n                    [oldChildIdList[0], oldChildIdList[1], newID].join(\"_\")\n                );\n                typeaheadParentClassList.remove(typeaheadParentClassList[l]);\n            }\n        }\n\n        // Update the data-child-class attribute\n        var childClassList = typeaheadContainers[k]\n            .getAttribute(\"data-child-class\")\n            .trim()\n            .split(\" \");\n        for (var m = 0; m < childClassList.length; m++) {\n            if (childClassList[m].indexOf(oldTypeaheadId) > -1) {\n                var newChildClass = [oldChildIdList[0], oldChildIdList[1], newID].join(\"_\");\n                childClassList.splice(m, 1);\n                childClassList.push(newChildClass);\n                break;\n            }\n        }\n        typeaheadContainers[k].setAttribute(\"data-child-class\", childClassList.join(\" \"));\n    }\n\n    // Replace IDs of all date fields\n    var dateContainers = partial.querySelectorAll(\".datepicker-container\");\n    for (var n = 0; n < dateContainers.length; n++) {\n        // Update the data-id attribute\n        var oldDataIdList = dateContainers[n].getAttribute(\"data-id\").split(\".\");\n        dateContainers[n].setAttribute(\n            \"data-id\",\n            [oldDataIdList[0], oldDataIdList[1], newID].join(\".\")\n        );\n    }\n}\n\nfunction addPartial(partialName, partialContainer) {\n    return function(e) {\n        e.preventDefault();\n\n        function findInHierachy(hierarchy, partialName) {\n            /* Find the partial in the hierarchy, and return the depth with the remaining\n             * partials in a list. Returns [-1, false] if not found. */\n            for (var i = 0; i < hierarchy.length; i++) {\n                for (var j = 0; j < hierarchy[i].length; j++) {\n                    if (hierarchy[i][j] === partialName) {\n                        hierarchy[i].splice(0, j + 1);\n                        return [j + 1, hierarchy[i]];\n                    }\n                }\n            }\n\n            return [-1, false];\n        }\n\n        // Indicate the hierarchy of partials\n        var partialHierarchy = [\n            [\"result\", \"indicator\", \"indicator-period\", \"indicator-period-actual-dimension\"],\n            [\"result\", \"indicator\", \"indicator-period\", \"indicator-period-actual-location\"],\n            [\"result\", \"indicator\", \"indicator-period\", \"indicator-period-target-dimension\"],\n            [\"result\", \"indicator\", \"indicator-period\", \"indicator-period-target-location\"],\n            [\"result\", \"indicator\", \"indicator-dimension\"],\n            [\"result\", \"indicator\", \"indicator-label\"],\n            [\"result\", \"indicator\", \"indicator-reference\"],\n            [\"transaction\", \"transaction-sector\"],\n            [\"project-location\", \"location-administrative\"],\n            [\"document\", \"document-category\"],\n            [\"crs-add\", \"crsadd-other-flag\"],\n            [\"fss\", \"fss-forecast\"]\n        ];\n\n        // Get partial from partial templates and add it to DOM\n        var markupSelector = \"#\" + partialName + \"-input\";\n        var partialString = document.querySelector(markupSelector).innerHTML;\n        var domParser = new DOMParser();\n        var partial = domParser\n            .parseFromString(partialString, \"text/html\")\n            .querySelector(\".parent\");\n\n        // Add partial to container, before the 'Add new ..' row\n        var addRow = partialContainer.querySelector(\".add-\" + partialName).parentNode.parentNode;\n        partialContainer.insertBefore(partial, addRow);\n\n        // Fetch the number of times the partial is already in the document, and add the count\n        // to \"new-\" to create the new partial id\n        var newID = \"new-\" + document.querySelectorAll(\".\" + partialName + \"-item\").length;\n\n        // Look for the partial in the hierarchy\n        var hierarchyList = findInHierachy(partialHierarchy, partialName);\n\n        // Always update the partial's ID itself first\n        var oldPartialID = partial.getAttribute(\"id\").split(\".\")[1];\n        newID = oldPartialID.substring(0, oldPartialID.length - 5) + newID;\n        updatePartialIDs(partial, newID);\n\n        var childContainer, relatedObjCount;\n        if (hierarchyList[0] === 1) {\n            // First level, with more related objects underneath, update second level\n            childContainer = partial.querySelector(\".parent\");\n            relatedObjCount = document.querySelectorAll(\".\" + hierarchyList[1][0] + \"-item\").length;\n            var childId = [newID, \"new-\" + relatedObjCount.toString()].join(\"_\");\n            updatePartialIDs(childContainer, childId);\n\n            // Check if there is a third level\n            if (hierarchyList[1].length > 1) {\n                var childChildContainers = childContainer.querySelectorAll(\".parent\");\n                var childRelatedObjCount = document.querySelectorAll(\n                    \".\" + hierarchyList[1][1] + \"-item\"\n                ).length;\n                for (var i = 0; i < childChildContainers.length; i++) {\n                    updatePartialIDs(\n                        childChildContainers[i],\n                        [childId, \"new-\" + childRelatedObjCount.toString()].join(\"_\")\n                    );\n\n                    // Check if there is a fourth level\n                    if (hierarchyList[1].length > 2) {\n                        var childChildChildContainers = childChildContainers[i].querySelectorAll(\n                            \".parent\"\n                        );\n                        var childChildRelatedObjCount = document.querySelectorAll(\n                            \".\" + hierarchyList[1][2] + \"-item\"\n                        ).length;\n                        for (var j = 0; j < childChildChildContainers.length; j++) {\n                            updatePartialIDs(\n                                childChildChildContainers[j],\n                                [\n                                    childId,\n                                    \"new-\" + childRelatedObjCount.toString(),\n                                    \"new-\" + childChildRelatedObjCount.toString()\n                                ].join(\"_\")\n                            );\n                        }\n                    }\n                }\n            }\n        } else if (hierarchyList[0] > 1) {\n            // Second, third or fourth level: fetch the ID from the parent item and add the new ID to it\n            parentContainer = findAncestorByClass(partialContainer, \"parent\");\n            parentID = parentContainer.getAttribute(\"id\").split(\".\")[1];\n            newID = \"new-\" + document.querySelectorAll(\".\" + partialName + \"-item\").length;\n            if (parentID.indexOf(\"_\") > -1) {\n                // Parent ID + new ID\n                newID = [parentID, newID].join(\"_\");\n            } else {\n                if (hierarchyList[0] === 2) {\n                    // Parent ID is e.g. \"5\", but child ID must be \"1205_5_new-1\"\n                    newID = [defaultValues.project_id, parentID, newID].join(\"_\");\n                } else {\n                    // Parent ID is e.g. \"5\", but child ID must be \"1205_15_5_new-1\"\n                    var parentParentContainer = findAncestorByClass(parentContainer, \"parent\");\n                    var parentParentID = parentParentContainer.getAttribute(\"id\").split(\".\")[1];\n                    newID = [defaultValues.project_id, parentParentID, parentID, newID].join(\"_\");\n                }\n            }\n            updatePartialIDs(partial, newID);\n\n            // Check if there is a third level (only possible on level 2)\n            if (hierarchyList[1].length > 0) {\n                var childContainers = partial.querySelectorAll(\".parent\");\n                relatedObjCount = document.querySelectorAll(\".\" + hierarchyList[1][0] + \"-item\")\n                    .length;\n                for (var k = 0; k < childContainers.length; k++) {\n                    updatePartialIDs(\n                        childContainers[k],\n                        [newID, \"new-\" + relatedObjCount.toString()].join(\"_\")\n                    );\n\n                    // Check if there is a fourth level\n                    if (hierarchyList[1].length > 1) {\n                        var childOfChildContainers = childContainers[k].querySelectorAll(\".parent\");\n                        var childOfRelatedObjCount = document.querySelectorAll(\n                            \".\" + hierarchyList[1][1] + \"-item\"\n                        ).length;\n                        for (var l = 0; l < childOfChildContainers.length; l++) {\n                            updatePartialIDs(\n                                childOfChildContainers[l],\n                                [\n                                    newID,\n                                    \"new-\" + relatedObjCount.toString(),\n                                    \"new-\" + childOfRelatedObjCount.toString()\n                                ].join(\"_\")\n                            );\n                        }\n                    }\n                }\n            }\n        }\n\n        // Update the currency\n        var projectCurrencyDropdown = document.getElementById(\n                \"rsr_project.currency.\" + defaultValues.project_id\n            ),\n            currencyDisplays = partial.querySelectorAll(\".currency-display\"),\n            projectCurrency = \"EUR\";\n        if (projectCurrencyDropdown !== null) {\n            projectCurrency = projectCurrencyDropdown.value;\n        }\n        for (var m = 0; m < currencyDisplays.length; m++) {\n            currencyDisplays[m].innerHTML = projectCurrency;\n        }\n\n        var parentContainer, parentID;\n\n        // Update the typeaheads, datepickers and currency fields\n        updateTypeaheads();\n        setDatepickers();\n        setPeriodMasqueradeDates();\n        setCurrencyOnChange();\n        setVocabularyOnChange();\n\n        // Update help icons and progress bars\n        updateHelpIcons(\".\" + partialName + \"-container\");\n        setPageCompletionPercentage();\n        setAllSectionsCompletionPercentage();\n        setAllSectionsChangeListener();\n        setValidationListeners();\n\n        // Set onClicks for partials again in case this partial contains other partials\n        setPartialOnClicks();\n        setFileUploads();\n        checkPartnerships();\n    };\n}\n\nfunction updateTypeahead(els, filterOption, labelText, helpText, API, inputType, forceReloadOrg) {\n    function getLoadAsync(\n        childSelector,\n        childClass,\n        valueId,\n        label,\n        help,\n        filterOption,\n        inputType,\n        forceReloadOrg\n    ) {\n        return function() {\n            loadAsync(\n                API,\n                0,\n                MAX_RETRIES,\n                getCallback(\n                    childSelector,\n                    childClass,\n                    valueId,\n                    label,\n                    help,\n                    filterOption,\n                    inputType\n                ),\n                forceReloadOrg\n            );\n        };\n    }\n\n    for (var i = 0; i < els.length; i++) {\n        var el = els[i];\n\n        // Check if we've already rendered this typeahead\n        if (elHasClass(el, \"has-typeahead\")) {\n            if (forceReloadOrg) {\n                // Remove the existing typeahead, then build a new one with the reloaded API response\n                var child = el.querySelector(\"div\");\n                el.removeChild(child);\n                el.setAttribute(\"id\", el.getAttribute(\"data-child-id\"));\n            } else {\n                // Typeahead exists and we don't need to reload the API response. Do nothing.\n                continue;\n            }\n        }\n\n        var childSelector = el.getAttribute(\"data-child-id\");\n        var childClass = el.getAttribute(\"data-child-class\");\n        var valueId = null;\n        var label = document.createElement(\"label\");\n        var help = document.createElement(\"p\");\n\n        label.setAttribute(\"for\", childSelector);\n        elAddClass(label, \"control-label\");\n        elAddClass(label, \"typeahead-label\");\n        label.textContent = labelText;\n\n        elAddClass(help, \"help-block\");\n        elAddClass(help, \"hidden\");\n        help.textContent = helpText;\n\n        if (el.getAttribute(\"data-value\") !== \"\") {\n            valueId = el.getAttribute(\"data-value\");\n        }\n\n        var cb = getLoadAsync(\n            childSelector,\n            childClass,\n            valueId,\n            label,\n            help,\n            filterOption,\n            inputType,\n            forceReloadOrg\n        );\n        cb();\n    }\n}\n\nfunction updateProjectTypeaheads() {\n    var els, filterOption, labelText, helpText, API, inputType;\n\n    els = document.querySelectorAll(\".rsr_relatedproject-related_project\");\n    labelText = defaultValues.related_project_label;\n    helpText = defaultValues.related_project_helptext;\n    filterOption = \"title\";\n    API = projectsAPIUrl;\n    inputType = \"project\";\n\n    updateTypeahead(els, filterOption, labelText, helpText, API, inputType);\n}\n\nfunction updateOrganisationTypeaheads(forceReloadOrg) {\n    var els, filterOption, labelText, helpText, API, inputType;\n\n    els = document.querySelectorAll(\".rsr_partnership-organisation\");\n    labelText = defaultValues.partner_label;\n    helpText = defaultValues.partner_helptext;\n    filterOption = \"name\";\n    API = orgsAPIUrl;\n    inputType = \"org\";\n    updateTypeahead(els, filterOption, labelText, helpText, API, inputType, forceReloadOrg);\n\n    els = document.querySelectorAll(\".rsr_transaction-provider_organisation\");\n    labelText = defaultValues.provider_org_label;\n    helpText = defaultValues.provider_org_helptext;\n    filterOption = \"name\";\n    API = orgsAPIUrl;\n    inputType = \"org\";\n    updateTypeahead(els, filterOption, labelText, helpText, API, inputType, forceReloadOrg);\n\n    els = document.querySelectorAll(\".rsr_transaction-receiver_organisation\");\n    labelText = defaultValues.recipient_org_label;\n    helpText = defaultValues.recipient_org_helptext;\n    filterOption = \"name\";\n    API = orgsAPIUrl;\n    inputType = \"org\";\n    updateTypeahead(els, filterOption, labelText, helpText, API, inputType, forceReloadOrg);\n\n    els = document.querySelectorAll(\".rsr_planneddisbursement-provider_organisation\");\n    labelText = defaultValues.provider_org_label;\n    helpText = defaultValues.provider_org_helptext;\n    filterOption = \"name\";\n    API = orgsAPIUrl;\n    inputType = \"org\";\n    updateTypeahead(els, filterOption, labelText, helpText, API, inputType, forceReloadOrg);\n\n    els = document.querySelectorAll(\".rsr_planneddisbursement-receiver_organisation\");\n    labelText = defaultValues.recipient_org_label;\n    helpText = defaultValues.recipient_org_helptext;\n    filterOption = \"name\";\n    API = orgsAPIUrl;\n    inputType = \"org\";\n    updateTypeahead(els, filterOption, labelText, helpText, API, inputType, forceReloadOrg);\n}\n\nfunction updateTypeaheads(forceReloadOrg) {\n    updateOrganisationTypeaheads(forceReloadOrg);\n    updateProjectTypeaheads();\n}\n\nfunction updateHelpIcons(container) {\n    /* Add an \"info\" glyphicon to each label and clicking the glyphicon shows the help text */\n    var labels = document.querySelectorAll(container + \" label.control-label\");\n\n    for (var i = 0; i < labels.length; i++) {\n        var label = labels[i];\n        var output, helpBlockIsLabelSibling, iconClasses, helpBlockFromLabel;\n\n        if (elHasClass(label, \"has-icon\")) {\n            // We've already processed this label. Do nothing.\n            continue;\n        }\n\n        // Assume that the help block is a sibling of the label element\n        helpBlockIsLabelSibling = true;\n        var numHelpBlocks = label.parentNode.querySelectorAll(\".help-block\").length;\n        var numParentHelpBlocks = label.parentNode.parentNode.querySelectorAll(\".help-block\")\n            .length;\n\n        if (numHelpBlocks === 0) {\n            if (numParentHelpBlocks === 1) {\n                helpBlockIsLabelSibling = false;\n            } else {\n                // There is no help block for this label\n                continue;\n            }\n        }\n\n        if (helpBlockIsLabelSibling) {\n            helpBlockFromLabel = label.parentNode.querySelector(\".help-block\");\n        } else {\n            helpBlockFromLabel = label.parentNode.parentNode.querySelector(\".help-block\");\n        }\n\n        iconClasses = [\"glyphicon\", \"glyphicon-info-sign\", \"info-icon\"];\n\n        if (elIsVisible(helpBlockFromLabel)) {\n            iconClasses.push(\"activated\");\n        }\n\n        output = document.createElement(\"span\");\n\n        for (var k = 0; k < iconClasses.length; k++) {\n            elAddClass(output, iconClasses[k]);\n        }\n\n        label.appendChild(output);\n\n        var infoIcons = label.querySelectorAll(\".info-icon\");\n\n        for (var j = 0; j < infoIcons.length; j++) {\n            infoIcons[j].onclick = getInfoIconListener(infoIcons[j], helpBlockIsLabelSibling);\n        }\n\n        // Mark the label as processed to avoid adding extra help icons to it later\n        elAddClass(label, \"has-icon\");\n    }\n}\n\nfunction getInfoIconListener(el, helpBlockIsLabelSibling) {\n    return function(e) {\n        e.preventDefault();\n\n        var helpBlock;\n        if (helpBlockIsLabelSibling) {\n            helpBlock = el.parentNode.parentNode.querySelector(\".help-block\");\n        } else {\n            helpBlock = el.parentNode.parentNode.parentNode.querySelector(\".help-block\");\n        }\n\n        if (elHasClass(el, \"activated\")) {\n            // Hide the helpblock\n            elRemoveClass(el, \"activated\");\n            helpBlock.style.display = \"none\";\n        } else {\n            // Show the helpblock\n            elAddClass(el, \"activated\");\n            if (elHasClass(helpBlock, \"hidden\")) {\n                elRemoveClass(helpBlock, \"hidden\");\n            }\n            helpBlock.style.display = \"block\";\n        }\n    };\n}\n\nfunction updateAllHelpIcons() {\n    var pageContainer;\n\n    pageContainer = \".projectEdit\";\n    updateHelpIcons(pageContainer);\n}\n\nfunction getValidationSets() {\n    /* Get the validation sets of the page */\n    return document\n        .getElementById(\"progress-bar\")\n        .getAttribute(\"validation-sets\")\n        .split(\"-\");\n}\n\nfunction inputCompleted(field) {\n    if (\n        field.getAttribute(\"name\") === \"rsr_project.iati_status.\" + defaultValues.project_id &&\n        field.value === \"0\"\n    ) {\n        // Do not count project status 'None'\n        return false;\n    } else if (field.type === \"checkbox\") {\n        // Do not count checkboxes\n        return false;\n    } else if (field.type === \"file\" && field.getAttribute(\"saved-value\") !== \"\") {\n        // Custom code for file inputs\n        return true;\n    } else if (field.value !== \"\") {\n        return true;\n    }\n    return false;\n}\n\nfunction partialFilled(parentNode) {\n    var inputElements = parentNode.querySelectorAll(INPUT_ELEMENTS.join());\n    for (var j = 0; j < inputElements.length; j++) {\n        if (inputCompleted(inputElements[j])) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction shouldBeHidden(el) {\n    /* A field should be hidden when all selected validation sets have set the field to hidden */\n    var validationSets = getValidationSets();\n    var hideAccordingToValidationSet = [];\n\n    for (var i = 0; i < validationSets.length; i++) {\n        var validationSet = validationSets[i];\n\n        if (elHasClass(el, \"hidden-\" + validationSet)) {\n            // Check if the field itself should be hidden\n            hideAccordingToValidationSet.push(validationSet);\n        } else {\n            // Check if the parent object(s) should be hidden\n            var relatedObject = findAncestorByClass(el, \"related-object-container\");\n            while (relatedObject !== null) {\n                if (elHasClass(relatedObject, \"hidden-\" + validationSet)) {\n                    hideAccordingToValidationSet.push(validationSet);\n                    relatedObject = null;\n                } else {\n                    relatedObject = findAncestorByClass(relatedObject, \"related-object-container\");\n                }\n            }\n        }\n    }\n\n    return validationSets.length === hideAccordingToValidationSet.length;\n}\n\nfunction setHiddenFields(parent) {\n    /* Hide fields based on the selected validation sets. */\n\n    parent = parent || document;\n\n    // Check per field if it should be hidden or not\n    var allElements = parent.querySelectorAll(INPUT_ELEMENTS.join());\n    for (var j = 0; j < allElements.length; j++) {\n        var formGroupNode = findAncestorByClass(allElements[j], \"form-group\");\n        if (formGroupNode !== null) {\n            if (!(shouldBeHidden(allElements[j]) || elHasClass(formGroupNode, \"always-hidden\"))) {\n                elRemoveClass(formGroupNode, \"hidden\");\n            } else {\n                elAddClass(formGroupNode, \"hidden\");\n            }\n        }\n    }\n\n    // Also check the related objects if they should be hidden or not\n    var relatedObjectContainers = parent.querySelectorAll(\".related-object-container\");\n    for (var k = 0; k < relatedObjectContainers.length; k++) {\n        var relatedObjectContainer = relatedObjectContainers[k];\n        if (!shouldBeHidden(relatedObjectContainer)) {\n            elRemoveClass(relatedObjectContainer, \"hidden\");\n        } else {\n            elAddClass(relatedObjectContainer, \"hidden\");\n        }\n    }\n\n    // Finally, even check the sections if they should be hidden or not\n    // FIXME: If called with a section, this may not be required, but leaving\n    // this as it is, for now.\n    var sections = document.querySelectorAll(\".myPanel\");\n    for (var l = 0; l < sections.length; l++) {\n        var section = sections[l];\n        if (!shouldBeHidden(section)) {\n            elRemoveClass(section, \"hidden\");\n        } else {\n            elAddClass(section, \"hidden\");\n        }\n    }\n}\n\nfunction setSectionCompletionPercentage(section) {\n    var inputResults = getInputResults(section);\n    var numInputs = inputResults[0];\n    var numInputsCompleted = inputResults[1];\n\n    if (numInputs === 0) {\n        // There are no mandatory fields, show the section as complete\n        renderCompletionPercentage(1, 1, section);\n        return;\n    }\n\n    renderCompletionPercentage(numInputsCompleted, numInputs, section);\n}\n\nfunction setPageCompletionPercentage() {\n    var inputResults = getInputResults(document.querySelector(\".projectEdit\"));\n    var numInputs = inputResults[0];\n    var numInputsCompleted = inputResults[1];\n    var completionPercentage = renderCompletionPercentage(\n        numInputsCompleted,\n        numInputs,\n        document.querySelector(\".progress-and-publish\")\n    );\n\n    // Don't mess with the Publish button if you're not allowed to publish!\n    if (defaultValues.can_create_projects) {\n        var publishButton = document.getElementById(\"publishProject\");\n        if (publishButton !== null) {\n            if (\n                completionPercentage !== 100 &&\n                publishButton.getAttribute(\"status\") === \"unpublished\"\n            ) {\n                publishButton.setAttribute(\"disabled\", \"\");\n            } else {\n                publishButton.removeAttribute(\"disabled\");\n            }\n        }\n    }\n}\n\nfunction getInputResults(section) {\n    function getOrField(field) {\n        var validationSets = getValidationSets();\n\n        for (var i = 0; i < validationSets.length; i++) {\n            var orValidation = \"mandatory-\" + validationSets[i] + \"-or-\";\n            var fieldClassList = field.classList;\n\n            for (var j = 0; j < fieldClassList.length; j++) {\n                if (fieldClassList[j].indexOf(orValidation) > -1) {\n                    var otherFieldName = fieldClassList[j].replace(orValidation, \"\");\n                    var fieldIdList = field.getAttribute(\"id\").split(\".\");\n                    var otherFieldId = [fieldIdList[0], otherFieldName, fieldIdList[2]].join(\".\");\n                    return document.getElementById(otherFieldId);\n                }\n            }\n        }\n\n        return null;\n    }\n\n    var numInputs = 0;\n    var numInputsCompleted = 0;\n    var processedFields = [];\n    var mandatoryFields = section.querySelectorAll(\"span.mandatory\");\n\n    for (var i = 0; i < mandatoryFields.length; i++) {\n        // Ignore the 'OR' indications\n        if (elHasClass(mandatoryFields[i], \"mandatory-block\")) {\n            continue;\n        }\n\n        var formGroup = findAncestorByClass(mandatoryFields[i], \"form-group\");\n\n        if (formGroup === null) {\n            // Mandatory partial\n            var parent = findAncestorByClass(mandatoryFields[i], \"parent\");\n            if (parent !== null) {\n                if (partialFilled(parent)) {\n                    numInputs += 1;\n                }\n            } else {\n                numInputs += 1;\n            }\n\n            var underlyingPartials = findAncestorByClass(\n                mandatoryFields[i],\n                \"related-object-container\"\n            ).querySelectorAll(\".parent\");\n            for (var l = 0; l < underlyingPartials.length; l++) {\n                var partialParentNode = underlyingPartials[l];\n                if (partialFilled(partialParentNode)) {\n                    numInputsCompleted += 1;\n                    break;\n                }\n            }\n        } else {\n            // 'Normal' mandatory field\n            var field = null;\n\n            for (var j = 0; j < INPUT_ELEMENTS.length; j++) {\n                field = formGroup.querySelector(INPUT_ELEMENTS[j]);\n                if (field !== null) {\n                    break;\n                }\n            }\n\n            if (field === null) {\n                // No input field found (should not occur)\n                continue;\n            }\n\n            if (field.getAttribute(\"disabled\") !== null) {\n                // Ignore disabled fields\n                continue;\n            }\n\n            var parentNode = findAncestorByClass(field, \"parent\");\n            if (parentNode !== null && !partialFilled(parentNode)) {\n                // Ignore fields in underlying empty partials\n                continue;\n            }\n\n            numInputs += 1;\n\n            // Check if there is an 'Or' mandatory field\n            var orField = getOrField(field);\n            if (orField === null) {\n                // Regular processing, check if the input is completed\n                if (inputCompleted(field)) {\n                    numInputsCompleted += 1;\n                }\n            } else {\n                // There is an 'Or' mandatory field specified\n                if (processedFields.indexOf(orField) > -1) {\n                    if (inputCompleted(orField)) {\n                        // The 'Or' field has already been processed and was filled\n                        numInputsCompleted += 1;\n                    } else if (inputCompleted(field)) {\n                        // The 'Or' field has already been processed and was not filled, but this\n                        // field is, so add 2 inputs completed\n                        numInputsCompleted += 2;\n                    }\n                } else {\n                    // Regular processing, check if the input is completed\n                    if (inputCompleted(field)) {\n                        numInputsCompleted += 1;\n                    }\n                }\n            }\n\n            processedFields.push(field);\n        }\n    }\n\n    return [numInputs, numInputsCompleted];\n}\n\nfunction renderCompletionPercentage(numInputsCompleted, numInputs, section) {\n    var completionPercentage, completionClass, publishButton;\n\n    completionPercentage = Math.floor(numInputsCompleted / numInputs * 100);\n    if (completionPercentage === 0) {\n        // Never show an empty bar\n        completionPercentage = 1;\n    }\n\n    section.querySelector(\".progress-bar\").setAttribute(\"aria-valuenow\", completionPercentage);\n    section.querySelector(\".progress .sr-only\").textContent = completionPercentage + \"% Complete\";\n    section.querySelector(\"div.progress-bar\").style.width = completionPercentage + \"%\";\n\n    if (completionPercentage < 10) {\n        completionClass = \"empty\";\n    } else if (completionPercentage < 100) {\n        completionClass = \"incomplete\";\n    } else if (completionPercentage === 100) {\n        completionClass = \"complete\";\n    }\n\n    section.querySelector(\"div.progress-bar\").setAttribute(\"data-completion\", completionClass);\n\n    return completionPercentage;\n}\n\nfunction setSectionChangeListener(section) {\n    var elements = section.querySelectorAll(INPUT_ELEMENTS.join());\n\n    for (var y = 0; y < elements.length; y++) {\n        var listener;\n        var el = elements[y];\n\n        if (elHasClass(el, \"has-listener\")) {\n            // We have already added a class for this listener\n            // do nothing\n            continue;\n        }\n\n        listener = getChangeListener(section, el);\n        el.addEventListener(\"change\", listener);\n    }\n}\n\nfunction getChangeListener(section, el) {\n    return function() {\n        var currentSection;\n        currentSection = section;\n\n        setSectionCompletionPercentage(currentSection);\n        elAddClass(el, \"has-listener\");\n        setPageCompletionPercentage();\n        markMandatoryFields(findAncestorByClass(el, \"parent\") || section);\n    };\n}\n\nfunction setAllSectionsCompletionPercentage() {\n    var formSteps = document.querySelectorAll(\".formStep\");\n\n    for (var i = 0; i < formSteps.length; i++) {\n        setSectionCompletionPercentage(formSteps[i]);\n    }\n}\n\nfunction setAllSectionsChangeListener() {\n    var formSteps = document.querySelectorAll(\".formStep\");\n\n    for (var i = 0; i < formSteps.length; i++) {\n        setSectionChangeListener(formSteps[i]);\n    }\n}\n\nfunction markMandatoryOrField(element, otherField) {\n    /* Mark a field as an OR mandatory field */\n    var formGroupNode = findAncestorByClass(element, \"form-group\");\n\n    // Check if mandatory node already exists\n    if (formGroupNode.querySelector(\"span.mandatory-block\") === null) {\n        var markContainer = document.createElement(\"span\");\n        markContainer.setAttribute(\"class\", \"mandatory-block mandatory\");\n        markContainer.textContent =\n            \"*\" +\n            defaultValues.or_mandatory_1 +\n            \" \" +\n            otherField +\n            \" \" +\n            defaultValues.or_mandatory_2 +\n            \".\";\n        formGroupNode.appendChild(markContainer);\n    }\n}\n\nfunction markMandatoryField(element) {\n    /* Mark a field as mandatory */\n    var formGroupNode = findAncestorByClass(element, \"form-group\");\n\n    var elementLabel;\n    if (formGroupNode !== null) {\n        elementLabel = formGroupNode.querySelector(\"label\");\n    } else {\n        // This happens for mandatory related objects\n        elementLabel = element.querySelector(\"h5\");\n    }\n\n    // Check if mandatory node already exists\n    if (elementLabel.querySelector(\"span.mandatory\") === null) {\n        var markContainer = document.createElement(\"span\");\n        markContainer.setAttribute(\"class\", \"mandatory\");\n        markContainer.textContent = \"*\";\n        elementLabel.appendChild(markContainer);\n    }\n}\n\nfunction markMandatoryFields(parent) {\n    /* Mark mandatory fields with an asterisk */\n\n    parent = parent || document;\n\n    // Clear any existing markers\n    var existingMarkers = parent.querySelectorAll(\".mandatory:not(.in-org-modal)\");\n    for (var i = 0; i < existingMarkers.length; i++) {\n        existingMarkers[i].parentNode.removeChild(existingMarkers[i]);\n    }\n\n    // Mark the new elements\n    var validationSets = getValidationSets();\n    for (var j = 0; j < validationSets.length; j++) {\n        var mandatoryIndicator = \".mandatory-\" + validationSets[j];\n        var elementsToMark = parent.querySelectorAll(mandatoryIndicator);\n        for (var k = 0; k < elementsToMark.length; k++) {\n            if (\n                !elementsToMark[k].hasAttribute(\"disabled\") &&\n                !findAncestorByClass(elementsToMark[k], \"always-hidden\") &&\n                (!hasParent(elementsToMark[k]) ||\n                    partialFilled(findAncestorByClass(elementsToMark[k], \"parent\")) ||\n                    (hasParent(elementsToMark[k]) &&\n                        elHasClass(\n                            findAncestorByClass(elementsToMark[k], \"related-object-container\"),\n                            \"mandatory-\" + validationSets[j]\n                        )))\n            ) {\n                markMandatoryField(elementsToMark[k]);\n\n                var mandatoryOrClass = mandatoryIndicator.replace(\".\", \"\") + \"-or-\";\n                var fieldClassList = elementsToMark[k].classList;\n                for (var l = 0; l < fieldClassList.length; l++) {\n                    if (fieldClassList[l].indexOf(mandatoryOrClass) > -1) {\n                        var otherFieldId = fieldClassList[l].replace(mandatoryOrClass, \"\");\n                        var otherFieldName = otherFieldId.replace(/_/g, \" \");\n                        var element = elementsToMark[k];\n                        var idComponents = element.id.split(\".\");\n                        var otherElement = document.querySelector(\n                            \"#\" + [idComponents[0], otherFieldId, idComponents[2]].join(\"\\\\.\")\n                        );\n                        // Mark mandatory or fields only if both the fields are\n                        // empty. This behavior is slightly different than how\n                        // the * marks for mandatory fields works, but adding\n                        // the text even when the mandatory requirements are\n                        // fulfilled can often be confusing.\n                        if (element.value === \"\" && otherElement.value === \"\") {\n                            markMandatoryOrField(element, otherFieldName);\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction setValidationListeners() {\n    /* Validate all inputs with the given class and display validation status to the user\n     * in real time */\n    function getLengthListener(el) {\n        return function() {\n            var maxLength, currentLength, charsLeft, charMessage;\n\n            maxLength = parseInt(el.getAttribute(\"maxlength\"), 10);\n            currentLength = el.value.length;\n            charsLeft = maxLength - currentLength;\n            charMessage = \"\";\n\n            if (el.parentNode.querySelectorAll(\".charsLeft\").length === 0) {\n                var child = document.createElement(\"span\");\n                elAddClass(child, \"charsLeft\");\n                el.parentNode.appendChild(child);\n            }\n\n            if (charsLeft === 1) {\n                charMessage = \" character remaining\";\n            } else {\n                charMessage = \" characters remaining\";\n            }\n\n            el.parentNode.querySelector(\".charsLeft\").style.display = \"\";\n            el.parentNode.querySelector(\".charsLeft\").textContent = charsLeft + charMessage;\n        };\n    }\n\n    function getHideCharsListener(el) {\n        var parent = el.parentNode;\n        var output;\n        var outputTimeout;\n\n        output = function() {\n            var charsLeft = parent.querySelector(\".charsLeft\");\n            if (charsLeft) {\n                charsLeft.style.display = \"none\";\n            }\n        };\n\n        outputTimeout = function() {\n            setTimeout(output, 250);\n        };\n\n        return outputTimeout;\n    }\n\n    var inputs = document.querySelectorAll(\"input\");\n    var textareas = document.querySelectorAll(\"textarea\");\n    var inputListener, focusOutListener;\n\n    for (var i = 0; i < inputs.length; i++) {\n        var input = inputs[i];\n\n        if (elHasClass(input, \"validation-listener\")) {\n            // We've already set the listener for this element, do nothing\n            continue;\n        }\n\n        // Max character counts for text inputs\n        if (input.getAttribute(\"type\") === \"text\" && input.hasAttribute(\"maxlength\")) {\n            inputListener = getLengthListener(input);\n            focusOutListener = getHideCharsListener(input);\n            input.addEventListener(\"input\", inputListener);\n            input.addEventListener(\"focusout\", focusOutListener);\n        }\n    }\n\n    for (var j = 0; j < textareas.length; j++) {\n        var textarea = textareas[j];\n\n        if (elHasClass(textarea, \"validation-listener\")) {\n            // We've already set the listener for this element, do nothing\n            continue;\n        }\n\n        // Max character counts for textareas\n        if (textarea.hasAttribute(\"maxlength\")) {\n            inputListener = getLengthListener(textarea);\n            focusOutListener = getHideCharsListener(textarea);\n            textarea.addEventListener(\"input\", inputListener);\n            textarea.addEventListener(\"focusout\", focusOutListener);\n        }\n    }\n\n    markMandatoryFields();\n    setHiddenFields();\n}\n\nfunction setCurrencyOnChange() {\n    var currencyDropdown = document.getElementById(\n        \"rsr_project.currency.\" + defaultValues.project_id\n    );\n\n    if (currencyDropdown !== null) {\n        currencyDropdown.onchange = updateCurrency(currencyDropdown);\n    }\n\n    var currencyDropdowns = document.querySelectorAll(\".currency-select\");\n    for (var i = 0; i < currencyDropdowns.length; i++) {\n        var otherCurrencyDropdown = currencyDropdowns[i];\n        if (otherCurrencyDropdown !== currencyDropdown) {\n            otherCurrencyDropdown.onchange = updateObjectCurrency(otherCurrencyDropdown);\n        }\n    }\n}\n\nfunction hasObjectCurrency(currencyDisplay) {\n    if (currencyDisplay !== null) {\n        var parent = findAncestorByClass(currencyDisplay, \"parent\");\n        if (parent !== null) {\n            var currencyNode = parent.querySelector(\".currency-select\");\n            if (currencyNode !== null) {\n                return currencyNode.value !== \"\";\n            }\n        }\n    }\n    return false;\n}\n\nfunction updateCurrency(currencyDropdown) {\n    return function(e) {\n        e.preventDefault();\n\n        var newCurrency = currencyDropdown.value;\n        var currencyDisplays = document.querySelectorAll(\".currency-display\");\n\n        for (var i = 0; i < currencyDisplays.length; i++) {\n            var currencyDisplay = currencyDisplays[i];\n            if (!hasObjectCurrency(currencyDisplay)) {\n                currencyDisplay.innerHTML = newCurrency;\n            }\n        }\n    };\n}\n\nfunction updateObjectCurrency(currencyDropdown) {\n    return function(e) {\n        e.preventDefault();\n\n        if (currencyDropdown !== null) {\n            var parent = findAncestorByClass(currencyDropdown, \"parent\"),\n                newCurrency = currencyDropdown.value;\n\n            if (newCurrency === \"\") {\n                var projectCurrencyDropdown = document.getElementById(\n                    \"rsr_project.currency.\" + defaultValues.project_id\n                );\n                if (projectCurrencyDropdown !== null) {\n                    newCurrency = projectCurrencyDropdown.value;\n                }\n            }\n\n            if (parent !== null) {\n                var currencyDisplays = parent.querySelectorAll(\".currency-display\");\n                for (var i = 0; i < currencyDisplays.length; i++) {\n                    var currencyDisplay = currencyDisplays[i];\n                    if (currencyDisplay !== null) {\n                        currencyDisplay.innerHTML = newCurrency;\n                    }\n                }\n            }\n        }\n    };\n}\n\nfunction setVocabularyOnChange() {\n    var fieldInfo = [\n        {\n            selector: \".sector-vocabulary\",\n            optionsId: \"sector-vocabulary-options\",\n            textInputSelector: \".sector-code-text-input\",\n            dropDownInputSelector: \".sector-code-dropdown-input\"\n        },\n        {\n            selector: \".default-aid-type-vocabulary\",\n            optionsId: \"aid-type-vocabulary-options\",\n            textInputSelector: \".aid-type-text-input\",\n            dropDownInputSelector: \".aid-type-dropdown-input\"\n        },\n        {\n            selector: \".transaction-aid-type-vocabulary\",\n            optionsId: \"aid-type-vocabulary-options\",\n            textInputSelector: \".aid-type-text-input\",\n            dropDownInputSelector: \".aid-type-dropdown-input\"\n        }\n    ];\n    fieldInfo.map(function(info) {\n        var vocabularyFields = document.querySelectorAll(info.selector);\n\n        for (var i = 0; i < vocabularyFields.length; i++) {\n            vocabularyFields[i].querySelector(\"select\").onchange = vocabularyOnChange(\n                vocabularyFields[i],\n                info\n            );\n            codeFieldSwitcher(\n                vocabularyFields[i],\n                info.optionsId,\n                info.textInputSelector,\n                info.dropDownInputSelector\n            );\n        }\n    });\n}\n\nfunction vocabularyOnChange(vocabularyField, info) {\n    return function(e) {\n        e.preventDefault();\n        codeFieldSwitcher(\n            vocabularyField,\n            info.optionsId,\n            info.textInputSelector,\n            info.dropDownInputSelector\n        );\n    };\n}\n\nfunction codeFieldSwitcher(vocabularyField, optionsId, textInputSelector, dropDownInputSelector) {\n    var selectField = vocabularyField.getElementsByTagName(\"select\")[0];\n    var vocabularyValue = selectField.options[selectField.selectedIndex].value;\n    var allOptions = JSON.parse(document.getElementById(optionsId).innerHTML);\n    var options = allOptions[vocabularyValue];\n    var textInputField = vocabularyField.parentNode.querySelector(textInputSelector);\n    var dropDownInputField = vocabularyField.parentNode.querySelector(dropDownInputSelector);\n\n    if (options) {\n        dropDownInputField.classList.remove(\"hidden\");\n        textInputField.classList.add(\"hidden\");\n        var codeSelectField = dropDownInputField.querySelector(\"select\");\n        // Remove existing options\n        codeSelectField.options.length = 0;\n        // Create empty option\n        createSelectOption(codeSelectField, \"\", \"\");\n        // Create other options\n        for (var key in options) {\n            createSelectOption(codeSelectField, key, options[key]);\n        }\n        setSelectedValue(codeSelectField, codeSelectField.getAttribute(\"saved-value\"));\n    } else {\n        textInputField.classList.remove(\"hidden\");\n        dropDownInputField.classList.add(\"hidden\");\n    }\n}\n\nfunction createSelectOption(selectField, value, text) {\n    var optionField = document.createElement(\"option\");\n    optionField.text = text;\n    optionField.value = value;\n    selectField.add(optionField);\n}\n\nfunction setSelectedValue(selectField, value) {\n    for (var i = 0; i < selectField.options.length; i++) {\n        if (selectField.options[i].value == value) {\n            selectField.selectedIndex = i;\n        }\n    }\n}\n\n// add arrow buttons to each indicator\nfunction setIndicatorSorting() {\n    var indicatorContainers = document.querySelectorAll(\".indicator-container\");\n\n    for (var i = 0; i < indicatorContainers.length; i++) {\n        var indicatorSections = indicatorContainers[i].querySelectorAll(\n            '.indicator-item:not([id*=\"new\"])'\n        );\n\n        for (var j = 0; j < indicatorSections.length; j++) {\n            setReorderButtons(indicatorSections[j], \"indicator\", j, indicatorSections.length);\n\n            if (!indicatorSections[j].classList.contains(\"default-period-buttons-set\")) {\n                setDefaultPeriodButtons(indicatorSections[j]);\n            }\n        }\n    }\n}\n\n// add arrow buttons to each result\nfunction setResultSorting() {\n    var resultSections = document.querySelectorAll('.result-item:not([id*=\"new\"])');\n\n    for (var i = 0; i < resultSections.length; i++) {\n        setReorderButtons(resultSections[i], \"result\", i, resultSections.length);\n    }\n}\n\nfunction setReorderButtons(itemNode, itemType, itemIndex, listLength) {\n    var itemId = itemNode.getAttribute(\"id\").split(\".\")[1];\n\n    if (itemNode.classList.contains(\"sort-buttons-set\")) {\n        if (itemIndex === 0 || listLength < 2) {\n            itemNode.querySelector(\".sort-up\").setAttribute(\"class\", \"sort-up hidden\");\n        } else {\n            itemNode.querySelector(\".sort-up\").setAttribute(\"class\", \"sort-up\");\n        }\n        if (itemIndex == listLength - 1 || listLength < 2) {\n            itemNode.querySelector(\".sort-down\").setAttribute(\"class\", \"sort-down hidden\");\n        } else {\n            itemNode.querySelector(\".sort-down\").setAttribute(\"class\", \"sort-down\");\n        }\n    } else {\n        var sortItemNode = document.createElement(\"span\");\n        itemNode.className += \" sort-buttons-set\";\n\n        var sortItemUp = document.createElement(\"a\");\n        var upButton = document.createElement(\"span\");\n        upButton.style = \"margin-right: 10px; font-size: 80%;\";\n\n        if (itemIndex === 0 || listLength < 2) {\n            upButton.setAttribute(\"class\", \"sort-up hidden\");\n            upButton.innerHTML = defaultValues.move_up;\n        } else {\n            upButton.setAttribute(\"class\", \"sort-up\");\n            upButton.innerHTML = defaultValues.move_up;\n        }\n\n        if (itemType == \"indicator\") {\n            upButton.onclick = reorderItems(\"indicator\", itemId, \"up\");\n        } else if (itemType == \"result\") {\n            upButton.onclick = reorderItems(\"result\", itemId, \"up\");\n        }\n\n        sortItemUp.appendChild(upButton);\n\n        var sortItemDown = document.createElement(\"a\");\n        var downButton = document.createElement(\"span\");\n        downButton.style = \"margin-right: 10px; font-size: 80%;\";\n\n        if (itemIndex == listLength - 1 || listLength < 2) {\n            downButton.setAttribute(\"class\", \"sort-down hidden\");\n            downButton.innerHTML = defaultValues.move_down;\n        } else {\n            downButton.setAttribute(\"class\", \"sort-down\");\n            downButton.innerHTML = defaultValues.move_down;\n        }\n\n        if (itemType == \"indicator\") {\n            downButton.onclick = reorderItems(\"indicator\", itemId, \"down\");\n        } else if (itemType == \"result\") {\n            downButton.onclick = reorderItems(\"result\", itemId, \"down\");\n        }\n\n        sortItemDown.appendChild(downButton);\n\n        sortItemNode.appendChild(sortItemUp);\n        sortItemNode.appendChild(sortItemDown);\n\n        var itemContainer = itemNode.querySelector(\".delete-related-object-container\");\n        itemContainer.insertBefore(sortItemNode, itemContainer.childNodes[0]);\n    }\n}\n\nfunction reorderItems(itemType, itemId, direction) {\n    return function(e) {\n        e.preventDefault();\n        var api_url, request;\n\n        var form_data =\n            \"item_type=\" + itemType + \"&item_id=\" + itemId + \"&item_direction=\" + direction;\n\n        // Create request\n        api_url = \"/rest/v1/project/\" + defaultValues.project_id + \"/reorder_items/?format=json\";\n\n        request = new XMLHttpRequest();\n        request.open(\"POST\", api_url, true);\n        request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n        request.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n        request.onload = function() {\n            if (request.status >= 200 && request.status < 400) {\n                var response = JSON.parse(request.responseText);\n                if (response.swap_id > -1) {\n                    swapReorderedItems(itemType, itemId, response.swap_id, direction);\n                } else {\n                    console.log(response.errors);\n                }\n            } else {\n                // We reached our target server, but it returned an error\n                return false;\n            }\n        };\n\n        request.onerror = function() {\n            // There was a connection error of some sort\n            return false;\n        };\n\n        request.send(form_data);\n    };\n}\n\nfunction swapReorderedItems(itemType, itemId, swapId, direction) {\n    var selectedItem = document.getElementById(itemType + \".\" + itemId);\n    var swapItem = document.getElementById(itemType + \".\" + swapId);\n    var parentContainer = selectedItem.parentNode;\n\n    if (direction == \"up\") {\n        parentContainer.insertBefore(selectedItem, swapItem);\n\n        // update buttons if necessary\n        if (parentContainer.firstElementChild == selectedItem) {\n            selectedItem.querySelector(\".sort-up\").className += \" hidden\";\n            elRemoveClass(swapItem.querySelector(\".sort-up\"), \"hidden\");\n        }\n        if (parentContainer.lastElementChild.previousElementSibling == swapItem) {\n            elRemoveClass(selectedItem.querySelector(\".sort-down\"), \"hidden\");\n            swapItem.querySelector(\".sort-down\").className += \" hidden\";\n        }\n    } else if (direction == \"down\") {\n        parentContainer.insertBefore(swapItem, selectedItem);\n\n        // update buttons if necessary\n        if (parentContainer.firstElementChild == swapItem) {\n            elRemoveClass(selectedItem.querySelector(\".sort-up\"), \"hidden\");\n            swapItem.querySelector(\".sort-up\").className += \" hidden\";\n        }\n        if (parentContainer.lastElementChild.previousElementSibling == selectedItem) {\n            selectedItem.querySelector(\".sort-down\").className += \" hidden\";\n            elRemoveClass(swapItem.querySelector(\".sort-down\"), \"hidden\");\n        }\n    }\n}\n\n// add buttons to set default indicator periods\nfunction setDefaultPeriodButtons(indicatorNode) {\n    indicatorId = indicatorNode.getAttribute(\"id\").split(\".\")[1];\n\n    var defaultPeriodNode = document.createElement(\"span\");\n    defaultPeriodNode.setAttribute(\"class\", \"default-period-container\");\n\n    var addButton = document.createElement(\"a\");\n    addButton.setAttribute(\"class\", \"default-period-add\");\n    addButton.innerHTML = defaultValues.set_default;\n    addButton.onclick = promptCopyDefaultPeriods(defaultPeriodNode, indicatorId);\n\n    var removeButton = document.createElement(\"a\");\n    removeButton.setAttribute(\"class\", \"default-period-remove\");\n    removeButton.innerHTML = defaultValues.remove_default;\n    removeButton.onclick = removeDefaultPeriods(defaultPeriodNode, indicatorId);\n\n    if (defaultValues.default_indicator === \"-1\") {\n        removeButton.classList.add(\"hidden\");\n    } else {\n        if (indicatorId == defaultValues.default_indicator) {\n            addButton.classList.add(\"hidden\");\n        } else {\n            addButton.classList.add(\"hidden\");\n            removeButton.classList.add(\"hidden\");\n        }\n    }\n\n    defaultPeriodNode.appendChild(addButton);\n    defaultPeriodNode.appendChild(removeButton);\n\n    var indicatorContainer = indicatorNode.querySelector(\".delete-related-object-container\");\n    indicatorContainer.insertBefore(defaultPeriodNode, indicatorContainer.childNodes[0]);\n\n    indicatorNode.className += \" default-period-buttons-set\";\n}\n\n// ask if defaults should be copied to existing indicators\nfunction promptCopyDefaultPeriods(defaultPeriodNode, indicatorId) {\n    return function(e) {\n        e.preventDefault();\n\n        defaultPeriodNode.querySelector(\".default-period-add\").classList.add(\"hidden\");\n\n        var confirmContainer = document.createElement(\"span\");\n        confirmContainer.setAttribute(\"class\", \"default-confirm-container\");\n\n        var confirmText = document.createElement(\"span\");\n        confirmText.innerHTML = defaultValues.add_to_existing;\n\n        var yesButton = document.createElement(\"a\");\n        yesButton.setAttribute(\"class\", \"default-yes-button\");\n        yesButton.innerHTML = defaultValues.yes;\n        yesButton.onclick = setDefaultPeriods(defaultPeriodNode, indicatorId, true);\n\n        var noButton = document.createElement(\"a\");\n        noButton.setAttribute(\"class\", \"default-no-button\");\n        noButton.innerHTML = defaultValues.no;\n        noButton.onclick = setDefaultPeriods(defaultPeriodNode, indicatorId, false);\n\n        confirmContainer.appendChild(confirmText);\n        confirmContainer.appendChild(yesButton);\n        confirmContainer.appendChild(noButton);\n        defaultPeriodNode.appendChild(confirmContainer);\n    };\n}\n\nfunction setDefaultPeriods(defaultPeriodNode, indicatorId, addExisting) {\n    return function(e) {\n        e.preventDefault();\n\n        var indicatorNode = defaultPeriodNode.parentNode;\n        indicatorNode.classList.add(\"default-indicator\");\n\n        defaultPeriodNode.querySelector(\".default-confirm-container\").classList.add(\"hidden\");\n\n        if (addExisting === true) {\n            var refreshText = document.createElement(\"span\");\n            refreshText.innerHTML = defaultValues.refresh_periods;\n            defaultPeriodNode.appendChild(refreshText);\n\n            submitDefaultPeriods(indicatorId, true, true);\n        } else {\n            defaultPeriodNode.querySelector(\".default-period-remove\").classList.remove(\"hidden\");\n\n            submitDefaultPeriods(indicatorId, false, true);\n        }\n\n        // hide all other default add buttons\n        var defaultButtons = document.querySelectorAll(\".default-period-add\");\n        for (var i = 0; i < defaultButtons.length; i++) {\n            defaultButtons[i].classList.add(\"hidden\");\n        }\n    };\n}\n\nfunction removeDefaultPeriods(defaultPeriodNode, indicatorId) {\n    return function(e) {\n        e.preventDefault();\n\n        defaultPeriodNode.querySelector(\".default-period-remove\").classList.add(\"hidden\");\n        submitDefaultPeriods(indicatorId, false, false);\n\n        // show all default add buttons\n        var defaultButtons = document.querySelectorAll(\".default-period-add\");\n        for (var i = 0; i < defaultButtons.length; i++) {\n            defaultButtons[i].classList.remove(\"hidden\");\n        }\n    };\n}\n\nfunction submitDefaultPeriods(indicatorId, copy, setDefault) {\n    var api_url, request;\n\n    var form_data = \"indicator_id=\" + indicatorId + \"&copy=\" + copy + \"&set_default=\" + setDefault;\n\n    // Create request\n    api_url = \"/rest/v1/project/\" + defaultValues.project_id + \"/default_periods/?format=json\";\n\n    request = new XMLHttpRequest();\n    request.open(\"POST\", api_url, true);\n    request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n    request.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n    request.onload = function() {\n        if (request.status >= 200 && request.status < 400) {\n            var response = JSON.parse(request.responseText);\n            console.log(\"submitDefaultPeriods response: \" + JSON.stringify(response));\n            // TODO: dispay error when there was an error\n            if (response.default_periods) {\n                defaultValues.default_indicator = indicatorId;\n            } else {\n                defaultValues.default_indicator = \"-1\";\n            }\n        } else {\n            // We reached our target server, but it returned an error\n            return false;\n        }\n    };\n\n    request.onerror = function() {\n        // There was a connection error of some sort\n        return false;\n    };\n\n    request.send(form_data);\n}\n\nfunction setToggleSectionOnClick() {\n    var toggleSections = document.getElementsByClassName(\"toggleSection\");\n    var projectOptions = document.querySelector(\".formOverviewInfo\");\n    var projectProgress = document.querySelector(\".formProgress\");\n\n    for (var i = 0; i < toggleSections.length; i++) {\n        toggleSections[i].onclick = toggleSection(toggleSections[i]);\n    }\n\n    if (projectOptions !== null) {\n        var optionsPanelHeading = projectOptions.querySelector(\".panel-heading\");\n        optionsPanelHeading.onclick = showHidePanel(optionsPanelHeading.parentNode);\n    }\n\n    if (projectProgress !== null) {\n        var progressPanelHeading = projectProgress.querySelector(\".panel-heading\");\n        progressPanelHeading.onclick = showHidePanel(progressPanelHeading.parentNode);\n    }\n}\n\nfunction showHidePanel(panel) {\n    return function(e) {\n        e.preventDefault();\n\n        var panelBody = panel.querySelector(\".panel-body\");\n        if (!elHasClass(panelBody, \"hidden\")) {\n            elAddClass(panelBody, \"hidden\");\n        } else {\n            elRemoveClass(panelBody, \"hidden\");\n        }\n    };\n}\n\nfunction toggleSection(node) {\n    return function(e) {\n        e.preventDefault();\n\n        var allFormBlocks, allSections, div, formBlock, infoIcon, inputStep;\n\n        div = node.parentNode.parentNode;\n        allFormBlocks = document.getElementsByClassName(\"formBlock\");\n        allSections = document.getElementsByClassName(\"toggleSection\");\n        formBlock = div.getElementsByClassName(\"formBlock\")[0];\n        inputStep = div.getElementsByTagName(\"input\")[0];\n        infoIcon = node.getElementsByClassName(\"info-icon\")[0];\n\n        if (formBlock.className.indexOf(\"hidden\") > -1) {\n            formBlock.className = formBlock.className.replace(\"hidden\", \"\");\n            inputStep.checked = true;\n            div.scrollIntoView();\n            window.scrollBy(0, -100);\n            for (var i = 0; i < allFormBlocks.length; i++) {\n                if (\n                    allFormBlocks[i] !== formBlock &&\n                    allFormBlocks[i].className.indexOf(\"hidden\") === -1\n                ) {\n                    allFormBlocks[i].className += \" hidden\";\n                }\n            }\n            for (var j = 0; j < allSections.length; j++) {\n                var sectionInfoIcon = allSections[j].getElementsByClassName(\"info-icon\")[0];\n                if (sectionInfoIcon.className.indexOf(\"hidden\") === -1) {\n                    sectionInfoIcon.className += \" hidden\";\n                }\n            }\n            if (infoIcon.className.indexOf(\"hidden\") > -1) {\n                infoIcon.className = infoIcon.className.replace(\"hidden\", \"\");\n            }\n            updateSectionState(div);\n        } else {\n            formBlock.className += \" hidden\";\n            infoIcon.className += \" hidden\";\n        }\n    };\n}\n\nfunction setPrivateProject() {\n    // Set private project switch\n    var privateProject = document.getElementById(\"private-project\");\n    if (privateProject !== null) {\n        privateProject.onchange = privateProjectSwitch(privateProject);\n    }\n}\n\nfunction privateProjectSwitch(privateProject) {\n    return function(e) {\n        e.preventDefault();\n\n        var api_url = \"/rest/v1/project/\" + defaultValues.project_id + \"/?format=json\";\n\n        var request = new XMLHttpRequest();\n        request.open(\"PATCH\", api_url, true);\n        request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n        request.setRequestHeader(\"Content-type\", \"application/json\");\n\n        request.onload = function() {\n            if (request.status >= 200 && request.status < 400) {\n                if (privateProject.hasAttribute(\"checked\")) {\n                    privateProject.removeAttribute(\"checked\");\n                } else {\n                    privateProject.setAttribute(\"checked\", \"\");\n                }\n            }\n        };\n\n        var changePrivate = privateProject.hasAttribute(\"checked\")\n            ? '{\"is_public\": true}'\n            : '{\"is_public\": false}';\n\n        request.send(changePrivate);\n    };\n}\n\nfunction setImpactProject() {\n    // Set RSR Impact switch\n    var impactProject = document.getElementById(\"impact-project\");\n    if (impactProject !== null) {\n        impactProject.onchange = impactProjectSwitch(impactProject);\n    }\n\n    // Set import button\n    var importButton = document.getElementById(\"import-results\");\n    if (importButton !== null) {\n        importButton.onclick = getImportResults(importButton);\n    }\n}\n\nfunction impactProjectSwitch(impactProject) {\n    return function(e) {\n        e.preventDefault();\n\n        var api_url = \"/rest/v1/project/\" + defaultValues.project_id + \"/?format=json\";\n\n        var request = new XMLHttpRequest();\n        request.open(\"PATCH\", api_url, true);\n        request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n        request.setRequestHeader(\"Content-type\", \"application/json\");\n\n        request.onload = function() {\n            if (request.status >= 200 && request.status < 400) {\n                if (impactProject.hasAttribute(\"checked\")) {\n                    impactProject.removeAttribute(\"checked\");\n                } else {\n                    impactProject.setAttribute(\"checked\", \"\");\n                }\n            }\n        };\n\n        var changeImpact = impactProject.hasAttribute(\"checked\")\n            ? '{\"is_impact_project\": false}'\n            : '{\"is_impact_project\": true}';\n\n        request.send(changeImpact);\n    };\n}\n\nfunction getImportResults(importButton) {\n    return function(e) {\n        var api_url, parentNode, request;\n\n        e.preventDefault();\n\n        importButton.setAttribute(\"disabled\", \"\");\n        parentNode = importButton.parentNode;\n\n        // Create request\n        api_url = \"/rest/v1/project/\" + defaultValues.project_id + \"/import_results/?format=json\";\n\n        request = new XMLHttpRequest();\n        request.open(\"POST\", api_url, true);\n        request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n        request.setRequestHeader(\"Content-type\", \"application/json\");\n\n        request.onload = function() {\n            var response, divNode, status;\n            try {\n                status = request.status;\n                response = JSON.parse(request.responseText);\n            } catch (e) {\n                status = 500;\n                response = { message: \"A network error occurred, please try again\" };\n            }\n            divNode = document.createElement(\"div\");\n\n            if (status === 201) {\n                parentNode.removeChild(importButton);\n\n                divNode.classList.add(\"save-success\");\n                divNode.innerHTML =\n                    \"Import successful. Please refresh the page to see (and edit) the imported results.\";\n                parentNode.appendChild(divNode);\n            } else {\n                importButton.removeAttribute(\"disabled\");\n\n                divNode.classList.add(\"help-block-error\");\n                divNode.innerHTML = response.message;\n                parentNode.appendChild(divNode);\n            }\n        };\n\n        request.send();\n    };\n}\n\nfunction setPublishOnClick() {\n    var publishButton = document.getElementById(\"publishProject\");\n    if (publishButton !== null) {\n        publishButton.onclick = getProjectPublish(\n            defaultValues.publishing_status_id,\n            publishButton\n        );\n    }\n\n    return false;\n}\n\nfunction getProjectPublish(publishingStatusId, publishButton) {\n    return function(e) {\n        e.preventDefault();\n\n        publishButton.setAttribute(\"disabled\", \"\");\n\n        var api_url, request, publishErrorNode, span, status, unsavedMessage, unsavedSections;\n\n        status = publishButton.getAttribute(\"status\");\n\n        // Remove any previous errors\n        publishErrorNode = document.getElementById(\"publishErrors\");\n        publishErrorNode.innerHTML = \"\";\n\n        // If we want to publish, check for unsaved changes first\n        if (status === \"unpublished\") {\n            unsavedSections = checkUnsavedChanges();\n            if (unsavedSections.length > 0) {\n                unsavedMessage = \"There are unsaved changes in the following section(s):<ul>\";\n\n                for (var i = 0; i < unsavedSections.length; i++) {\n                    unsavedMessage += \"<li>\" + unsavedSections[i] + \"</li>\";\n                }\n\n                unsavedMessage += \"</ul>\";\n\n                span = document.createElement(\"span\");\n                span.className = \"notPublished\";\n                span.innerHTML = unsavedMessage;\n                publishErrorNode.appendChild(span);\n\n                publishButton.removeAttribute(\"disabled\");\n\n                // Don't publish\n                return;\n            }\n        }\n\n        // Create request\n        api_url = \"/rest/v1/publishing_status/\" + publishingStatusId + \"/?format=json\";\n\n        request = new XMLHttpRequest();\n        request.open(\"PATCH\", api_url, true);\n        request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n        request.setRequestHeader(\"Content-type\", \"application/json\");\n\n        request.onload = function() {\n            if (request.status >= 200 && request.status < 400) {\n                // Succesfully (un)published project!\n                var publishIndicator = document.getElementById(\"publish-indicator\");\n\n                // Change the view project page button to \"View project\" or \"Preview project\"\n                // Update the button's status and appearance\n\n                var iconElement, textElement, otherTextElement, otherIconElement;\n                if (status === \"unpublished\") {\n                    publishIndicator.className = \"published\";\n                    publishIndicator.innerHTML = defaultValues.published;\n\n                    publishButton.setAttribute(\"status\", \"published\");\n                    otherTextElement = document.createTextNode(\" \" + defaultValues.unpublish);\n                    otherIconElement = document.createElement(\"span\");\n                    otherIconElement.className = \"glyphicon glyphicon-remove\";\n                    publishButton.innerHTML = \"\";\n                    publishButton.className = publishButton.className.replace(\n                        \"btn-success\",\n                        \"btn-danger\"\n                    );\n\n                    publishButton.appendChild(otherIconElement);\n                    publishButton.appendChild(otherTextElement);\n                } else {\n                    publishIndicator.className = \"notPublished\";\n                    publishIndicator.innerHTML = defaultValues.not_published;\n\n                    publishButton.setAttribute(\"status\", \"unpublished\");\n                    otherTextElement = document.createTextNode(\" \" + defaultValues.publish);\n                    otherIconElement = document.createElement(\"span\");\n                    otherIconElement.className = \"glyphicon glyphicon-ok\";\n                    publishButton.innerHTML = \"\";\n                    publishButton.className = publishButton.className.replace(\n                        \"btn-danger\",\n                        \"btn-success\"\n                    );\n\n                    publishButton.appendChild(otherIconElement);\n                    publishButton.appendChild(otherTextElement);\n                }\n\n                publishButton.removeAttribute(\"disabled\");\n\n                return false;\n            } else {\n                // We reached our target server, but it returned an error\n                publishButton.removeAttribute(\"disabled\");\n\n                if (request.status == 400) {\n                    // Could not publish due to checks\n                    var response;\n\n                    response = JSON.parse(request.responseText);\n\n                    span = document.createElement(\"span\");\n                    span.className = \"notPublished\";\n                    publishErrorNode.appendChild(span);\n\n                    try {\n                        for (var i = 0; i < response.__all__.length; i++) {\n                            span.innerHTML += response.__all__[i] + \"<br/>\";\n                        }\n                    } catch (error) {\n                        // General error message\n                        if (status === \"unpublished\") {\n                            publishErrorNode.innerHTML = \"Could not publish project.\";\n                        } else {\n                            publishErrorNode.innerHTML = \"Could not unpublish project.\";\n                        }\n                    }\n                }\n\n                return false;\n            }\n        };\n\n        request.onerror = function() {\n            // There was a connection error of some sort\n            span = document.createElement(\"span\");\n            span.className = \"notPublished\";\n            publishErrorNode.appendChild(span);\n\n            if (status === \"unpublished\") {\n                publishErrorNode.innerHTML = \"Could not publish project due to a connection error.\";\n            } else {\n                publishErrorNode.innerHTML =\n                    \"Could not unpublish project due to a connection error.\";\n            }\n\n            publishButton.removeAttribute(\"disabled\");\n            return false;\n        };\n\n        if (status === \"unpublished\") {\n            request.send('{\"status\": \"published\"}');\n        } else {\n            request.send('{\"status\": \"unpublished\"}');\n        }\n    };\n}\n\nfunction setPeriodMasqueradeDates() {\n    if (defaultValues.hierarchy_name) {\n        var period_start = defaultValues.start_date;\n        if (!period_start) {\n            period_start = defaultValues.period_start;\n        }\n        var period_end = defaultValues.end_date;\n        if (!period_end) {\n            period_end = defaultValues.period_end;\n        }\n        var masqueradeLabel = period_start + \" - \" + period_end;\n        var periodContainers = document.getElementsByClassName(\"indicator-period-container\");\n\n        for (var i = 0; i < periodContainers.length; i++) {\n            var periodContainer = periodContainers[i];\n            var periodLabel = periodContainer.getElementsByClassName(\"unicode\")[0];\n            if (periodLabel.innerHTML[0] !== \"(\") {\n                periodLabel.innerHTML = masqueradeLabel;\n            }\n        }\n    }\n}\n\nfunction setDatepickers() {\n    function getDatepickerComponent(datepickerId, initialDate, disableInput) {\n        return React.createClass({\n            displayName: datepickerId,\n\n            getInitialState: function() {\n                return {\n                    initialDate: initialDate,\n                    disableInput: disableInput\n                };\n            },\n\n            handleDateChange: function(date) {\n                this.setState(\n                    {\n                        initialDate: date\n                    },\n                    this.fireInputChangeListener\n                );\n            },\n\n            fireInputChangeListener: function() {\n                // Fire the change listener here: react-datepicker changes the\n                // input element and the listener setup in\n                // setSectionChangeListener doesn't get fired.\n                var inputNode = this.getDOMNode().querySelector(\"input\");\n                var section = findAncestorByClass(inputNode, \"formStep\");\n                getChangeListener(section, inputNode)();\n            },\n\n            render: function() {\n                if (disableInput !== \"true\") {\n                    return React.createElement(\n                        \"div\",\n                        null,\n                        React.createElement(DatePicker, {\n                            locale: \"en\",\n                            placeholderText: \"\",\n                            showYearDropdown: true,\n                            dateFormat: \"DD/MM/YYYY\",\n                            selected: this.state.initialDate,\n                            onChange: this.handleDateChange,\n                            todayButton: defaultValues.today,\n                            className: this.props.classNames\n                        })\n                    );\n                } else {\n                    return React.createElement(\n                        \"div\",\n                        null,\n                        React.createElement(DatePicker, {\n                            locale: \"en\",\n                            placeholderText: \"\",\n                            dateFormat: \"DD/MM/YYYY\",\n                            selected: this.state.initialDate,\n                            className: this.props.classNames\n                        })\n                    );\n                }\n            }\n        });\n    }\n\n    var datepickerContainers = document.getElementsByClassName(\"datepicker-container\");\n\n    for (var i = 0; i < datepickerContainers.length; i++) {\n        var datepickerId,\n            DatePickerComponent,\n            datepickerContainer,\n            disableInput,\n            extraAttributes,\n            helptext,\n            initialDate,\n            inputNode,\n            inputValue,\n            label,\n            masqueradeDate,\n            masqueradeInput,\n            newPeriod;\n\n        datepickerContainer = datepickerContainers[i];\n\n        // Check if datepicker already has been set\n        if (datepickerContainer.className.indexOf(\"has-datepicker\") == -1) {\n            datepickerId = datepickerContainer.getAttribute(\"data-id\");\n            masqueradeDate = datepickerContainer.getAttribute(\"data-masquerade-date\");\n            newPeriod = datepickerContainer.getAttribute(\"new-period\");\n\n            // Set initial value of datepicker\n            inputValue = datepickerContainer.getAttribute(\"data-child\");\n            disableInput = datepickerContainer.getAttribute(\"data-disabled\");\n\n            if (inputValue !== \"\") {\n                initialDate = moment(inputValue, \"DD-MM-YYYY\");\n            } else {\n                initialDate = null;\n            }\n\n            var mandatoryOr = datepickerContainer.getAttribute(\"mandatory-or\");\n            var classNames = \"form-control \" + datepickerContainer.getAttribute(\"data-classes\");\n\n            DatePickerComponent = getDatepickerComponent(datepickerId, initialDate, disableInput);\n            ReactDOM.render(\n                React.createElement(DatePickerComponent, {\n                    key: datepickerId,\n                    classNames: classNames\n                }),\n                datepickerContainer\n            );\n\n            // Set id, name and saved value of datepicker input\n            inputNode = datepickerContainer.querySelector(\"input\");\n            inputNode.setAttribute(\"id\", datepickerId);\n            inputNode.setAttribute(\"name\", datepickerId);\n            // Don't set saved-value for new periods. This way the period is instantiated as part of\n            // saving the indicator\n            if (newPeriod === \"false\" || newPeriod === null) {\n                inputNode.setAttribute(\"saved-value\", inputValue);\n            }\n            if (disableInput === \"true\") {\n                inputNode.setAttribute(\"disabled\", \"\");\n            }\n\n            // Remove 'react-datepicker__input-container' class\n            // This is required for the current CSS to not break\n            inputNode.parentNode.className = \"\";\n\n            // Set addtional attributes of input\n            inputNode.setAttribute(\"mandatory-or\", mandatoryOr);\n\n            if (masqueradeDate) {\n                // Create masquerade input field\n                masqueradeInput = document.createElement(\"input\");\n                masqueradeInput.setAttribute(\"class\", \"form-control masquerade-field\");\n                masqueradeInput.setAttribute(\"type\", \"text\");\n                masqueradeInput.setAttribute(\"value\", masqueradeDate);\n                masqueradeInput.setAttribute(\"disabled\", true);\n                inputNode.parentNode.appendChild(masqueradeInput);\n            }\n\n            // Set label of datepicker\n            label = document.createElement(\"label\");\n            label.setAttribute(\"for\", datepickerId);\n            label.setAttribute(\"class\", \"control-label\");\n            label.innerHTML = datepickerContainer.getAttribute(\"data-label\");\n            inputNode.parentNode.appendChild(label);\n\n            // Set helptext of datepicker\n            helptext = document.createElement(\"p\");\n            helptext.setAttribute(\"class\", \"help-block hidden\");\n            helptext.innerHTML = datepickerContainer.getAttribute(\"data-helptext\");\n            inputNode.parentNode.appendChild(helptext);\n\n            datepickerContainer.className += \" has-datepicker\";\n        }\n    }\n}\n\nfunction fieldChanged(inputField) {\n    /* Check if a field has changed, based on it's value and saved-value.\n    *  Ignores file fields, checkboxes and hidden fields. */\n\n    if (inputField.type === \"file\" || inputField.type === \"checkbox\" || fieldIsHidden(inputField)) {\n        return false;\n    } else if (inputField.parentNode.classList.contains(\"typeahead\")) {\n        return inputField.getAttribute(\"value\") !== inputField.getAttribute(\"saved-value\");\n    } else {\n        return inputField.value !== inputField.getAttribute(\"saved-value\");\n    }\n}\n\nfunction checkUnsavedChangesForm(form) {\n    /* Checks if a form has unsaved changes. Returns true if so and false otherwise. */\n\n    var inputElements = form.querySelectorAll(INPUT_ELEMENTS.join());\n    for (var j = 0; j < inputElements.length; j++) {\n        if (\n            inputElements[j].type !== \"checkbox\" &&\n            // Don't include masquerade fields in form-changed checking\n            !inputElements[j].classList.contains(\"masquerade-field\") &&\n            // Don't include invisible fields in form-changed checking\n            !inputElements[j].classList.contains(\"invisible\") &&\n            fieldChanged(inputElements[j])\n        ) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction checkUnsavedChanges() {\n    var forms, formNames, unsavedForms;\n\n    unsavedForms = [];\n    formNames = [\n        \"01 - General information\",\n        \"02 - Contact information\",\n        \"03 - Project partners\",\n        \"04 - Project descriptions\",\n        \"05 - Results and indicators\",\n        \"06 - Finance\",\n        \"07 - Project locations\",\n        \"08 - Project focus\",\n        \"09 - Links and documents\",\n        \"10 - Project comments\",\n        \"11 - Special reporting\"\n    ];\n\n    forms = document.querySelectorAll(\"form\");\n\n    for (var i = 0; i < forms.length; i++) {\n        if (checkUnsavedChangesForm(forms[i])) {\n            unsavedForms.push(formNames[i]);\n        }\n    }\n\n    return unsavedForms;\n}\n\nfunction setUnsavedChangesMessage() {\n    window.onbeforeunload = function(e) {\n        var unsavedSections, message;\n\n        e = e || window.event;\n\n        unsavedSections = checkUnsavedChanges();\n        if (unsavedSections.length > 0) {\n            message = \"You have unsaved changes in the following section(s):\\n\\n\";\n            for (var i = 0; i < unsavedSections.length; i++) {\n                message += \"\\t• \" + unsavedSections[i] + \"\\n\";\n            }\n\n            // For IE and Firefox\n            if (e) {\n                e.returnValue = message;\n            }\n            // For Safari and Chrome\n            return message;\n        }\n    };\n}\n\n/* Show the \"add organisation\" modal dialog */\nfunction addOrgModal() {\n    /* Save section 3 */\n    function saveSectionThree() {\n        var saveButton = document.getElementById(\"panel3\").querySelector(\".save-button\");\n        doSubmitStep(saveButton);\n    }\n\n    /* Set the new organisation on the typeahead by default */\n    function updateThisOrganisationTypeahead(orgId) {\n        var footer = document.querySelector(\"footer\");\n        var child = document.getElementById(footer.getAttribute(\"selector\"));\n        var parent = findAncestorByClass(child, \"typeahead-container\");\n        parent.setAttribute(\"data-value\", orgId);\n        parent.setAttribute(\"not-saved\", \"\");\n    }\n\n    /* Remove the modal */\n    function cancelModal() {\n        var modal = document.querySelector(\".modalParent\");\n        modal.parentNode.removeChild(modal);\n    }\n\n    /* Submit the new org */\n    function submitModal() {\n        if (allInputsFilled()) {\n            var api_url, request, form, form_data;\n\n            // Add organisation to DB\n            form = document.querySelector(\"#addOrganisation\");\n            form_data = serialize(form);\n\n            // Remove empty IATI organistion id\n            form_data = form_data.replace(\"iati_org_id=&\", \"\");\n\n            api_url = \"/rest/v1/organisation/?format=json\";\n\n            request = new XMLHttpRequest();\n            request.open(\"POST\", api_url, true);\n            request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n            request.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n            request.onload = function() {\n                var response;\n                if (request.status === 201) {\n                    // Get organisation ID\n                    response = JSON.parse(request.responseText);\n                    var organisation_id = response.id;\n                    submitOrgLocation(organisation_id, form, form_data);\n\n                    updateThisOrganisationTypeahead(organisation_id);\n                    updateOrganisationTypeaheads(true);\n                    cancelModal();\n                } else if (request.status === 400) {\n                    response = JSON.parse(request.responseText);\n\n                    document.querySelector(\".orgModal\").scrollTop = 0;\n\n                    for (var key in response) {\n                        if (response.hasOwnProperty(key)) {\n                            var input = form.querySelector(\"#\" + key);\n                            var inputParent = input.parentNode;\n                            var inputHelp = inputParent.querySelector(\".help-block\");\n                            inputHelp.textContent = response[key];\n                            elAddClass(inputHelp, \"help-block-error\");\n                            elAddClass(inputParent, \"has-error\");\n                        }\n                    }\n                    return false;\n                } else {\n                    elAddClass(form, \"has-error\");\n                    return false;\n                }\n            };\n\n            request.onerror = function() {\n                // There was a connection error of some sort\n                document.querySelector(\"#addOrgGeneralError\").textContent =\n                    defaultValues.general_error;\n                document.querySelector(\".orgModal\").scrollTop = 0;\n                return false;\n            };\n\n            request.send(form_data);\n        } else {\n            document.querySelector(\".orgModal\").scrollTop = 0;\n        }\n    }\n\n    /* Submits the organisation location, and also calls the submitOrgLogo\n    method at the appropriate time - immediately, if there is no location update\n    to be made, or after the request finishes if a location update request has\n    been sent.\n\n    NOTE: The two requests cannot be made asynchronously since the server method\n    doesn't handle updates correctly. It seems to be losing the logo data, or\n    the location data, based on the order in which it is handling these\n    requests.\n     */\n    function submitOrgLocation(organisation_id, form, form_data) {\n        var latitude = form.querySelector(\"#latitude\").value,\n            longitude = form.querySelector(\"#longitude\").value;\n\n        if (latitude !== \"\" && longitude !== \"\") {\n            var api_url = \"/rest/v1/organisation_location/?format=json\",\n                request_loc = new XMLHttpRequest();\n\n            // Making a synchronous request, since org!\n            request_loc.open(\"POST\", api_url, false);\n            request_loc.setRequestHeader(\"X-CSRFToken\", csrftoken);\n            request_loc.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n            request_loc.send(form_data + \"&location_target=\" + organisation_id);\n        }\n\n        // Call sendOrgLogo after updating location is done. The update location\n        // request is synchronous\n        submitOrgLogo(organisation_id);\n    }\n\n    function submitOrgLogo(organisation_id) {\n        var org_logo_files = document.getElementById(\"org-logo\").files;\n        if (org_logo_files === undefined) {\n            return;\n        }\n\n        var api_url = \"/rest/v1/organisation/\" + organisation_id + \"/add_logo/?format=json\",\n            logo_data = new FormData(),\n            logo_request = new XMLHttpRequest();\n\n        logo_data.append(\"logo\", org_logo_files[0]);\n\n        logo_request.open(\"POST\", api_url);\n        logo_request.setRequestHeader(\"X-CSRFToken\", csrftoken);\n        logo_request.send(logo_data);\n    }\n\n    function allInputsFilled() {\n        var allInputsFilledBoolean = true;\n\n        // Name, long name, type, latitude, longitude, country settings\n        var fields = [\n            [\"name\", \"newOrgName\"],\n            [\"long_name\", \"newOrgLongName\"],\n            [\"new_organisation_type\", \"IATIOrgTypeContainer\"],\n            [\"latitude\", \"orgLatitude\"],\n            [\"longitude\", \"orgLongitude\"],\n            [\"iati_country\", \"orgCountry\"]\n        ];\n\n        // Check all fields\n        for (var i = 0; i < fields.length; i++) {\n            var field = fields[i];\n            var fieldNode = document.querySelector(\"#\" + field[0]);\n            var fieldNodeHelp = document.querySelector(\"#\" + field[0] + \" + label + .help-block\");\n            var fieldNodeContainer = document.querySelector(\".inputContainer.\" + field[1]);\n\n            if (fieldNode.value === \"\") {\n                fieldNodeHelp.textContent = defaultValues.blank_field;\n                elAddClass(fieldNodeHelp, \"help-block-error\");\n                elAddClass(fieldNodeContainer, \"has-error\");\n                allInputsFilledBoolean = false;\n            } else {\n                if (\n                    (field[0] === \"latitude\" || field[0] === \"longitude\") &&\n                    fieldNode.value.indexOf(\",\") > 0\n                ) {\n                    fieldNodeHelp.textContent = defaultValues.comma_value;\n                    elAddClass(fieldNodeHelp, \"help-block-error\");\n                    elAddClass(fieldNodeContainer, \"has-error\");\n                    allInputsFilledBoolean = false;\n                } else {\n                    fieldNodeHelp.textContent = \"\";\n                    elRemoveClass(fieldNodeHelp, \"help-block-error\");\n                    elRemoveClass(fieldNodeContainer, \"has-error\");\n                }\n            }\n        }\n\n        return allInputsFilledBoolean;\n    }\n\n    var Modal = React.createClass({\n        render: function() {\n            var country_option_list = countryValues.map(function(country) {\n                return <option value={country.pk}>{country.name}</option>;\n            });\n\n            return (\n                <div className=\"modalParent\">\n                    <div className=\"modalBackground\" />\n                    <div className=\"modalContainer\">\n                        <div className=\"orgModal\">\n                            <div className=\"modalContents projectEdit\">\n                                <h4>{defaultValues.add_new_organisation}</h4>\n                                <form id=\"addOrganisation\">\n                                    <div className=\"row\">\n                                        <div\n                                            id=\"addOrgGeneralError\"\n                                            className=\"col-md-12 help-block-error\"\n                                        />\n                                    </div>\n                                    <div className=\"row\">\n                                        <div className=\"inputContainer newOrgName col-md-4 form-group\">\n                                            <input\n                                                name=\"name\"\n                                                id=\"name\"\n                                                type=\"text\"\n                                                className=\"form-control\"\n                                                maxLength=\"40\"\n                                            />\n                                            <label htmlFor=\"newOrgName\" className=\"control-label\">\n                                                {defaultValues.name}\n                                                <span className=\"mandatory in-org-modal\">*</span>\n                                            </label>\n                                            <p className=\"help-block\">\n                                                {defaultValues.max} 40 {defaultValues.characters}\n                                            </p>\n                                        </div>\n                                        <div className=\"inputContainer newOrgLongName col-md-4 form-group\">\n                                            <input\n                                                name=\"long_name\"\n                                                id=\"long_name\"\n                                                type=\"text\"\n                                                className=\"form-control\"\n                                                maxLength=\"100\"\n                                            />\n                                            <label\n                                                htmlFor=\"newOrgLongName\"\n                                                className=\"control-label\"\n                                            >\n                                                {defaultValues.long_name}\n                                                <span className=\"mandatory in-org-modal\">*</span>\n                                            </label>\n                                            <p className=\"help-block\">\n                                                {defaultValues.max} 100 {defaultValues.characters}\n                                            </p>\n                                        </div>\n                                        <div className=\"inputContainer newOrgIatiId col-md-4 form-group\">\n                                            <input\n                                                name=\"iati_org_id\"\n                                                id=\"iati_org_id\"\n                                                type=\"text\"\n                                                className=\"form-control\"\n                                                maxLength=\"75\"\n                                            />\n                                            <label htmlFor=\"newOrgIatiId\" className=\"control-label\">\n                                                {defaultValues.iati_org_id}\n                                            </label>\n                                            <p className=\"help-block\">\n                                                {defaultValues.max} 75 {defaultValues.characters}\n                                            </p>\n                                        </div>\n                                    </div>\n                                    <div className=\"row\">\n                                        <div className=\"inputContainer col-md-12 form-group\">\n                                            <input\n                                                type=\"file\"\n                                                className=\"form-control\"\n                                                id=\"org-logo\"\n                                                name=\"org-logo\"\n                                                accept=\"image/*\"\n                                            />\n                                            <label className=\"control-label\" for=\"org-logo\">\n                                                {defaultValues.org_logo}\n                                            </label>\n                                        </div>\n                                    </div>\n                                    <div className=\"row\">\n                                        <div className=\"IATIOrgTypeContainer inputContainer col-md-6 form-group\">\n                                            <select\n                                                name=\"new_organisation_type\"\n                                                id=\"new_organisation_type\"\n                                                className=\"form-control\"\n                                            >\n                                                <option value=\"\" />\n                                                <option value=\"10\">\n                                                    10 - {defaultValues.government}\n                                                </option>\n                                                <option value=\"15\">\n                                                    15 - {defaultValues.other_public_sector}\n                                                </option>\n                                                <option value=\"21\">\n                                                    21 - {defaultValues.international_ngo}\n                                                </option>\n                                                <option value=\"22\">\n                                                    22 - {defaultValues.national_ngo}\n                                                </option>\n                                                <option value=\"23\">\n                                                    23 - {defaultValues.regional_ngo}\n                                                </option>\n                                                <option value=\"30\">\n                                                    30 - {defaultValues.public_private_partnership}\n                                                </option>\n                                                <option value=\"40\">\n                                                    40 - {defaultValues.multilateral}\n                                                </option>\n                                                <option value=\"60\">\n                                                    60 - {defaultValues.foundation}\n                                                </option>\n                                                <option value=\"70\">\n                                                    70 - {defaultValues.private_sector}\n                                                </option>\n                                                <option value=\"80\">\n                                                    80 - {defaultValues.academic_training_research}\n                                                </option>\n                                            </select>\n                                            <label\n                                                htmlFor=\"newOrgIATIType\"\n                                                className=\"control-label\"\n                                            >\n                                                {defaultValues.org_type}\n                                                <span className=\"mandatory in-org-modal\">*</span>\n                                            </label>\n                                            <p className=\"help-block\" />\n                                        </div>\n                                        <div className=\"inputContainer col-md-6 form-group\">\n                                            <input\n                                                name=\"url\"\n                                                id=\"url\"\n                                                type=\"text\"\n                                                className=\"form-control\"\n                                            />\n                                            <label htmlFor=\"url\" className=\"control-label\">\n                                                {defaultValues.website}\n                                            </label>\n                                            <p className=\"help-block\">{defaultValues.start_http}</p>\n                                        </div>\n                                    </div>\n                                    <div className=\"row\">\n                                        <div className=\"inputContainer orgLatitude col-md-4 form-group\">\n                                            <input\n                                                name=\"latitude\"\n                                                id=\"latitude\"\n                                                type=\"text\"\n                                                className=\"form-control\"\n                                            />\n                                            <label htmlFor=\"latitude\" className=\"control-label\">\n                                                {defaultValues.latitude}\n                                                <span className=\"mandatory in-org-modal\">*</span>\n                                            </label>\n                                            <p className=\"help-block\" />\n                                        </div>\n                                        <div className=\"inputContainer orgLongitude col-md-4 form-group\">\n                                            <input\n                                                name=\"longitude\"\n                                                id=\"longitude\"\n                                                type=\"text\"\n                                                className=\"form-control\"\n                                            />\n                                            <label htmlFor=\"longitude\" className=\"control-label\">\n                                                {defaultValues.longitude}\n                                                <span className=\"mandatory in-org-modal\">*</span>\n                                            </label>\n                                            <p className=\"help-block\" />\n                                        </div>\n                                        <div className=\"inputContainer orgCountry col-md-4 form-group\">\n                                            <select\n                                                name=\"iati_country\"\n                                                id=\"iati_country\"\n                                                className=\"form-control\"\n                                            >\n                                                <option value=\"\" />\n                                                {country_option_list}\n                                            </select>\n                                            <label htmlFor=\"country\" className=\"control-label\">\n                                                {defaultValues.country}\n                                                <span className=\"mandatory in-org-modal\">*</span>\n                                            </label>\n                                            <p className=\"help-block\" />\n                                        </div>\n                                    </div>\n                                    <div className=\"row\">\n                                        <p className=\"help-block\">\n                                            {defaultValues.use_link}{\" \"}\n                                            <a href=\"http://www.latlong.net/\" target=\"_blank\">\n                                                http://www.latlong.net/\n                                            </a>{\" \"}\n                                            {defaultValues.coordinates}\n                                        </p>\n                                    </div>\n                                    <div className=\"row\">\n                                        <div className=\"inputContainer col-md-6 form-group\">\n                                            <input\n                                                name=\"contact_person\"\n                                                id=\"contact_person\"\n                                                type=\"text\"\n                                                className=\"form-control\"\n                                            />\n                                            <label\n                                                htmlFor=\"contact_person\"\n                                                className=\"control-label\"\n                                            >\n                                                {defaultValues.contact_person}\n                                            </label>\n                                            <p className=\"help-block\" />\n                                        </div>\n                                        <div className=\"inputContainer col-md-6 form-group\">\n                                            <input\n                                                name=\"contact_email\"\n                                                id=\"contact_email\"\n                                                type=\"text\"\n                                                className=\"form-control\"\n                                            />\n                                            <label\n                                                htmlFor=\"contact_email\"\n                                                className=\"control-label\"\n                                            >\n                                                {defaultValues.contact_email}\n                                            </label>\n                                            <p className=\"help-block\" />\n                                        </div>\n                                    </div>\n                                    <div className=\"row\">\n                                        <div className=\"inputContainer col-md-12 form-group\">\n                                            <textarea\n                                                id=\"description\"\n                                                className=\"form-control\"\n                                                name=\"description\"\n                                                rows=\"3\"\n                                            />\n                                            <label className=\"control-label\" htmlFor=\"description\">\n                                                {defaultValues.description}\n                                            </label>\n                                            <p className=\"help-block\" />\n                                        </div>\n                                    </div>\n                                </form>\n                                <div className=\"controls\">\n                                    <button\n                                        className=\"modal-cancel btn btn-danger\"\n                                        onClick={cancelModal}\n                                    >\n                                        <span className=\"glyphicon glyphicon-trash\" />{\" \"}\n                                        {defaultValues.cancel}\n                                    </button>\n                                    <button\n                                        className=\"modal-save btn btn-success\"\n                                        onClick={submitModal}\n                                    >\n                                        <span className=\"glyphicon glyphicon-floppy-disk\" />{\" \"}\n                                        {defaultValues.save}\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            );\n        }\n    });\n\n    saveSectionThree();\n\n    ReactDOM.render(React.createElement(Modal), document.querySelector(\"footer\"));\n}\n\n/* Add validation set to the progress bar */\nfunction removeFromProgressBar(validationSetId) {\n    var progressBar = document.getElementById(\"progress-bar\");\n    var currentValidationSets = progressBar.getAttribute(\"validation-sets\").split(\"-\");\n    var index = currentValidationSets.indexOf(validationSetId);\n\n    if (index > -1) {\n        currentValidationSets.splice(index, 1);\n        progressBar.setAttribute(\"validation-sets\", currentValidationSets.join(\"-\"));\n\n        setValidationListeners();\n        setPageCompletionPercentage();\n        setAllSectionsCompletionPercentage();\n    }\n}\n\n/* Remove a validation set from project */\nfunction removeValidationSetFromProject(validationSet) {\n    var validationSetId = validationSet.getAttribute(\"id\").split(\"-\")[2];\n    var addValidationUrl =\n        \"/rest/v1/project/\" +\n        defaultValues.project_id +\n        \"/remove_validation/\" +\n        validationSetId +\n        \"/?format=json\";\n\n    var xmlHttp = new XMLHttpRequest();\n\n    xmlHttp.open(\"DELETE\", addValidationUrl);\n    xmlHttp.setRequestHeader(\"X-CSRFToken\", csrftoken);\n    xmlHttp.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n    xmlHttp.onreadystatechange = function() {\n        if (xmlHttp.readyState == XMLHttpRequest.DONE) {\n            if (xmlHttp.status == 200) {\n                removeFromProgressBar(validationSetId);\n            }\n        } else {\n            return false;\n        }\n    };\n\n    xmlHttp.send();\n}\n\n/* Add validation set to the progress bar */\nfunction addToProgressBar(validationSetId) {\n    var progressBar = document.getElementById(\"progress-bar\");\n    var currentValidationSets = progressBar.getAttribute(\"validation-sets\").split(\"-\");\n    currentValidationSets.push(validationSetId);\n    progressBar.setAttribute(\"validation-sets\", currentValidationSets.join(\"-\"));\n\n    setValidationListeners();\n    setPageCompletionPercentage();\n    setAllSectionsCompletionPercentage();\n}\n\n/* Add a validation set to project */\nfunction addValidationSetToProject(validationSet) {\n    var validationSetId = validationSet.getAttribute(\"id\").split(\"-\")[2];\n    if (validationSetId !== \"\") {\n        var addValidationUrl =\n            \"/rest/v1/project/\" +\n            defaultValues.project_id +\n            \"/add_validation/\" +\n            validationSetId +\n            \"/?format=json\";\n\n        var xmlHttp = new XMLHttpRequest();\n\n        xmlHttp.open(\"POST\", addValidationUrl);\n        xmlHttp.setRequestHeader(\"X-CSRFToken\", csrftoken);\n        xmlHttp.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n        xmlHttp.onreadystatechange = function() {\n            if (xmlHttp.readyState == XMLHttpRequest.DONE) {\n                if (xmlHttp.status == 200) {\n                    addToProgressBar(validationSetId);\n                }\n            } else {\n                return false;\n            }\n        };\n\n        xmlHttp.send();\n    }\n}\n\n/* Change the validation sets, either add or remove one */\nfunction changeValidationSet(validationSet) {\n    return function(e) {\n        e.preventDefault();\n\n        if (validationSet.hasAttribute(\"checked\")) {\n            // Validation set has been unchecked and should be removed\n            removeValidationSetFromProject(validationSet);\n            validationSet.removeAttribute(\"checked\");\n        } else {\n            // Validation set has been checked and should be added\n            addValidationSetToProject(validationSet);\n            validationSet.setAttribute(\"checked\", \"\");\n        }\n    };\n}\n\n/* Set the link for adding a new validation set */\nfunction setValidationSets() {\n    var validationSetContainer = document.getElementById(\"validation-sets\");\n    if (validationSetContainer !== null) {\n        var validationSets = validationSetContainer.querySelectorAll(\"input\");\n        for (var i = 0; i < validationSets.length; i++) {\n            validationSets[i].onchange = changeValidationSet(validationSets[i]);\n        }\n    }\n}\n\n/* Retrieve all projects for the typeaheads and store in the responses global variable */\nfunction getAllProjects() {\n    var url = projectsAPIUrl;\n    var xmlHttp = new XMLHttpRequest();\n\n    xmlHttp.onreadystatechange = function() {\n        if (xmlHttp.readyState == XMLHttpRequest.DONE) {\n            if (xmlHttp.status == 200) {\n                var response = JSON.parse(xmlHttp.responseText);\n                responses[url] = response;\n                updateLocalStorage(url, response);\n                updateProjectTypeaheads();\n            }\n        } else {\n            return false;\n        }\n    };\n\n    xmlHttp.open(\"GET\", url, true);\n    xmlHttp.send();\n}\n\n/* Retrieve all organisations for the typeaheads and store in the responses global variable */\nfunction getAllOrganisations() {\n    var url = orgsAPIUrl;\n    var xmlHttp = new XMLHttpRequest();\n\n    xmlHttp.onreadystatechange = function() {\n        if (xmlHttp.readyState == XMLHttpRequest.DONE) {\n            if (xmlHttp.status == 200) {\n                var response = JSON.parse(xmlHttp.responseText);\n                responses[url] = response;\n                updateLocalStorage(url, response);\n                updateOrganisationTypeaheads();\n            }\n        } else {\n            return false;\n        }\n    };\n\n    xmlHttp.open(\"GET\", url, true);\n    xmlHttp.send();\n}\n\nfunction setLocalStorage() {\n    try {\n        localStorageResponses = JSON.parse(localStorageResponses);\n    } catch (error) {\n        localStorageResponses = {};\n    }\n}\n\n/* General Helper Functions */\nfunction elHasClass(el, className) {\n    if (el.classList && el.classList.forEach) {\n        var result = false;\n        el.classList.forEach(function(entry) {\n            if (entry.toString() === className.toString()) {\n                result = true;\n                return;\n            }\n        });\n        return result;\n    } else {\n        return new RegExp(\"(^| )\" + className + \"( |$)\", \"gi\").test(el.className);\n    }\n}\n\nfunction elAddClass(el, className) {\n    if (el.classList) {\n        el.classList.add(className);\n    } else {\n        el.className += \" \" + className;\n    }\n}\n\nfunction elRemoveClass(el, className) {\n    if (el.classList) {\n        el.classList.remove(className);\n    } else {\n        el.className = el.className.replace(\n            new RegExp(\"(^|\\\\b)\" + className.split(\" \").join(\"|\") + \"(\\\\b|$)\", \"gi\"),\n            \" \"\n        );\n    }\n}\n\nfunction elIsVisible(el) {\n    return el.offsetWidth > 0 && el.offsetHeight > 0;\n}\n\nfunction initApp() {\n    getAllOrganisations();\n    getAllProjects();\n\n    setUnsavedChangesMessage();\n    setImpactProject();\n    setPrivateProject();\n    setValidationSets();\n    setPublishOnClick();\n    setSubmitOnClicks();\n\n    setDatepickers();\n    setPeriodMasqueradeDates();\n    setToggleSectionOnClick();\n    setPartialOnClicks();\n    setCurrencyOnChange();\n    setVocabularyOnChange();\n    setFileUploads();\n    checkPartnerships();\n\n    setIndicatorSorting();\n    setResultSorting();\n\n    setValidationListeners();\n    updateAllHelpIcons();\n\n    setPageCompletionPercentage();\n    setAllSectionsCompletionPercentage();\n    setAllSectionsChangeListener();\n\n    setLocalStorage();\n\n    expandAccordion(true);\n}\n\nvar loadJS = function(url, implementationCode, location) {\n    //url is URL of external file, implementationCode is the code\n    //to be called from the file, location is the location to\n    //insert the <script> element\n\n    var scriptTag = document.createElement(\"script\");\n    scriptTag.src = url;\n\n    scriptTag.onload = implementationCode;\n    scriptTag.onreadystatechange = implementationCode;\n\n    location.appendChild(scriptTag);\n};\n\nfunction loadAndRenderReact() {\n    function loadReactDatepicker() {\n        var reactDatepickerSrc = document.getElementById(\"react-datepicker-compat\").src;\n        loadJS(reactDatepickerSrc, initApp, document.body);\n    }\n\n    function loadReactOnclickoutside() {\n        var reactOnclickoutsideSrc = document.getElementById(\"react-onclickoutside\").src;\n        loadJS(reactOnclickoutsideSrc, loadReactDatepicker, document.body);\n    }\n\n    function loadReactTypeahead() {\n        var reactTypeaheadSrc = document.getElementById(\"react-typeahead\").src;\n        loadJS(reactTypeaheadSrc, loadReactOnclickoutside, document.body);\n    }\n\n    function loadReactDOM() {\n        var reactDOMSrc = document.getElementById(\"react-dom\").src;\n        loadJS(reactDOMSrc, loadReactTypeahead, document.body);\n    }\n\n    console.log(\"No React, load again.\");\n    var reactSrc = document.getElementById(\"react\").src;\n    loadJS(reactSrc, loadReactDOM, document.body);\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n    // Check if React is loaded\n    if (\n        typeof React !== \"undefined\" &&\n        typeof ReactDOM !== \"undefined\" &&\n        typeof ReactTypeahead !== \"undefined\" &&\n        typeof DatePicker !== \"undefined\"\n    ) {\n        initApp();\n    } else {\n        loadAndRenderReact();\n    }\n});\n\nfunction expandAccordion(highlight) {\n    if (!location.hash || location.hash === \"\") {\n        return;\n    } else if (location.hash.indexOf(\"#step\") == 0) {\n        // Expand the specified section, if we can.\n        var stepInput = document.querySelector(location.hash);\n        if (!stepInput) {\n            return;\n        }\n        stepInput.parentElement.firstElementChild.click();\n        stepInput.parentElement.firstElementChild.scrollIntoView();\n        location.hash = \"\";\n    } else if (location.hash.indexOf(\"#result.\") == 0) {\n        // Expand result\n        var hash = location.hash,\n            result = document.getElementById(location.hash.substring(1));\n        location.hash = \"#stepFive\";\n        expandAccordion();\n        result.querySelector(\".hide-partial-click\").click();\n        if (highlight) {\n            result.classList.add(\"error-highlight\");\n            result.scrollIntoView();\n            location.hash = hash;\n        }\n    } else if (location.hash.indexOf(\"#indicator.\") == 0) {\n        // Expand indicator\n        var hash = location.hash,\n            indicator = document.getElementById(location.hash.substring(1));\n        location.hash = \"#\" + findAncestorByClass(indicator, \"parent\").getAttribute(\"id\");\n        expandAccordion();\n        indicator.querySelector(\".hide-partial-click\").click();\n        if (highlight) {\n            indicator.classList.add(\"error-highlight\");\n            indicator.scrollIntoView();\n            location.hash = hash;\n        }\n    } else if (location.hash.indexOf(\"#indicator_period.\") == 0) {\n        // Expand indicator_period\n        var hash = location.hash,\n            period = document.getElementById(location.hash.substring(1));\n        location.hash = \"#\" + findAncestorByClass(period, \"parent\").getAttribute(\"id\");\n        expandAccordion();\n        period.querySelector(\".hide-partial-click\").click();\n        if (highlight) {\n            period.classList.add(\"error-highlight\");\n            period.scrollIntoView();\n            location.hash = hash;\n        }\n    }\n}\n"],"sourceRoot":""}