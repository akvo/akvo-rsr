!function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1057)}({1057:function(e,t,a){"use strict";var n={},i=React.createClass({displayName:"Filter",render:function(){var e=ReactBootstrapTypeahead.Typeahead;return React.createElement("div",{className:"advanced-filter"},React.createElement(e,{ref:"typeahead",name:this.props.name,selected:this.props.selected,options:this.props.options,onChange:this.onChange,filterBy:["filterBy"],labelKey:"label",highlightOnlyResult:!0,placeholder:this.props.display_name,disabled:this.props.disabled,renderMenuItemChildren:function(e){return"Â ".repeat(e.indent)+e.label},maxResults:1e4}),React.createElement("span",{className:"caret"}))},componentWillReceiveProps:function(e){this.props.selected.length>0&&0==e.selected.length&&this.refs.typeahead.getInstance().clear()},onChange:function(e){this.props.onChange(this.props.name,e)}}),s=function(e,t){var a=e.id;console.log(a),mapMarkers.forEach(function(e){"#"+a==e.highlightId&&e.setAnimation(t)})},r=React.createClass({displayName:"Project",highlightMarker:function(){return s(this.getDOMNode(),google.maps.Animation.BOUNCE)},unHighlightMarker:function(){return s(this.getDOMNode(),null)},render:function(){var e=this.props.project,t=" "+(e.countries.length>0?e.countries.join(", "):this.props.i18n.no_location_text),a="project-"+e.id;return React.createElement("li",{id:a,onMouseEnter:this.highlightMarker,onMouseLeave:this.unHighlightMarker},React.createElement("div",{className:"thumbImg"},React.createElement("a",{href:e.url},React.createElement("img",{src:e.image,alt:e.title}))),React.createElement("div",null,React.createElement("h1",null,React.createElement("a",{href:e.url},e.title)),React.createElement("p",{className:"projectOrg"},React.createElement("a",{href:e.organisation_url},e.organisation)),React.createElement("p",{className:"projectLocation"},React.createElement("i",{className:"fa fa-map-marker"}),t)))}}),o=React.createClass({displayName:"Update",highlightMarker:function(){return s(this.getDOMNode(),google.maps.Animation.BOUNCE)},unHighlightMarker:function(){return s(this.getDOMNode(),null)},render:function(){var e=this.props.project,t="project-"+e.id;return React.createElement("li",{id:t,onMouseEnter:this.highlightMarker,onMouseLeave:this.unHighlightMarker,className:"updateAsset"},React.createElement("div",{className:"thumbImg"},React.createElement("a",{href:e.url},React.createElement("img",{src:e.image,alt:e.title}))),React.createElement("div",null,React.createElement("h1",null,React.createElement("a",{href:e.url},e.title)),React.createElement("div",null,React.createElement("span",null,"Project: "),React.createElement("a",{href:e.project_url,class:"projectTitle"},e.project)),React.createElement("div",null,React.createElement("span",null,"Created by: "),React.createElement("span",{class:"userFullName"},e.user_fullname)),React.createElement("div",null,React.createElement("span",null,"Org: "),React.createElement("a",{href:e.organisation_url,class:"orgName"},e.organisation)),React.createElement("div",{class:"upDateTime"},e.event_date)))}}),c=React.createClass({displayName:"Organisation",render:function(){var e=this.props.organisation,t="organisation-"+e.id;return React.createElement("li",{id:t},React.createElement("div",null,React.createElement("a",{href:e.url},React.createElement("img",{src:e.image,alt:e.title}))),React.createElement("div",null,React.createElement("h1",null,React.createElement("a",{href:e.url},e.name)),React.createElement("div",{className:"orgType"},e.organisation_type)),React.createElement("div",{className:"hidden-xs hidden-sm additionalInfo"},React.createElement("div",null,React.createElement("span",null,e.project_count," projects"))))}}),l=React.createClass({displayName:"ProjectDirectory",componentDidUpdate:function(e){this.props.projects!=e.projects&&(this.props.hide_map||window.render_map(document.querySelector("#akvo_map_projects"),this.getMapConfig()),ReactDOM.findDOMNode(this).querySelector("#projList").scrollTop=0)},getLocations:function(){return this.props.projects.map(function(e){return{latitude:e.latitude,longitude:e.longitude,url:e.url,text:e.title,icon:"/static/images/maps/blueMarker.png",image:e.image,highlightId:"#project-"+e.id}},this)},getMapConfig:function(){return{dynamic:!0,locations:this.getLocations(),clickCallback:this.props.setCountry}},render:function(){var e=null!=this.props.project_count?this.props.project_count+" "+this.props.elements_text:this.props.i18n.loading_text,t=this.props.filtered?" filtered":"",a=this.props.hide_map?"col-sm-12":"col-sm-7",n=this.props.i18n.list_message_text;return React.createElement("section",{className:"main-list projects"},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"row"},this.props.disabled?React.createElement("div",{style:{position:"absolute",width:"100%",height:"calc(100vh - 160px)",background:"white",margin:"auto",padding:"20px",zIndex:"100000",textAlign:"center"}},React.createElement("div",{style:{marginTop:"calc(25vh)"}},React.createElement("i",{className:"fa fa-spin fa-spinner"}))):void 0,React.createElement("div",{className:a+" projectListUlcontain "+t,id:"projList"},React.createElement("p",{className:"text-center listMsg"},n),React.createElement("ul",{className:"projectListUl group"},this.props.projects.map(function(e){return"projects"==this.props.type?React.createElement(r,{project:e,i18n:this.props.i18n,key:"project"+e.id}):"updates"==this.props.type?React.createElement(o,{project:e,i18n:this.props.i18n,key:"project"+e.id}):"organisations"==this.props.type?React.createElement(c,{organisation:e,i18n:this.props.i18n,key:"organisation"+e.id}):void 0},this)),React.createElement("div",{className:"container-fluid pageStatus text-center"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-6 col-xs-offset-3"},React.createElement("span",{className:"label label-info projectTotal"},e),React.createElement(p,{onChange:this.props.onChange,page:this.props.page,limit:this.props.limit,project_count:this.props.project_count}))))),this.props.hide_map?void 0:React.createElement("div",{className:"col-sm-5"},React.createElement("section",{id:"map",className:"touch-navbar"},React.createElement("div",{id:"akvo_map_projects",className:"rsr_map"}))))))}}),p=React.createClass({displayName:"Pagination",getPages:function(){return Math.ceil(this.props.project_count/this.props.limit)},onSelect:function(e){e.preventDefault(),this.props.onChange("page",e.target.text)},render:function(){var e=ReactBootstrap.Pagination;return React.createElement("div",{className:"center-text pgWrap "},React.createElement(e,{boundaryLinks:!0,activePage:parseInt(this.props.page),items:this.getPages(),maxButtons:3,onSelect:this.onSelect}))}}),h=React.createClass({displayName:"TextSearch",getInitialState:function(){return{value:"",options:[]}},componentDidMount:function(){this.fetchOptions()},componentWillReceiveProps:function(e){this.setState({value:e.text||""})},fetchOptions:function(){var e=this.props.typeaheadUrl,t=this;return fetch(e,{}).then(function(e){if(e.status>=200&&e.status<300)return e.json()}).then(function(e){t.setState({options:t.mungeOptions(e.results)||[]})}),[]},getUrl:function(e){return"projects"==this.props.type?"../project/"+e.id:"updates"==this.props.type?"../project/"+e.project+"/update/"+e.id:"organisations"==this.props.type?"../organisation/"+e.id:void 0},mungeOptions:function(e){return e.map(function(e){return e.id=String(e.id),e})},onChange:function(e){var t=e[0],a=this.getUrl(t);window.location.href=a},onInputChange:function(e){this.setState({value:e})},onSubmit:function(e){this.props.onChange("title_or_subtitle",this.state.value)},render:function(){var e,t=ReactBootstrapTypeahead.Typeahead;return"projects"==this.props.type?e=["id","title","subtitle"]:"updates"==this.props.type?e=["title"]:"organisations"==this.props.type&&(e=["name","long_name"]),React.createElement("div",{className:"form-inline col-lg-4 col-md-4",role:"form"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"input-group"},React.createElement(t,{name:this.props.name,options:this.state.options,onChange:this.onChange,onInputChange:this.onInputChange,filterBy:e,labelKey:function(e){return e.title||e.name},highlightOnlyResult:!0,placeholder:this.props.text_placeholder,disabled:this.props.disabled,maxResults:10,minLength:3}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-primary",onClick:this.onSubmit},this.props.i18n.search_text)))))}}),u=React.createClass({displayName:"SearchBar",render:function(){var e=_.isEmpty(_.pick(this.props.selected,"location","organisation","sector","title_or_subtitle"))?void 0:React.createElement("span",{className:"pull-right"},React.createElement("a",{className:"btn",onClick:this.props.resetFilters},"X ",this.props.i18n.reset_filters_text));return React.createElement("section",{id:"search-filter",className:"container-fluid"},React.createElement("div",{id:"search",className:"row searchBar"},React.createElement(h,{type:this.props.type,typeaheadUrl:this.props.typeaheadUrl,text:this.props.selected.title_or_subtitle,i18n:this.props.i18n,text_placeholder:this.props.text_placeholder,projects:this.props.projects,onChange:this.props.onChange}),React.createElement("div",{id:"filter-wrapper col-sm-12 col-lg-6 col-md-6 col-lg-offset-2 col-md-offset-2"},React.createElement("div",null,this.props.filters.map(function(e){var t=function(e){var t=this.props.options,a=this.props.selected[e],n=this.props.filters.indexOf(e)>-1,i=n?t[e].find(function(e){return e.id==a}):a,s=n?Object.assign({},i):a;return n?_.isEmpty(s)?[]:[s]:a}.call(this,e);return React.createElement(i,{ref:e,key:e,options:this.props.options[e],name:e,display_name:this.props.i18n[e+"_text"],selected:t,onChange:this.props.onChange,disabled:this.props.disabled})},this),e))))}}),d=React.createClass({displayName:"App",getInitialState:function(){var e=this.getStateFromUrl();return{options:{keyword:[],location:[],organisation:[],sector:[]},selected:e,filtered:Object.keys(e).length>0,disabled:!0,projects:[]}},componentDidMount:function(){var e=this;this.fetchData(!0),window.onpopstate=function(t){_.isEqual(e.state.selected,t.state)||e.setState({selected:t.state||{}},e.fetchData)}},render:function(){var e=this.props.i18n[this.props.type+"_text"];return React.createElement("div",null,React.createElement(u,{typeaheadUrl:this.props.typeahead_url,resetFilters:this.resetFilters,onChange:this.onFilterChange,filters:this.props.dropdown_filters,disabled:this.state.disabled,projects:this.state.projects,project_count:this.state.project_count,i18n:this.props.i18n,options:this.state.options,selected:this.state.selected,text_placeholder:e,type:this.props.type}),React.createElement(l,{hide_map:this.props.hide_map,type:this.props.type,onChange:this.onFilterChange,limitOptions:this.state.options.limit,page:this.state.selected.page||1,limit:this.state.selected.limit||this.state.page_size_default||16,projects:this.state.projects,project_count:this.state.project_count,i18n:this.props.i18n,elements_text:e,disabled:this.state.disabled,filtered:this.state.filtered,setCountry:this.setCountry}))},onFilterChange:function(e,t){var a={};Object.assign(a,this.state.selected),t.length>0?(a[e]="string"==typeof t?t:t[0].id,"page"!==e&&a[e]!==this.state.selected[e]&&(a.page=1)):delete a[e],this.setState({selected:a,filtered:Object.keys(a).length>0},this.fetchData),this.updateHistory(a)},resetFilters:function(){this.setState({selected:{},filtered:!1},this.fetchData)},cacheAllOptions:function(){var e=this,t=this.getOptionsUrl({});n[t]||fetch(t,{}).then(e.parseResponse).then(function(a){a&&e.cacheOptions(t,e.processOptions(a))})},cacheOptions:function(e,t){n[e]=t},fetchData:function(e){var t=this.getOptionsUrl(this.state.selected),a=n[t];if(a&&a.project_count)this.updateState(Object.assign({},a));else{this.setState({disabled:!0});var i=this;fetch(t,{}).then(i.parseResponse).then(function(a){if(a){var n=i.processOptions(a);i.updateState(n,e),i.cacheOptions(t,n),e&&i.cacheAllOptions()}})}},getOptionsUrl:function(e){var t={format:"json"};return t=Object.keys(Object.assign(t,e)).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&"),this.props.options_url+"?"+t},getProjectUrl:function(e){return"../project/"+e.id},getStateFromUrl:function(){var e={},t=location.search.substring(1);return""===(t=(t=t.replace("iati_status","status")).replace("partner","organisation"))?e:(t.split("&").map(function(t){var a=t.split("="),n=decodeURIComponent(a[0]),i=decodeURIComponent(a[1]);""!==i&&this.isFilter(n)&&(e[n]=i)},this),e)},isFilter:function(e,t){return t?this.props.dropdown_filters.indexOf(e)>-1:this.props.dropdown_filters.indexOf(e)>-1||this.props.hidden_or_other.indexOf(e)>-1},parseResponse:function(e){if(e.status>=200&&e.status<300)return e.json()},processOptions:function(e){var t=function(e){var t=e.label||e.long_name||e.name||"",a=t.match(/\s+/i);e.id=String(e.id),e.filterBy=t.trim()+" "+e.id,e.indent=4*parseInt((a?a[0].length:0)/4),e.label=t.trim()};for(var a in e){if(this.isFilter(a,!0))e[a].forEach(t)}return e},setCountry:function(e){console.log(e);var t=this.state.options.location;for(var a in t)if(t[a].label==e){this.onFilterChange("location",[t[a]]);break}},updateHistory:function(e){if(!_.isEqual(e,history.state)){var t=_.pairs(e).map(function(e){var t=e[0],a=e[1];return t+"="+encodeURI(a)}),a=_.pairs(e).map(function(e){var t=e[0],a=e[1];return t+": "+encodeURI(a)}),n=t.length>0?"?"+t.join("&"):"./";window.history.pushState(e,document.title+" "+a.join(", "),n)}},updateState:function(e,t){this.setState({options:e,disabled:!1,project_count:e.project_count,page_size_default:e.page_size_default,projects:e.projects})}});window.DirectoryApp=d}});
//# sourceMappingURL=directoryUtils.js.map