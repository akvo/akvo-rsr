import os

# Django-Prometheus configuration for memory leak detection
if 'ENABLE_PROMETHEUS_METRICS' in os.environ or 'ENABLE_STATS' in os.environ:
    # Add django-prometheus to installed apps
    INSTALLED_APPS += ('django_prometheus',)

    # Add django-prometheus middleware
    # PrometheusBeforeMiddleware should be first
    MIDDLEWARE = (
        'django_prometheus.middleware.PrometheusBeforeMiddleware',
    ) + MIDDLEWARE + (
        'django_prometheus.middleware.PrometheusAfterMiddleware',
    )

    # Django-Prometheus settings
    PROMETHEUS_EXPORT_MIGRATIONS = False
    PROMETHEUS_LATENCY_BUCKETS = (0.01, 0.025, 0.05, 0.075, 0.1, 0.25, 0.5, 0.75, 1.0, 2.5, 5.0, 7.5, 10.0, 25.0, 50.0, 75.0, 100.0, float('inf'))

    # Memory profiling settings
    ENABLE_MEMORY_PROFILING = os.environ.get('ENABLE_MEMORY_PROFILING', 'true').lower() == 'true'
    MEMORY_PROFILING_SAMPLE_RATE = float(os.environ.get('MEMORY_PROFILING_SAMPLE_RATE', '1.0'))
    MEMORY_GROWTH_THRESHOLD_MB = int(os.environ.get('MEMORY_GROWTH_THRESHOLD_MB', '10'))
