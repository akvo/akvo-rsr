/*
 * Galleria v 1.1.95 2010-08-06
 * http://galleria.aino.se
 *
 * Copyright (c) 2010, Aino
 * Licensed under the MIT license.
 */
(function(){var e=false,h=/xyz/.test(function(){xyz;})?/\b__super\b/:/.*/,b=function(){},g=this;b.extend=function(n){var m=this.prototype;e=true;var l=new this();e=false;for(var k in n){if(k){l[k]=typeof n[k]=="function"&&typeof m[k]=="function"&&h.test(n[k])?(function(o,p){return function(){var r=this.__super;this.__super=m[o];var q=p.apply(this,arguments);this.__super=r;return q;};})(k,n[k]):n[k];}}function j(){if(!e&&this.__constructor){this.__constructor.apply(this,arguments);}}j.prototype=l;j.constructor=j;j.extend=arguments.callee;return j;};var f=b.extend({loop:function(l,k){var j=this;if(typeof l=="number"){l=new Array(l);}jQuery.each(l,function(){k.call(j,arguments[1],arguments[0]);});return l;},create:function(l,k){l=l||"div";var j=document.createElement(l);if(k){j.className=k;}return j;},getElements:function(j){var k={};this.loop(jQuery(j),this.proxy(function(l){this.push(l,k);}));return k;},setStyle:function(k,j){jQuery(k).css(j);return this;},getStyle:function(k,j,m){var l=jQuery(k).css(j);return m?this.parseValue(l):l;},cssText:function(j){var l=document.createElement("style");this.getElements("head")[0].appendChild(l);if(l.styleSheet){l.styleSheet.cssText=j;}else{var k=document.createTextNode(j);l.appendChild(k);}return this;},touch:function(l){var k=l.nextSibling;var j=l.parentNode;j.removeChild(l);if(k){j.insertBefore(l,k);}else{j.appendChild(l);}if(l.styleSheet&&l.styleSheet.imports.length){this.loop(l.styleSheet.imports,function(m){l.styleSheet.addImport(m.href);});}},loadCSS:function(j,m){var l=this.getElements('link[href="'+j+'"]').length;if(l){m.call(null);return l[0];}var k=this.create("link");k.rel="stylesheet";k.href=j;if(typeof m=="function"){this.wait(function(){return !!document.body;},function(){var n=this.create("div","galleria-container galleria-stage");this.moveOut(n);document.body.appendChild(n);var o=this.proxy(function(){var r="";var q;if(document.defaultView&&document.defaultView.getComputedStyle){q=document.defaultView.getComputedStyle(n,"");this.loop(q,function(s){r+=s+q.getPropertyValue(s);});}else{if(n.currentStyle){q=n.currentStyle;this.loop(q,function(s,t){r+=t+s;});}}return r;});var p=o();this.wait(function(){return o()!==p;},function(){document.body.removeChild(n);m.call(k);},function(){i.raise("Could not confirm theme CSS");},2000);});}g.setTimeout(this.proxy(function(){var n=this.getElements('link[rel="stylesheet"],style');if(n.length){n[0].parentNode.insertBefore(k,n[0]);}else{this.getElements("head")[0].appendChild(k);}if(i.IE){this.loop(n,function(o){this.touch(o);});}}),2);return k;},moveOut:function(j){return this.setStyle(j,{position:"absolute",left:"-10000px",display:"block"});},moveIn:function(j){return this.setStyle(j,{left:"0"});},reveal:function(j){return jQuery(j).show();},hide:function(j){return jQuery(j).hide();},mix:function(){return jQuery.extend.apply(jQuery,arguments);},proxy:function(k,j){if(typeof k!=="function"){return function(){};}j=j||this;return function(){return k.apply(j,Array.prototype.slice.call(arguments));};},listen:function(l,k,j){jQuery(l).bind(k,j);},forget:function(l,k,j){jQuery(l).unbind(k,j);},dispatch:function(k,j){jQuery(k).trigger(j);},clone:function(k,j){j=j||false;return jQuery(k).clone(j)[0];},removeAttr:function(k,j){this.loop(j.split(" "),function(l){jQuery(k).removeAttr(l);});},push:function(j,k){if(typeof k.length=="undefined"){k.length=0;}Array.prototype.push.call(k,j);return j;},width:function(k,j){return this.meassure(k,j,"Width");},height:function(k,j){return this.meassure(k,j,"Height");},meassure:function(l,k,o){var m=jQuery(l);var j=k?m["outer"+o](true):m[o.toLowerCase()]();if(i.QUIRK){var n=o=="Width"?["left","right"]:["top","bottom"];this.loop(n,function(p){j+=m.css("border-"+p+"-width").replace(/[^\d]/g,"")*1;j+=m.css("padding-"+p).replace(/[^\d]/g,"")*1;});}return j;},toggleClass:function(m,l,j){if(typeof j!=="undefined"){var k=j?"addClass":"removeClass";jQuery(m)[k](l);return this;}jQuery(m).toggleClass(l);return this;},hideAll:function(j){jQuery(j).find("*").hide();},animate:function(k,j){j.complete=this.proxy(j.complete);var l=jQuery(k);if(!l.length){return;}if(j.from){l.css(from);}l.animate(j.to,{duration:j.duration||400,complete:j.complete,easing:j.easing||"swing"});},wait:function(k,n,m,j){k=this.proxy(k);n=this.proxy(n);m=this.proxy(m);var l=new Date().getTime()+(j||3000);g.setTimeout(function(){if(k()){n();return false;}if(new Date().getTime()>=l){m();n();return false;}g.setTimeout(arguments.callee,2);},2);return this;},loadScript:function(l,o){var k=document.createElement("script");k.src=l;k.async=true;var j=false;var n=this;k.onload=k.onreadystatechange=function(){if(!j&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){j=true;if(typeof o=="function"){o.call(n,this);}k.onload=k.onreadystatechange=null;}};var m=document.getElementsByTagName("script")[0];m.parentNode.insertBefore(k,m);return this;},parseValue:function(k){if(typeof k=="number"){return k;}else{if(typeof k=="string"){var j=k.match(/\-?\d/g);return j&&j.constructor==Array?j.join("")*1:0;}else{return 0;}}}});var c=f.extend({__constructor:function(j){this.image=null;this.elem=this.create("div","galleria-image");this.setStyle(this.elem,{overflow:"hidden",position:"relative"});this.order=j;this.orig={w:0,h:0,r:1};},cache:{},ready:false,add:function(k){if(this.cache[k]){return this.cache[k];}var j=new Image();j.src=k;this.setStyle(j,{display:"block"});if(j.complete&&j.width){this.cache[k]=j;return j;}j.onload=(function(l){return function(){l.cache[k]=j;};})(this);return j;},isCached:function(j){return this.cache[j]?this.cache[j].complete:false;},make:function(k){var j=this.cache[k]||this.add(k);return this.clone(j);},load:function(j,k){k=this.proxy(k);this.elem.innerHTML="";this.image=this.make(j);this.moveOut(this.image);this.elem.appendChild(this.image);this.wait(function(){return(this.image.complete&&this.image.width);},function(){this.orig={h:this.h||this.image.height,w:this.w||this.image.width};k({target:this.image,scope:this});},function(){i.raise("image not loaded in 20 seconds: "+j);},20000);return this;},scale:function(k){var m=this.mix({width:0,height:0,min:undefined,max:undefined,margin:0,complete:function(){},position:"center",crop:false},k);if(!this.image){return this;}var l,j;this.wait(function(){l=m.width||this.width(this.elem);j=m.height||this.height(this.elem);return l&&j;},function(){var n=(l-m.margin*2)/this.orig.w;var q=(j-m.margin*2)/this.orig.h;var s={"true":Math.max(n,q),width:n,height:q,"false":Math.min(n,q)};var p=s[m.crop.toString()];if(m.max){p=Math.min(m.max,p);}if(m.min){p=Math.max(m.min,p);}this.setStyle(this.elem,{width:l,height:j});this.image.width=Math.ceil(this.orig.w*p);this.image.height=Math.ceil(this.orig.h*p);var r=this.proxy(function(y,x,w){var v=0;if(/\%/.test(y)){var z=parseInt(y)/100;v=Math.ceil(this.image[x]*-1*z+w*z);}else{v=parseInt(y);}return v;});var t={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};var u={};var o={};this.loop(m.position.toLowerCase().split(" "),function(w,v){if(w=="center"){w="50%";}u[v?"top":"left"]=w;});this.loop(u,function(w,v){if(t.hasOwnProperty(w)){o=this.mix(o,t[w]);}});u=u.top?this.mix(u,o):o;u=this.mix({top:"50%",left:"50%"},u);this.setStyle(this.image,{position:"relative",top:r(u.top,"height",j),left:r(u.left,"width",l)});this.ready=true;m.complete.call(this);});return this;}});var i=g.Galleria=f.extend({__constructor:function(l){this.theme=undefined;this.options=l;this.playing=false;this.playtime=5000;this.active=null;this.queue={};this.data={};this.dom={};var n=this.keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8},map:{},bound:false,press:this.proxy(function(q){var p=q.keyCode||q.which;if(n.map[p]&&typeof n.map[p]=="function"){n.map[p].call(this,q);}}),attach:this.proxy(function(r){for(var q in r){var p=q.toUpperCase();if(n.keys[p]){n.map[n.keys[p]]=r[q];}}if(!n.bound){n.bound=true;this.listen(document,"keydown",n.press);}}),detach:this.proxy(function(){n.bound=false;this.forget(document,"keydown",n.press);})};this.timeouts={trunk:{},add:function(u,t,s,q){q=q||false;this.clear(u);if(q){var r=this;var p=t;t=function(){p();r.add(u,t,s);};}this.trunk[u]=g.setTimeout(t,s);},clear:function(q){if(q&&this.trunk[q]){g.clearTimeout(this.trunk[q]);delete this.trunk[q];}else{if(typeof q=="undefined"){for(var p in this.trunk){g.clearTimeout(this.trunk[p]);delete this.trunk[p];}}}}};this.controls={0:null,1:null,active:0,swap:function(){this.active=this.active?0:1;},getActive:function(){return this[this.active];},getNext:function(){return this[Math.abs(this.active-1)];}};var j=this.fullscreen={scrolled:0,enter:this.proxy(function(){this.toggleClass(this.get("container"),"fullscreen");j.scrolled=jQuery(g).scrollTop();this.loop(j.getElements(),function(r,q){j.styles[q]=r.getAttribute("style");r.removeAttribute("style");});this.setStyle(j.getElements(0),{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:10000});var p={height:"100%",overflow:"hidden",margin:0,padding:0};this.setStyle(j.getElements(1),p);this.setStyle(j.getElements(2),p);this.attachKeyboard({escape:this.exitFullscreen,right:this.next,left:this.prev});this.rescale(this.proxy(function(){this.trigger(i.FULLSCREEN_ENTER);}));this.listen(g,"resize",j.scale);}),scale:this.proxy(function(){this.rescale();}),exit:this.proxy(function(){this.toggleClass(this.get("container"),"fullscreen",false);if(!j.styles.length){return;}this.loop(j.getElements(),function(q,p){q.removeAttribute("style");q.setAttribute("style",j.styles[p]);});g.scrollTo(0,j.scrolled);this.detachKeyboard();this.rescale(this.proxy(function(){this.trigger(i.FULLSCREEN_EXIT);}));this.forget(g,"resize",j.scale);}),styles:[],getElements:this.proxy(function(q){var p=[this.get("container"),document.body,this.getElements("html")[0]];return q?p[q]:p;})};var m=this.idle={trunk:[],bound:false,add:this.proxy(function(s,r,q){if(!s){return;}if(!m.bound){m.addEvent();}s=jQuery(s);var t={};for(var p in r){t[p]=s.css(p);}s.data("idle",{from:t,to:r,complete:true,busy:false,fn:this.proxy(q)});m.addTimer();m.trunk.push(s);}),remove:this.proxy(function(p){p=jQuery(p);this.loop(m.trunk,function(r,q){if(r&&!r.not(p).length){m.show(p);m.trunk.splice(q,1);}});if(!m.trunk.length){m.removeEvent();this.clearTimer("idle");}}),addEvent:this.proxy(function(){m.bound=true;this.listen(this.get("container"),"mousemove click",m.showAll);}),removeEvent:this.proxy(function(){m.bound=false;this.forget(this.get("container"),"mousemove click",m.showAll);}),addTimer:this.proxy(function(){this.addTimer("idle",this.proxy(function(){m.hide();}),this.options.idle_time);}),hide:this.proxy(function(){this.trigger(i.IDLE_ENTER);this.loop(m.trunk,function(p){var q=p.data("idle");q.complete=false;q.fn();p.animate(q.to,{duration:600,queue:false,easing:"swing"});});}),showAll:this.proxy(function(){this.clearTimer("idle");this.loop(m.trunk,function(p){m.show(p);});}),show:this.proxy(function(p){var q=p.data("idle");if(!q.busy&&!q.complete){q.busy=true;this.trigger(i.IDLE_EXIT);p.animate(q.from,{duration:300,queue:false,easing:"swing",complete:function(){$(this).data("idle").busy=false;$(this).data("idle").complete=true;}});}m.addTimer();})};var o=this.lightbox={w:0,h:0,initialized:false,active:null,init:this.proxy(function(){if(o.initialized){return;}o.initialized=true;var p="lightbox-overlay lightbox-box lightbox-content lightbox-shadow lightbox-title lightbox-info lightbox-close lightbox-prev lightbox-next lightbox-counter";this.loop(p.split(" "),function(q){this.addElement(q);o[q.split("-")[1]]=this.get(q);});o.image=new Galleria.Picture();this.append({"lightbox-box":["lightbox-shadow","lightbox-content","lightbox-close"],"lightbox-info":["lightbox-title","lightbox-counter","lightbox-next","lightbox-prev"],"lightbox-content":["lightbox-info"]});document.body.appendChild(o.overlay);document.body.appendChild(o.box);o.content.appendChild(o.image.elem);o.close.innerHTML="&#215;";o.prev.innerHTML="&#9668;";o.next.innerHTML="&#9658;";this.listen(o.close,"click",o.hide);this.listen(o.overlay,"click",o.hide);this.listen(o.next,"click",o.showNext);this.listen(o.prev,"click",o.showPrev);if(this.options.lightbox_clicknext){this.setStyle(o.image.elem,{cursor:"pointer"});this.listen(o.image.elem,"click",o.showNext);}this.setStyle(o.overlay,{position:"fixed",display:"none",opacity:this.options.overlay_opacity,top:0,left:0,width:"100%",height:"100%",background:this.options.overlay_background,zIndex:99990});this.setStyle(o.box,{position:"fixed",display:"none",width:400,height:400,top:"50%",left:"50%",marginTop:-200,marginLeft:-200,zIndex:99991});this.setStyle(o.shadow,{background:"#000",opacity:0.4,width:"100%",height:"100%",position:"absolute"});this.setStyle(o.content,{backgroundColor:"#fff",position:"absolute",top:10,left:10,right:10,bottom:10,overflow:"hidden"});this.setStyle(o.info,{color:"#444",fontSize:"11px",fontFamily:"arial,sans-serif",height:13,lineHeight:"13px",position:"absolute",bottom:10,left:10,right:10,opacity:0});this.setStyle(o.close,{background:"#fff",height:20,width:20,position:"absolute",textAlign:"center",cursor:"pointer",top:10,right:10,lineHeight:"22px",fontSize:"16px",fontFamily:"arial,sans-serif",color:"#444",zIndex:99999});this.setStyle(o.image.elem,{top:10,left:10,right:10,bottom:30,position:"absolute"});this.loop("title prev next counter".split(" "),function(r){var q={display:"inline","float":"left"};if(r!="title"){this.mix(q,{"float":"right"});if(r!="counter"){this.mix(q,{cursor:"pointer"});}else{this.mix(q,{marginLeft:8});}}this.setStyle(o[r],q);});this.loop("prev next close".split(" "),function(q){this.listen(o[q],"mouseover",this.proxy(function(){this.setStyle(o[q],{color:"#000"});}));this.listen(o[q],"mouseout",this.proxy(function(){this.setStyle(o[q],{color:"#444"});}));});this.trigger(i.LIGHTBOX_OPEN);}),rescale:this.proxy(function(x){var p=Math.min(this.width(g),o.w);var t=Math.min(this.height(g),o.h);var u=Math.min((p-60)/o.w,(t-80)/o.h);var s=(o.w*u)+40;var v=(o.h*u)+60;var q={width:s,height:v,marginTop:Math.ceil(v/2)*-1,marginLeft:Math.ceil(s)/2*-1};if(!x){this.animate(o.box,{to:q,duration:this.options.lightbox_transition_speed,easing:"galleria",complete:function(){this.trigger({type:i.LIGHTBOX_IMAGE,imageTarget:o.image.image});this.moveIn(o.image.image);this.animate(o.image.image,{to:{opacity:1},duration:this.options.lightbox_fade_speed});this.animate(o.info,{to:{opacity:1},duration:this.options.lightbox_fade_speed});}});}else{this.setStyle(o.box,q);}}),hide:this.proxy(function(){o.image.image=null;this.forget(g,"resize",o.rescale);this.hide(o.box);this.setStyle(o.info,{opacity:0});this.animate(o.overlay,{to:{opacity:0},duration:200,complete:function(){this.hide(o.overlay);this.setStyle(o.overlay,{opacity:this.options.overlay_opacity});this.trigger(i.LIGHTBOX_CLOSE);}});}),showNext:this.proxy(function(){o.show(this.getNext(o.active));}),showPrev:this.proxy(function(){o.show(this.getPrev(o.active));}),show:this.proxy(function(p){if(!o.initialized){o.init();}this.forget(g,"resize",o.rescale);p=typeof p=="number"?p:this.getIndex();o.active=p;var r=this.getData(p);var q=this.data.length;this.setStyle(o.info,{opacity:0});o.image.load(r.image,function(s){o.w=s.scope.orig.w;o.h=s.scope.orig.h;this.setStyle(s.target,{width:"100.5%",height:"100.5%",top:0,zIndex:99998,opacity:0});o.title.innerHTML=r.title;o.counter.innerHTML=(p+1)+" / "+q;this.listen(g,"resize",o.rescale);o.rescale();});this.reveal(o.overlay);this.reveal(o.box);})};this.thumbnails={width:0};this.stageWidth=0;this.stageHeight=0;var k="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description info-author thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter";k=k.split(" ");this.loop(k,function(p){this.dom[p]=this.create("div","galleria-"+p);});this.target=this.dom.target=l.target.nodeName?l.target:this.getElements(l.target)[0];if(!this.target){i.raise("Target not found.");}},init:function(){this.options=this.mix(i.theme.defaults,this.options);this.options=this.mix({autoplay:false,carousel:true,carousel_follow:true,carousel_speed:400,carousel_steps:"auto",clicknext:false,data_config:function(k){return{};},data_image_selector:"img",data_source:this.target,data_type:"auto",debug:false,extend:function(k){},height:"auto",idle_time:3000,image_crop:false,image_margin:0,image_pan:false,image_pan_smoothness:12,image_position:"50%",keep_source:false,lightbox_clicknext:true,lightbox_fade_speed:200,lightbox_transition_speed:300,link_source_images:true,max_scale_ratio:undefined,min_scale_ratio:undefined,on_image:function(l,k){},overlay_opacity:0.85,overlay_background:"#0b0b0b",popup_links:false,preload:2,queue:true,show:0,show_info:true,show_counter:true,show_imagenav:true,thumb_crop:true,thumb_fit:true,thumb_margin:0,thumb_quality:"auto",thumbnails:true,transition:i.transitions.fade,transition_speed:400},this.options);var j=this.options;this.bind(i.DATA,function(){this.run();});if(j.clicknext){this.loop(this.data,function(k){delete k.link;});this.setStyle(this.get("stage"),{cursor:"pointer"});this.listen(this.get("stage"),"click",this.proxy(function(){this.next();}));}this.bind(i.IMAGE,function(k){j.on_image.call(this,k.imageTarget,k.thumbTarget);});this.bind(i.READY,function(){if(i.History){i.History.change(this.proxy(function(k){var l=parseInt(k.value.replace(/\//,""));if(isNaN(l)){g.history.go(-1);}else{this.show(l,undefined,true);}}));}i.theme.init.call(this,j);j.extend.call(this,j);if(/^[0-9]{1,4}$/.test(d)&&i.History){this.show(d,undefined,true);}else{if(typeof j.show=="number"){this.show(j.show);}}if(j.autoplay){if(typeof j.autoplay=="number"){this.playtime=j.autoplay;}this.trigger(i.PLAY);this.playing=true;}});this.load();return this;},bind:function(k,j){this.listen(this.get("container"),k,this.proxy(j));return this;},unbind:function(j){this.forget(this.get("container"),j);},trigger:function(j){j=typeof j=="object"?this.mix(j,{scope:this}):{type:j,scope:this};this.dispatch(this.get("container"),j);return this;},addIdleState:function(){this.idle.add.apply(this,arguments);return this;},removeIdleState:function(){this.idle.remove.apply(this,arguments);return this;},enterIdleMode:function(){this.idle.hide();return this;},exitIdleMode:function(){this.idle.show();return this;},addTimer:function(){this.timeouts.add.apply(this.timeouts,arguments);return this;},clearTimer:function(){this.timeouts.clear.apply(this.timeouts,arguments);return this;},enterFullscreen:function(){this.fullscreen.enter.apply(this,arguments);return this;},exitFullscreen:function(){this.fullscreen.exit.apply(this,arguments);return this;},openLightbox:function(){this.lightbox.show.apply(this,arguments);},closeLightbox:function(){this.lightbox.hide.apply(this,arguments);},getActive:function(){return this.controls.getActive();},getActiveImage:function(){return this.getActive().image||null;},run:function(){var q=this.options;if(!this.data.length){i.raise("Data is empty.");}if(!q.keep_source&&!Galleria.IE){this.target.innerHTML="";}this.loop(2,function(){var o=new c();this.setStyle(o.elem,{position:"absolute",top:0,left:0});this.setStyle(this.get("images"),{position:"relative",top:0,left:0,width:"100%",height:"100%"});this.get("images").appendChild(o.elem);this.push(o,this.controls);},this);if(q.carousel){this.bind(i.THUMBNAIL,this.parseCarousel);}this.build();this.target.appendChild(this.get("container"));this.loop(["info","counter","image-nav"],function(o){if(q["show_"+o.replace(/-/,"")]===false){this.moveOut(this.get(o));}});var j=0;var n=0;for(var l=0;this.data[l];l++){var k;if(q.thumbnails===true){k=new c(l);var p=this.data[l].thumb||this.data[l].image;this.get("thumbnails").appendChild(k.elem);j=this.getStyle(k.elem,"width",true);n=this.getStyle(k.elem,"height",true);if(q.thumb_fit&&q.thum_crop!==true){this.setStyle(k.elem,{width:0,height:0});}k.load(p,this.proxy(function(o){var r=o.target.width;o.scope.scale({width:j,height:n,crop:q.thumb_crop,margin:q.thumb_margin,complete:this.proxy(function(){var t=["left","top"];var s=["Height","Width"];this.loop(s,function(u,w){if((!q.thumb_crop||q.thumb_crop==u.toLowerCase())&&q.thumb_fit){var v={};var x=s[Math.abs(w-1)].toLowerCase();v[x]=o.target[x];this.setStyle(o.target.parentNode,v);var v={};v[t[w]]=0;this.setStyle(o.target,v);}o.scope["outer"+u]=this[u.toLowerCase()](o.target.parentNode,true);});this.toggleQuality(o.target,q.thumb_quality===true||(q.thumb_quality=="auto"&&r<o.target.width*3));this.trigger({type:i.THUMBNAIL,thumbTarget:o.target,thumbOrder:o.scope.order});})});}));if(q.preload=="all"){k.add(this.data[l].image);}}else{if(q.thumbnails=="empty"){k={elem:this.create("div","galleria-image"),image:this.create("span","img")};k.elem.appendChild(k.image);this.get("thumbnails").appendChild(k.elem);}else{k={elem:false,image:false};}}var m=this.proxy(function(r){this.pause();r.preventDefault();var o=r.currentTarget.rel;if(this.active!==o){this.show(o);}});if(q.thumbnails!==false){k.elem.rel=l;this.listen(k.elem,"click",m);}if(q.link_source_images&&q.keep_source&&this.data[l].elem){this.data[l].elem.rel=l;this.listen(this.data[l].elem,"click",m);}this.push(k,this.thumbnails);}this.setStyle(this.get("thumbnails"),{opacity:0});if(q.height&&q.height!="auto"){this.setStyle(this.get("container"),{height:q.height});}this.wait(function(){var o=this.getStyle(this.get("container"),"height",true);this.stageWidth=this.width(this.get("stage"));this.stageHeight=this.height(this.get("stage"));if(this.stageHeight<50&&q.height=="auto"){this.setStyle(this.get("container"),{height:Math.round(this.stageWidth*9/16)});this.stageHeight=this.height(this.get("stage"));}return this.stageHeight&&this.stageWidth;},function(){this.listen(this.get("image-nav-right"),"click",this.proxy(function(o){if(q.clicknext){o.stopPropagation();}this.pause();this.next();}));this.listen(this.get("image-nav-left"),"click",this.proxy(function(o){if(q.clicknext){o.stopPropagation();}this.pause();this.prev();}));this.setStyle(this.get("thumbnails"),{opacity:1});this.trigger(i.READY);},function(){i.raise("Galleria could not load properly. Make sure stage has a height and width.");},5000);},mousePosition:function(j){return{x:j.pageX-this.$("stage").offset().left+jQuery(document).scrollLeft(),y:j.pageY-this.$("stage").offset().top+jQuery(document).scrollTop()};},addPan:function(n){var q=this.options.image_crop;if(q===false){return;}if(this.options.image_crop===false){return;}n=n||this.controls.getActive().image;if(n.tagName.toUpperCase()!="IMG"){i.raise("Could not add pan");}var u=n.width/2;var s=n.height/2;var k=destX=this.getStyle(n,"left",true)||0;var j=destY=this.getStyle(n,"top",true)||0;var t=0;var r=0;var l=false;var p=new Date().getTime();var m=this.proxy(function(v){if(new Date().getTime()-p<50){return;}l=true;u=this.mousePosition(v).x;s=this.mousePosition(v).y;});var o=this.proxy(function(v){if(!l){return;}t=n.width-this.stageWidth;r=n.height-this.stageHeight;destX=u/this.stageWidth*t*-1;destY=s/this.stageHeight*r*-1;k+=(destX-k)/this.options.image_pan_smoothness;j+=(destY-j)/this.options.image_pan_smoothness;if(r>0){this.setStyle(n,{top:Math.max(r*-1,Math.min(0,j))});}if(t>0){this.setStyle(n,{left:Math.max(t*-1,Math.min(0,k))});}});this.forget(this.get("stage"),"mousemove");this.listen(this.get("stage"),"mousemove",m);this.addTimer("pan",o,30,true);},removePan:function(){this.forget(this.get("stage"),"mousemove");this.clearTimer("pan");},parseCarousel:function(m){var k=0;var l=0;var j=[0];this.loop(this.thumbnails,function(n,o){if(n.ready){k+=n.outerWidth||this.width(n.elem,true);j[o+1]=k;l=Math.max(l,this.height(n.elem));}});this.toggleClass(this.get("thumbnails-container"),"galleria-carousel",k>this.stageWidth);this.setStyle(this.get("thumbnails-list"),{overflow:"hidden",position:"relative"});this.setStyle(this.get("thumbnails"),{width:k,height:l,position:"relative",overflow:"hidden"});if(!this.carousel){this.initCarousel();}this.carousel.max=k;this.carousel.hooks=j;this.carousel.width=this.width(this.get("thumbnails-list"));this.carousel.setClasses();},initCarousel:function(){var j=this.carousel={right:this.get("thumb-nav-right"),left:this.get("thumb-nav-left"),update:this.proxy(function(){this.parseCarousel();}),width:0,current:0,set:function(k){k=Math.max(k,0);while(j.hooks[k-1]+j.width>j.max&&k>=0){k--;}j.current=k;j.animate();},hooks:[],getLast:function(k){k=k||j.current;return k-1;},follow:function(k){if(k==0||k==j.hooks.length-2){j.set(k);return;}var l=j.current;while(j.hooks[l]-j.hooks[j.current]<j.width&&l<=j.hooks.length){l++;}if(k-1<j.current){j.set(k-1);}else{if(k+2>l){j.set(k-l+j.current+2);}}},max:0,setClasses:this.proxy(function(){this.toggleClass(j.left,"disabled",!j.current);this.toggleClass(j.right,"disabled",j.hooks[j.current]+j.width>j.max);}),animate:this.proxy(function(k){j.setClasses();this.animate(this.get("thumbnails"),{to:{left:j.hooks[j.current]*-1},duration:this.options.carousel_speed,easing:"galleria",queue:false});})};this.listen(j.right,"click",this.proxy(function(l){if(this.options.carousel_steps=="auto"){for(var k=j.current;k<j.hooks.length;k++){if(j.hooks[k]-j.hooks[j.current]>j.width){j.set(k-2);break;}}}else{j.set(j.current+this.options.carousel_steps);}}));this.listen(j.left,"click",this.proxy(function(l){if(this.options.carousel_steps=="auto"){for(var k=j.current;k>=0;k--){if(j.hooks[j.current]-j.hooks[k]>j.width){j.set(k+2);break;}else{if(k==0){j.set(0);break;}}}}else{j.set(j.current-this.options.carousel_steps);}}));},addElement:function(){this.loop(arguments,function(j){this.dom[j]=this.create("div","galleria-"+j);});return this;},getDimensions:function(j){return{w:j.width,h:j.height,cw:this.stageWidth,ch:this.stageHeight,top:(this.stageHeight-j.height)/2,left:(this.stageWidth-j.width)/2};},attachKeyboard:function(j){this.keyboard.attach(j);return this;},detachKeyboard:function(){this.keyboard.detach();return this;},build:function(){this.append({"info-text":["info-title","info-description","info-author"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info"]});this.current=this.create("span","current");this.current.innerHTML="-";this.get("counter").innerHTML=' / <span class="total">'+this.data.length+"</span>";this.prependChild("counter",this.current);},appendChild:function(j,l){try{this.get(j).appendChild(this.get(l));}catch(k){}},prependChild:function(j,l){var l=this.get(l)||l;try{this.get(j).insertBefore(l,this.get(j).firstChild);}catch(k){}},remove:function(){var j=Array.prototype.slice.call(arguments);this.jQuery(j.join(",")).remove();},append:function(m){for(var l in m){if(m[l].constructor==Array){for(var k=0;m[l][k];k++){this.appendChild(l,m[l][k]);}}else{this.appendChild(l,m[l]);}}return this;},rescale:function(k,j,n){var m=this.options;n=this.proxy(n);if(typeof k=="function"){n=this.proxy(k);k=undefined;}var l=this.proxy(function(){this.stageWidth=k||this.width(this.get("stage"));this.stageHeight=j||this.height(this.get("stage"));this.controls.getActive().scale({width:this.stageWidth,height:this.stageHeight,crop:m.image_crop,max:m.max_scale_ratio,min:m.min_scale_ratio,margin:m.image_margin,position:m.image_position});if(this.carousel){this.carousel.update();}this.trigger(i.RESCALE);n();});if(i.WEBKIT&&!k&&!j){this.addTimer("scale",l,5);}else{l.call(this);}},show:function(k,j,l){if(!this.options.queue&&this.queue.stalled){return;}j=typeof j!="undefined"?!!j:k<this.active;l=l||false;k=Math.max(0,Math.min(parseInt(k),this.data.length-1));if(!l&&i.History){i.History.value(k.toString());return;}this.active=k;this.push([k,j],this.queue);if(!this.queue.stalled){this.showImage();}return this;},showImage:function(){var m=this.options;var y=this.queue[0];var w=y[0];var t=!!y[1];if(m.carousel&&this.carousel&&m.carousel_follow){this.carousel.follow(w);}var j=this.getData(w).image;var s=this.controls.getActive();var v=this.controls.getNext();var r=v.isCached(j);var l=this.proxy(function(){this.queue.stalled=false;this.toggleQuality(v.image,m.image_quality);this.setStyle(s.elem,{zIndex:0});this.setStyle(v.elem,{zIndex:1});this.trigger({type:i.IMAGE,index:w,imageTarget:v.image,thumbTarget:this.thumbnails[w].image});if(m.image_pan){this.addPan(v.image);}this.controls.swap();this.moveOut(s.image);if(this.getData(w).link){this.setStyle(v.image,{cursor:"pointer"});this.listen(v.image,"click",this.proxy(function(){if(m.popup_links){var n=g.open(this.getData(w).link,"_blank");}else{g.location.href=this.getData(w).link;}}));}Array.prototype.shift.call(this.queue);if(this.queue.length){this.showImage();}this.playCheck();});if(typeof m.preload=="number"&&m.preload>0){var k,q=this.getNext();try{for(var u=m.preload;u>0;u--){k=new c();k.add(this.getData(q).image);q=this.getNext(q);}}catch(x){}}this.trigger({type:i.LOADSTART,cached:r,index:w,imageTarget:v.image,thumbTarget:this.thumbnails[w].image});jQuery(this.thumbnails[w].elem).addClass("active").siblings(".active").removeClass("active");v.load(j,this.proxy(function(n){v.scale({width:this.stageWidth,height:this.stageHeight,crop:m.image_crop,max:m.max_scale_ratio,min:m.min_scale_ratio,margin:m.image_margin,position:m.image_position,complete:this.proxy(function(){if(s.image){this.toggleQuality(s.image,false);}this.toggleQuality(v.image,false);this.trigger({type:i.LOADFINISH,cached:r,index:w,imageTarget:v.image,thumbTarget:this.thumbnails[w].image});this.queue.stalled=true;var o=i.transitions[m.transition]||m.transition;this.removePan();this.setInfo(w);this.setCounter(w);if(typeof o=="function"){o.call(this,{prev:s.image,next:v.image,rewind:t,speed:m.transition_speed||400},l);}else{l();}})});}));},getNext:function(j){j=typeof j=="number"?j:this.active;return j==this.data.length-1?0:j+1;},getPrev:function(j){j=typeof j=="number"?j:this.active;return j===0?this.data.length-1:j-1;},next:function(){if(this.data.length>1){this.show(this.getNext(),false);}return this;},prev:function(){if(this.data.length>1){this.show(this.getPrev(),true);}return this;},get:function(j){return j in this.dom?this.dom[j]:null;},getData:function(j){return this.data[j]||this.data[this.active];},getIndex:function(){return typeof this.active==="number"?this.active:0;},play:function(j){this.trigger(i.PLAY);this.playing=true;this.playtime=j||this.playtime;this.playCheck();return this;},pause:function(){this.trigger(i.PAUSE);this.playing=false;return this;},playCheck:function(){var n=0;var k=20;var m=function(){return new Date().getTime();};var j=m();if(this.playing){this.clearTimer("play");var l=this.proxy(function(){n=m()-j;if(n>=this.playtime&&this.playing){this.clearTimer("play");this.next();return;}if(this.playing){this.trigger({type:i.PROGRESS,percent:Math.ceil(n/this.playtime*100),seconds:Math.floor(n/1000),milliseconds:n});this.addTimer("play",l,k);}});this.addTimer("play",l,k);}},setActive:function(j){this.active=j;return this;},setCounter:function(j){j=j||this.active;this.current.innerHTML=j+1;return this;},setInfo:function(j){var k=this.getData(j||this.active);this.loop(["title","description","author"],function(m){var n=this.get("info-"+m);var l=k[m]&&k[m].length?"reveal":"hide";this[l](n);if(k[m]){n.innerHTML=k[m];}});return this;},hasInfo:function(k){var m=this.getData(k);var j="title description author".split(" ");for(var l=0;j[l];l++){if(m[j[l]]&&m[j[l]].length){return true;}}return false;},getDataObject:function(k){var j={image:"",thumb:"",title:"",description:"",author:"",link:""};return k?this.mix(j,k):j;},jQuery:function(l){var j=[];this.loop(l.split(","),this.proxy(function(m){m=m.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.get(m)){j.push(m);}}));var k=jQuery(this.get(j.shift()));this.loop(j,this.proxy(function(m){k=k.add(this.get(m));}));return k;},$:function(j){return this.jQuery(j);},toggleQuality:function(j,k){if(!i.IE7||typeof j=="undefined"||!j){return this;}if(typeof k==="undefined"){k=j.style.msInterpolationMode=="nearest-neighbor";}j.style.msInterpolationMode=k?"bicubic":"nearest-neighbor";return this;},unload:function(){},load:function(){var l=0;var m=this.options;if((m.data_type=="auto"&&typeof m.data_source=="object"&&!(m.data_source instanceof jQuery)&&!m.data_source.tagName)||m.data_type=="json"||m.data_source.constructor==Array){this.data=m.data_source;this.trigger(i.DATA);}else{var k=jQuery(m.data_source).find(m.data_image_selector);var j=this.proxy(function(q){var p,o,n=q.parentNode;if(n&&n.nodeName=="A"){if(n.href.match(/\.(png|gif|jpg|jpeg)/i)){p=n.href;}else{o=n.href;}}var r=this.getDataObject({title:q.title,thumb:q.src,image:p||q.src,description:q.alt,link:o||q.getAttribute("longdesc"),elem:q});return this.mix(r,m.data_config(q));});this.loop(k,function(n){l++;this.push(j(n),this.data);if(!m.keep_source&&!Galleria.IE){n.parentNode.removeChild(n);}if(l==k.length){this.trigger(i.DATA);}});}}});i.log=function(){try{console.log.apply(console,Array.prototype.slice.call(arguments));}catch(j){try{opera.postError.apply(opera,arguments);}catch(k){alert(Array.prototype.join.call(arguments," "));}}};var a=navigator.userAgent.toLowerCase();var d=g.location.hash.replace(/#\//,"");i.DATA="data";i.READY="ready";i.THUMBNAIL="thumbnail";i.LOADSTART="loadstart";i.LOADFINISH="loadfinish";i.IMAGE="image";i.THEMELOAD="themeload";i.PLAY="play";i.PAUSE="pause";i.PROGRESS="progress";i.FULLSCREEN_ENTER="fullscreen_enter";i.FULLSCREEN_EXIT="fullscreen_exit";i.IDLE_ENTER="idle_enter";i.IDLE_EXIT="idle_exit";i.RESCALE="rescale";i.LIGHTBOX_OPEN="lightbox_open";i.LIGHTBOX_CLOSE="lightbox_cloe";i.LIGHTBOX_IMAGE="lightbox_image";i.IE8=(typeof(XDomainRequest)!=="undefined");i.IE7=!!(g.XMLHttpRequest&&document.expando);i.IE6=(!g.XMLHttpRequest);i.IE=!!(i.IE6||i.IE7);i.WEBKIT=/webkit/.test(a);i.SAFARI=/safari/.test(a);i.CHROME=/chrome/.test(a);i.QUIRK=(i.IE&&document.compatMode&&document.compatMode=="BackCompat");i.MAC=/mac/.test(navigator.platform.toLowerCase());i.OPERA=!!g.opera;i.Picture=c;i.addTheme=function(m){var l={};var n=["name","author","version","defaults","init"];var k=i.prototype;k.loop(n,function(o){if(!m[o]){i.raise(o+" not specified in theme.");}if(o!="name"&&o!="init"){l[o]=m[o];}});l.init=m.init;if(m.css){var j;k.loop(k.getElements("script"),function(p){var o=new RegExp("galleria."+m.name.toLowerCase()+".js");if(o.test(p.src)){j=p.src.replace(/[^\/]*$/,"")+m.css;k.loadCSS(j,function(){i.theme=l;jQuery(document).trigger(i.THEMELOAD);});}});if(!j){i.raise("No theme CSS loaded");}}return l;};i.raise=function(j){if(i.debug){throw new Error(j);}};i.loadTheme=function(j){i.prototype.loadScript(j);};i.galleries=[];i.get=function(j){if(i.galleries[j]){return i.galleries[j];}else{if(typeof j!=="number"){return i.galleries;}else{i.raise("Gallery index not found");}}};jQuery.easing.galleria=function(k,l,j,n,m){if((l/=m/2)<1){return n/2*l*l*l*l+j;}return -n/2*((l-=2)*l*l*l-2)+j;};i.transitions={add:function(j,k){if(j!=arguments.callee.name){this[j]=k;}},fade:function(k,j){jQuery(k.next).show().css("opacity",0).animate({opacity:1},k.speed,j);if(k.prev){jQuery(k.prev).css("opacity",1).animate({opacity:0},k.speed);}},flash:function(k,j){jQuery(k.next).css("opacity",0);if(k.prev){jQuery(k.prev).animate({opacity:0},(k.speed/2),function(){jQuery(k.next).animate({opacity:1},k.speed,j);});}else{jQuery(k.next).animate({opacity:1},k.speed,j);}},pulse:function(k,j){if(k.prev){jQuery(k.prev).css("opacity",0);}jQuery(k.next).css("opacity",0).animate({opacity:1},k.speed,j);},slide:function(n,k){var m=jQuery(n.next).parent();var j=this.$("images");var l=this.stageWidth;m.css({left:l*(n.rewind?-1:1)});j.animate({left:l*(n.rewind?1:-1)},{duration:n.speed,queue:false,easing:"galleria",complete:function(){j.css("left",0);m.css("left",0);k();}});},fadeslide:function(k,j){if(k.prev){jQuery(k.prev).css({opacity:1,left:0}).animate({opacity:0,left:50*(k.rewind?1:-1)},{duration:k.speed,queue:false,easing:"swing"});}jQuery(k.next).css({left:50*(k.rewind?-1:1),opacity:0}).animate({opacity:1,left:0},{duration:k.speed,complete:j,queue:false,easing:"swing"});}};i.addTransition=function(){i.transitions.add.apply(this,arguments);};jQuery.fn.galleria=function(k){k=k||{};var j=this.selector;return this.each(function(){if(!k.keep_source){jQuery(this).children().hide();}k=i.prototype.mix(k,{target:this});var l=i.prototype.height(this)||i.prototype.getStyle(this,"height",true);if(!k.height&&l){k=i.prototype.mix({height:l},k);}i.debug=!!k.debug;var m=new i(k);Galleria.galleries.push(m);if(i.theme){m.init();}else{jQuery(document).bind(i.THEMELOAD,function(){m.init();});}});};})();