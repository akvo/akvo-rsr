{% load render_bundle from webpack_loader %}
{% load markup_tags %}
<!DOCTYPE html>
<html>
  <head>
    <title>Project Report</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap" rel="stylesheet">

    <style>{% include 'reports/project.css' %}</style>

  </head>
  <body>
    <div class="container">
      <h1>{{ project.title }}</h1>

      <div class="row first-section">
        <div class="seven columns summary">
          <h2>Project Summary</h2>
          <div>
            {{ project.project_plan_summary|apply_markup:"markdown" }}
          </div>
        </div>

        <div class="five columns">
          <h2>Partners</h2>
          <div class="partners">
            <ul>
              {% for partner in project.all_partners %}
                <li>{{ partner.name }}</li>
              {% endfor %}
            </ul>
          </div>

          {% if project.primary_location %}
            <h2>Location</h2>
            <div>
                <p>{{ project.primary_location.country.name }}</p>
            </div>
          {% endif %}
        </div>
      </div>

      <div class="page-break"></div>

      <div class="related-project">
        {% if project.parents.count %}
          <div class="lead-project">
            <h2 class="with-subtext">Lead project: {{ project.parents.first.title }}</h2>
            <i>(Actual value data from projects in this hierarchy is aggregated upward to this lead project.)</i>
          </div>
        {% endif %}

        {% if project.children.count %}
          <div class="contributors">
            <h2 class="with-subtext">Contributing projects</h2>
            <i>(Actual value data from contributing projects is propagated upward to this project.)</i>
            <ul>
              {% for child in project.children_all.published %}
                <li>{{ child.title }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>

      <div class="results">
        <h2>Results</h2>

        {% with is_eutf_descendant=project.in_eutf_hierarchy %}
          {% for result in project.results.all %}
            <div class="result-item">
              <div class="pre-title">Result {{ forloop.counter }}</div>
              <h3>{{ result.title }}</h3>

              {% for indicator in result.indicators.all %}
                <table>
                  <thead>
                    <tr class="indicator-info">
                      <th>Indicator {{ forloop.counter }}</th>
                      <th colspan="5">{{ indicator.title }}</th>
                    </tr>
                    <tr class="indicator-info">
                      <td>Baseline</td>
                      <td colspan="5">
                        {{ indicator.baseline_value }}{% if indicator.measure == '2' %}%{% endif %}
                        {% if indicator.baseline_year %}({{ indicator.baseline_year }}){% endif %}
                        {{ indicator.baseline_comment }}
                      </td>
                    </tr>
                    <tr>
                      <th>Period</th>
                      <th>Actual</th>
                      <th>Target</th>
                      <th>Comment</th>
                      <th>&nbsp;</th>
                      <th>Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for period in indicator.periods.all %}
                      <tr>
                        <td>
                          {% if not is_eutf_descendant %}
                            {{ period.period_start|date:"j M Y" }}
                          {% elif project.date_start_actual %}
                            {{ project.date_start_actual|date:"j M Y" }}
                          {% else %}
                            {{ project.date_start_planned|date:"j M Y" }}
                          {% endif %}
                          -
                          {% if not is_eutf_descendant %}
                            {{ period.period_end|date:"j M Y" }}
                          {% elif project.date_end_actual %}
                            {{ project.date_end_actual|date:"j M Y" }}
                          {% else %}
                            {{ project.date_end_planned|date:"j M Y" }}
                          {% endif %}
                        </td>
                        <td>{{ period.actual_value }}</td>
                        <td>{{ period.target_value }}</td>
                        <td>{{ period.actual_comment }}</td>
                        <td></td>
                        <td></td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              {% endfor %}
            </div>
            <div class="page-break"></div>
          {% endfor %}
        {% endwith %}
      </div>

      <div class="project-updates">
        <h2>Project Updates</h2>

        {% for update in project.project_updates.all %}
        <div class="project-update">
          <h3>{{ update.title }}</h3>
          <div>{{ update.created_at|date:"j M Y" }}</div>
          {% if update.photo %}
          <img src="https://rsr.akvo.org/{{ update.photo.url }}"/>
          {% endif %}
          <div>{{ update.text|apply_markup:"markdown" }}</div>
        </div>
        {% endfor %}
      </div>

    </div>
  </body>
</html>
