{% load markup_tags %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Project Report</title>

    <style>{% include 'reports/results-indicators-map-overview.css'  %}</style>
    <style>
      @page {
        @bottom-left { content: "Akvo RSR Report {{ today }}"; }
      }

      .intro header {
        font-size: 18pt;
        margin-bottom: 18mm;
        font-weight: bold;
      }
      .intro .aside {
        float: right;
        width: 8cm;
      }
      .intro .partners {
        margin-bottom: 20mm;
      }
      .intro .partners ul {
        padding-left: 0;
        list-style: none;
      }
      .intro .partners ul li {
        margin-bottom: 2mm;
      }
      .intro .summary {
        width: 10cm;
      }

      .related-projects h1 {
        font-size: 16pt;
        padding-top: 14mm;
        margin-bottom: 0;
      }
      .related-projects h1+i {
        font-size: 9pt;
      }
      .related-projects ul {
        padding-left: 0;
        list-style: none;
      }
      .related-projects ul li {
        margin-bottom: 8pt;
      }

      .results h1 {
        font-size: 24pt;
      }
    </style>

  </head>
  <body>
    <header class="doc-title">{{ project.title }}</header>

    <div class="intro">
      <div class="aside">
        <div class="partners">
          <header>Partners</header>
          <ul>
            {% for partner in project.all_partners %}
            <li>{{ partner.name }}</li>
            {% endfor %}
          </ul>
        </div>

        {% if project.primary_location %}
        <div class="location">
          <header>Location</header>
          <p>{{ location }}</p>
        </div>
        {% endif %}
      </div>

      <div class="summary">
        <header>Project Summary</header>
        <div>
          {{ project.project_plan_summary|apply_markup:"markdown" }}
        </div>
      </div>
    </div>

    <div class="page-break"></div>
    <section class="staticmap">
      <img src="{{ staticmap }}" alt="Location map">
    </section>

    <div class="page-break"></div>
    <section class="related-projects">
      {% if project.parents.count %}
      <div class="lead-project">
        <h1 class="with-subtext">Lead project: {{ project.parents.first.title }}</h1>
        <i>(Actual value data from projects in this hierarchy is aggregated upward to this lead project.)</i>
      </div>
      {% endif %}

      {% if project.children.count %}
      <div class="contributors">
        <h1 class="with-subtext">Contributing projects</h1>
        <i>(Actual value data from contributing projects is propagated upward to this project.)</i>
        <ul>
          {% for child in project.children_all.published %}
          <li>{{ child.title }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </section>

    <section class="results">
      <h1>Results</h1>

      {% for result in results %}
      <div class="result-item">
        <div class="pre-title">Result {{ forloop.counter }}</div>
        <h2>{{ result.title }}</h2>

        {% for indicator in result.indicators %}
        <table>
          <thead>
            <tr class="indicator-info">
              <th>Indicator {{ forloop.counter }}</th>
              <th colspan="5">{{ indicator.title }}</th>
            </tr>
            <tr class="indicator-info">
              <td>Baseline</td>
              <td colspan="5">
                {{ indicator.baseline_value }}
                {{ indicator.baseline_year }}
                {{ indicator.baseline_comment }}
              </td>
            </tr>
            <tr>
              <th>Period</th>
              <th>Actual</th>
              <th>Target</th>
              {% if show_comment %}<th>Comment</th>{% endif %}
              <th>&nbsp;</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            {% for period in indicator.periods %}
            <tr>
              <td>
                {{ period.period_start|date:"j M Y" }}
                -
                {{ period.period_end|date:"j M Y" }}
              </td>
              <td>{{ period.actual_value }}</td>
              <td>{{ period.target_value }}</td>
              {% if show_comment %}<td>{{ period.actual_comment }}</td>{% endif %}
              <td class="grade-circle"><div class="{{ period.grade }}"></div></td>
              <td class="total"><span class="grade {{ period.grade }}">{{ period.total }}</span></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endfor %}
      </div>
      {% endfor %}
    </section>
  </body>
</html>
